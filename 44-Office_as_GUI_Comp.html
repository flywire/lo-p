
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
        <link rel="canonical" href="https://flywire.github.io/lo-p/44-Office_as_GUI_Comp.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Chapter 44. Office as a GUI Component - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-44-office-as-a-gui-component" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 44. Office as a GUI Component
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 44. Office as a GUI Component
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link md-nav__link--active">
        Chapter 44. Office as a GUI Component
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-ooobean" class="md-nav__link">
    1.  OOoBean
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-wrapping-ooobean-in-a-jpanel" class="md-nav__link">
    2.  Wrapping OOoBean in a JPanel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-using-the-obeanpanel" class="md-nav__link">
    3.  Using the OBeanPanel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-using-an-undecorated-office-window" class="md-nav__link">
    4.  Using an Undecorated Office Window
  </a>
  
    <nav class="md-nav" aria-label="4.  Using an Undecorated Office Window">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listening-to-user-input-and-the-window" class="md-nav__link">
    Listening to User Input and the Window
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-augmenting-the-user-interface-a-new-toolbar-item" class="md-nav__link">
    5.  Augmenting the User Interface: a New Toolbar Item
  </a>
  
    <nav class="md-nav" aria-label="5.  Augmenting the User Interface: a New Toolbar Item">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-intercepting-dispatches" class="md-nav__link">
    5.1.  Intercepting Dispatches
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-displaying-a-message-box" class="md-nav__link">
    5.2.  Displaying a Message Box
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-adding-hello-to-the-toolbar" class="md-nav__link">
    5.3.  Adding "Hello" to the Toolbar
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-augmenting-the-user-interface-a-new-menu-item" class="md-nav__link">
    6.  Augmenting the User Interface: a New Menu Item
  </a>
  
    <nav class="md-nav" aria-label="6.  Augmenting the User Interface: a New Menu Item">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-creating-a-new-menubar" class="md-nav__link">
    6.1.  Creating a New Menubar
  </a>
  
    <nav class="md-nav" aria-label="6.1.  Creating a New Menubar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-menu" class="md-nav__link">
    Creating the Menu
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-adding-to-the-existing-menubar" class="md-nav__link">
    6.2.  Adding to the Existing Menubar
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-ooobean" class="md-nav__link">
    1.  OOoBean
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-wrapping-ooobean-in-a-jpanel" class="md-nav__link">
    2.  Wrapping OOoBean in a JPanel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-using-the-obeanpanel" class="md-nav__link">
    3.  Using the OBeanPanel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-using-an-undecorated-office-window" class="md-nav__link">
    4.  Using an Undecorated Office Window
  </a>
  
    <nav class="md-nav" aria-label="4.  Using an Undecorated Office Window">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listening-to-user-input-and-the-window" class="md-nav__link">
    Listening to User Input and the Window
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-augmenting-the-user-interface-a-new-toolbar-item" class="md-nav__link">
    5.  Augmenting the User Interface: a New Toolbar Item
  </a>
  
    <nav class="md-nav" aria-label="5.  Augmenting the User Interface: a New Toolbar Item">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-intercepting-dispatches" class="md-nav__link">
    5.1.  Intercepting Dispatches
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-displaying-a-message-box" class="md-nav__link">
    5.2.  Displaying a Message Box
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-adding-hello-to-the-toolbar" class="md-nav__link">
    5.3.  Adding "Hello" to the Toolbar
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-augmenting-the-user-interface-a-new-menu-item" class="md-nav__link">
    6.  Augmenting the User Interface: a New Menu Item
  </a>
  
    <nav class="md-nav" aria-label="6.  Augmenting the User Interface: a New Menu Item">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-creating-a-new-menubar" class="md-nav__link">
    6.1.  Creating a New Menubar
  </a>
  
    <nav class="md-nav" aria-label="6.1.  Creating a New Menubar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-menu" class="md-nav__link">
    Creating the Menu
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-adding-to-the-existing-menubar" class="md-nav__link">
    6.2.  Adding to the Existing Menubar
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/main/docs/44-Office_as_GUI_Comp.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-44-office-as-a-gui-component">Chapter 44. Office as a GUI Component<a class="headerlink" href="#chapter-44-office-as-a-gui-component" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>OOoBean;
Wrapping OOoBean in a
JPanel; Using the
OBeanPanel; Using an
Undecorated Office
Window; Augmenting
the User Interface: a
New Toolbar Item;
Augmenting the User
Interface: a New Menu
Item</p>
<p>Example folders: "GUI
Tests" and "Utils"</p>
</div>
<p>This chapter looks at two ways to use Office as a GUI
component for displaying documents in a program.</p>
<p>The first employs Office's OOoBean class: I'll wrap it in a
JPanel to utilize it as part of a Swing application.</p>
<p>The second approach invokes Office in a separate window
from the program, a technique I've used many times in
earlier chapters. The difference this time is that I'll hide
Office's GUI (i.e. its toolbars, menu, and sidebars), leaving
only the document visible. I'll also explore two variations
of this 'blank look': adding a item to a toolbar, and creating
a new menu. These GUI entities aren't permanently added to Office, and are
controlled and monitored by the program.</p>
<h2 id="1-ooobean">1.  OOoBean<a class="headerlink" href="#1-ooobean" title="Permanent link">&para;</a></h2>
<p>The OOoBean class and its com.sun.star.comp.beans package aren't documented in
LibreOffice, but there's an entire chapter about them in the Developer's Guide
(chapter 16, "JavaBean for Office Components"), at
<a href="https://wiki.openoffice.org/w/images/d/d9/DevelopersGuide_OOo3.1.0.pdf">https://wiki.openoffice.org/w/images/d/d9/DevelopersGuide_OOo3.1.0.pdf</a>, and
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/JavaBean/JavaBean_for_Office_Components">https://wiki.openoffice.org/wiki/Documentation/DevGuide/JavaBean/JavaBean_for_Office_Components</a>
(or use <code>loGuide JavaBean</code>). The chapter's example,
OOoBeanViewer, wraps OOoBean in an old-style Applet (not a JApplet), and can be
downloaded from
<a href="https://api.libreoffice.org/examples/DevelopersGuide/examples.html#OfficeBean">https://api.libreoffice.org/examples/DevelopersGuide/examples.html#OfficeBean</a>.</p>
<p>Another source of information is the OOoBean code at
<a href="https://github.com/LibreOffice/core/blob/master/bean/com/sun/star/comp/beans/OOoBean.java">https://github.com/LibreOffice/core/blob/master/bean/com/sun/star/comp/beans/OOoBean.java</a>.
It's also possible to decompile OOoBean 's JAR file, which you'll find in
<Office>\program\classes\officebean.jar.</p>
<p>As you browse the documentation and source code, you may get the feeling that
OOoBean has been abandoned. It's true that some functionality have been deprecated,
but OOoBean still mostly works. Setting it up is tricky, requiring an undocumented
UNO_PATH environment variable to be set when Office is invoked. Also, integrating
OOoBean with Swing and my LibreOffice support classes required some work.</p>
<p>OOoBean utilizes many parts of the Office API, since it starts Office, loads a
document, and displays it on a Java Canvas. Some of that can be seen in Figure 1
which gives a simplified view of its classes and interfaces.</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-1.png" /></p>
<p>Figure 1. Some of the OOoBean Classes and Interfaces.</p>
<p>The classes without package prefixes are from com.sun.star.comp.beans. For
example, LocalOfficeConnection invokes and connects to Office, while
LocalOfficeWindow renders Office and the loaded document. LocalOfficeWindow's
use of java.awt.Canvas means that the view is a heavyweight, native peer, which
doesn't work well with lightweight Swing components such as drop-down menus, text
fields, and buttons. One solution is to wrap the heavyweight component (i.e. the
Canvas) in a JPanel, which I've done in my OOBeanPanel class described in the next
section.</p>
<p>Frame, Controller, and OfficeDocument are wrappers around com.sun.star.frame's
XFrame, XController, and  XModel, the three elements of Office's Frame-Controller-
Model (FCM) relationship (described in Chapter 1, section 5).</p>
<p>Figure 2 shows OOoBean's public methods, with the deprecated ones highlighted in
light orange and blue.</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-2.png" /></p>
<p>Figure 2. The Public Methods of OOoBean.</p>
<p>Nearly half the methods are deprecated, but only one of them
(releaseSystemWindow()) is required in my code, to deal with a focus switching bug.</p>
<p>The methods marked in light blue all relate to toolbar visibility, and can be handled
better by the LayoutManager service explained later.</p>
<p>There's a table of one-line descriptions of OOoBean's methods in chapter 16 of the
Developer's Guide, and online at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/JavaBean/API_Overview">https://wiki.openoffice.org/wiki/Documentation/DevGuide/JavaBean/API_Overview</a>
(or use <code>loGuide JavaBean "API Overview"</code>). I'll only explain the methods used in
my OBeanPanel class.</p>
<h2 id="2-wrapping-ooobean-in-a-jpanel">2.  Wrapping OOoBean in a JPanel<a class="headerlink" href="#2-wrapping-ooobean-in-a-jpanel" title="Permanent link">&para;</a></h2>
<p>OBeanPanel wraps an OOoBean instance inside a JPanel so its heavyweight canvas
doesn't affect the rendering of lightweight components in the surrounding application.</p>
<p>The class diagram for OBeanPanel in Figure 3 shows that it's a JPanel subclass, and
implements Office mouse and keyboard listeners.</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-3.png" /></p>
<p>Figure 3. The OBeanPanel Class Diagram.</p>
<p>The key handling is necessary for coding around a keyboard focus bug. The mouse
handler is included to show how to monitor mouse presses and releases in the
document.</p>
<p>OBeanPanel 's constructor sets up some JPanel attributes (its background color,
dimensions, and start-up  message), calls the OOoBean constructor, and adds the bean
to the panel:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the OBeanPanel class</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">pWidth</span><span class="p">,</span> <span class="n">pHeight</span><span class="p">;</span>    <span class="c1">// of panel</span>
<span class="kd">private</span> <span class="n">OOoBean</span> <span class="n">oob</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="kd">private</span> <span class="n">Font</span> <span class="n">msgFont</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">FontMetrics</span> <span class="n">fontMetric</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="p">;</span>


<span class="kd">public</span> <span class="nf">OBeanPanel</span><span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">pWidth</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
  <span class="n">pHeight</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>

  <span class="n">setBackground</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">WHITE</span><span class="p">);</span>
  <span class="n">setPreferredSize</span><span class="p">(</span><span class="k">new</span> <span class="n">Dimension</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">));</span>
  <span class="n">setLayout</span><span class="p">(</span><span class="k">new</span> <span class="n">BorderLayout</span><span class="p">());</span>

  <span class="c1">// start-up and finishing message used by panel</span>
  <span class="n">msgFont</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Font</span><span class="p">(</span><span class="s">&quot;SansSerif&quot;</span><span class="p">,</span> <span class="n">Font</span><span class="p">.</span><span class="na">BOLD</span><span class="p">,</span> <span class="mi">36</span><span class="p">);</span>
  <span class="n">fontMetric</span> <span class="o">=</span> <span class="n">getFontMetrics</span><span class="p">(</span><span class="n">msgFont</span><span class="p">);</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Waiting for Office...&quot;</span><span class="p">;</span>

  <span class="n">oob</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OOoBean</span><span class="p">();</span>   <span class="c1">// doesn&#39;t connect to Office;</span>
                         <span class="c1">// actually an empty method</span>
  <span class="n">add</span><span class="p">(</span><span class="n">oob</span><span class="p">,</span> <span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span>
<span class="p">}</span> <span class="c1">// end of OBeanPanel()</span>
</code></pre></div>
<p>The surprising thing about the OOoBean() method is that its body is empty. In other
words, at this stage, the bean is not connected to Office.</p>
<p>paintComponent() draws the start-up message assigned in OBeanPanel(), which
remains visible until the document is loaded and drawn over that area:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the OBeanPanel class</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">paintComponent</span><span class="p">(</span><span class="n">Graphics</span> <span class="n">g</span><span class="p">)</span>
<span class="c1">// display a message while OOoBean is loaded/unloaded</span>
<span class="p">{</span>
  <span class="kd">super</span><span class="p">.</span><span class="na">paintComponent</span><span class="p">(</span><span class="n">g</span><span class="p">);</span>
  <span class="n">Graphics2D</span> <span class="n">g2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Graphics2D</span><span class="p">)</span> <span class="n">g</span><span class="p">;</span>
  <span class="n">g2</span><span class="p">.</span><span class="na">setRenderingHint</span><span class="p">(</span><span class="n">RenderingHints</span><span class="p">.</span><span class="na">KEY_ANTIALIASING</span><span class="p">,</span>
                      <span class="n">RenderingHints</span><span class="p">.</span><span class="na">VALUE_ANTIALIAS_ON</span><span class="p">);</span>

  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">pWidth</span> <span class="o">-</span> <span class="n">fontMetric</span><span class="p">.</span><span class="na">stringWidth</span><span class="p">(</span><span class="n">message</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHeight</span> <span class="o">-</span> <span class="n">fontMetric</span><span class="p">.</span><span class="na">getHeight</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

  <span class="n">g2</span><span class="p">.</span><span class="na">setColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">BLUE</span><span class="p">);</span>
  <span class="n">g2</span><span class="p">.</span><span class="na">setFont</span><span class="p">(</span><span class="n">msgFont</span><span class="p">);</span>
  <span class="n">g2</span><span class="p">.</span><span class="na">drawString</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of paintComponent()</span>
</code></pre></div>
<p>Figure 4 shows the message before a document is loaded.</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-4.png" /></p>
<p>Figure 4. The OBeanPanel without a Document.</p>
<p>The buttons along the right-hand side of Figure 4 and the fields at the bottom are part
of the SwingViewer.java application described later. OBeanPanel manages the large
white rectangle with the "Waiting for Officeâ€¦" text.</p>
<p>OBeanPanel.loadDoc() calls OOoBean.loadFromURL() to start Office and load and
display the document:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the OBeanPanel class</span>
<span class="c1">//globals</span>
<span class="kd">private</span> <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


<span class="kd">public</span> <span class="n">XComponent</span> <span class="nf">loadDoc</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span> <span class="o">=</span> <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;ReadOnly&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="k">try</span>  <span class="p">{</span>
    <span class="n">String</span> <span class="n">fileURL</span> <span class="o">=</span> <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>
    <span class="n">oob</span><span class="p">.</span><span class="na">loadFromURL</span><span class="p">(</span><span class="n">fileURL</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>  <span class="c1">// real work done here!</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">setOOoBean</span><span class="p">(</span><span class="n">oob</span><span class="p">);</span>   <span class="c1">// initialize Lo class so</span>
                          <span class="c1">// support classes are useable</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">getDoc</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">docType</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">reportDocType</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">BASE</span><span class="p">)</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="n">getFrame</span><span class="p">(),</span> <span class="s">&quot;DBViewTables&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
                              <span class="c1">// switch to tables view in Base docs</span>

    <span class="n">XLayoutManager</span> <span class="n">lm</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getLayoutManager</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">lm</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>  <span class="c1">// hide all toolbars</span>

    <span class="c1">// add mouse click &amp; key handlers to the doc</span>
    <span class="n">XUserInputInterception</span> <span class="n">uii</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getUII</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">uii</span><span class="p">.</span><span class="na">addMouseClickHandler</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="n">uii</span><span class="p">.</span><span class="na">addKeyHandler</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="n">revalidate</span><span class="p">();</span>   <span class="c1">// needs a refresh to appear</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>  <span class="p">}</span>

  <span class="k">return</span> <span class="n">doc</span><span class="p">;</span>
<span class="p">}</span>   <span class="c1">// end of loadDoc()</span>
</code></pre></div>
<p>OOoBean.loadFromURL()'s two arguments are the document's URL and a
"ReadOnly" property since the bean is being used as a viewer.</p>
<p>I want to keep using my support classes, which require the setting of four global
variables in the Lo class. They are normally initialized by Lo.loadOffice() and
Lo.openDoc(), but are copied from OOoBean by Lo.setOOoBean() in this case.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="c1">//globals</span>
<span class="c1">// remote component context</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XComponentContext</span> <span class="n">xcc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">// remote desktop UNO service</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XDesktop</span> <span class="n">xDesktop</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">// remote service managers</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XMultiComponentFactory</span> <span class="n">mcFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">XMultiServiceFactory</span> <span class="n">msFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


<span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">&quot;deprecation&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setOOoBean</span><span class="p">(</span><span class="n">OOoBean</span> <span class="n">oob</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">OfficeConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">oob</span><span class="p">.</span><span class="na">getOOoConnection</span><span class="p">();</span>
               <span class="c1">// the OfficeConnection class is deprecated</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">conn</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No office connection found in OOoBean&quot;</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">xcc</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">getComponentContext</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">xcc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No component context in OOoBean&quot;</span><span class="p">);</span>
      <span class="k">else</span>
        <span class="n">mcFactory</span> <span class="o">=</span> <span class="n">xcc</span><span class="p">.</span><span class="na">getServiceManager</span><span class="p">();</span>

      <span class="n">xDesktop</span> <span class="o">=</span> <span class="n">oob</span><span class="p">.</span><span class="na">getOOoDesktop</span><span class="p">();</span>
      <span class="n">msFactory</span> <span class="o">=</span> <span class="n">oob</span><span class="p">.</span><span class="na">getMultiServiceFactory</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t init LO using OOoBean: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of setOOoBean()</span>
</code></pre></div>
<p>The suppressed warning annotation stops the Java compiler complaining about
OOoBean's deprecated OfficeConnection class.</p>
<p>Back in OBeanPanel.loadDoc(), a reference to the loaded document is retrieved by
calling OBeanPanel.getDoc():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the OBeanPanel class</span>
<span class="kd">public</span> <span class="n">XComponent</span> <span class="nf">getDoc</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XModel</span> <span class="n">xModel</span> <span class="o">=</span> <span class="p">(</span><span class="n">XModel</span><span class="p">)</span><span class="n">oob</span><span class="p">.</span><span class="na">getDocument</span><span class="p">();</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span> <span class="n">XComponent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xModel</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;OOBean document could not be accessed&quot;</span><span class="p">);</span>  <span class="p">}</span>
  <span class="k">return</span> <span class="n">doc</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getDoc()</span>
</code></pre></div>
<p>OOoBean contains many deprecated methods that affect the visibility of Office's
menu bar, standard bar, tools bar, and status bar. The preferred, and more powerful,
approach is to use the LayoutManager service, which is accessed with
GUI.getLayoutManager():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the GUI class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XLayoutManager</span> <span class="nf">getLayoutManager</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XLayoutManager</span> <span class="n">lm</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XPropertySet</span> <span class="n">propSet</span> <span class="o">=</span>
             <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPropertySet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">getFrame</span><span class="p">(</span><span class="n">doc</span><span class="p">));</span>
    <span class="n">lm</span> <span class="o">=</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span> <span class="n">XLayoutManager</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                <span class="n">propSet</span><span class="p">.</span><span class="na">getPropertyValue</span><span class="p">(</span><span class="s">&quot;LayoutManager&quot;</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access layout manager&quot;</span><span class="p">);</span>  <span class="p">}</span>
  <span class="k">return</span> <span class="n">lm</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getLayoutManager()</span>
</code></pre></div>
<p>The XLayoutManager reference is stored in the "LayoutManager" property of the
document's frame. All the toolbars known to the layout manager can be hidden with a
call to XLayoutManager.setVisible():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of loadDoc()...</span>
<span class="n">XLayoutManager</span> <span class="n">lm</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getLayoutManager</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">lm</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>  <span class="c1">// hide all toolbars</span>
</code></pre></div>
<p>loadDoc() also assigns the monitoring of the keyboard and mouse to OBeanPanel:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of loadDoc()...</span>
<span class="n">XUserInputInterception</span> <span class="n">uii</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getUII</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">uii</span><span class="p">.</span><span class="na">addMouseClickHandler</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="n">uii</span><span class="p">.</span><span class="na">addKeyHandler</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</code></pre></div>
<p>The mouse methods don't do much:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the OBeanPanel class</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">mousePressed</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">awt</span><span class="p">.</span><span class="na">MouseEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mouse pressed (&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">X</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">Y</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>    <span class="c1">// send event on, or use true not to send</span>
<span class="p">}</span>


<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">mouseReleased</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">awt</span><span class="p">.</span><span class="na">MouseEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mouse released (&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">X</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">Y</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Unlike Java listeners, these Office handlers return a boolean to indicate whether the
event should be passed on to other listeners; false means the event should be sent on,
true causes it to be consumed.</p>
<p>The key release handler is similarly short, but the key press handler deals with a
keyboard focus bug:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the OBeanPanel class</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">keyReleased</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">awt</span><span class="p">.</span><span class="na">KeyEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>


<span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">&quot;deprecation&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">keyPressed</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">awt</span><span class="p">.</span><span class="na">KeyEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">oob</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">oob</span><span class="p">.</span><span class="na">releaseSystemWindow</span><span class="p">();</span>
           <span class="c1">// force focus away from bean;</span>
           <span class="c1">// must suppress deprecation warning</span>
    <span class="n">oob</span><span class="p">.</span><span class="na">aquireSystemWindow</span><span class="p">();</span>

    <span class="c1">// Impress redisplays toolbars; remove them again</span>
    <span class="n">XLayoutManager</span> <span class="n">lm</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getLayoutManager</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">lm</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;LeftPaneImpress&quot;</span><span class="p">,</span>
                <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;LeftPaneImpress&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span> <span class="p">);</span>
                <span class="c1">// hide slides pane</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of keyPressed()</span>
</code></pre></div>
<p>keyPressed() calls OOoBean.releaseSystemWindow() and then
OOoBean.aquireSystemWindow() to force the bean to release the keyboard focus;
this allows the user to select and type text into other text fields, such as the page jump
field in the SwingViewer.java example described below. I found this trick in a forum
post by Martin Illguth at
<a href="https://forum.openoffice.org/en/forum/viewtopic.php?f=20&amp;t=63008">https://forum.openoffice.org/en/forum/viewtopic.php?f=20&amp;t=63008</a>.</p>
<p>keyPressed() also deals with a side-effect of displaying Impress slides â€“ clicking on a
slide inside the bean causes hidden toolbars and the slides pane to be made visible.
Another call to the layout manager deals with the toolbars, but the slides pane, which
isn't a toolbar, is hidden with a ".uno:LeftPaneImpress" dispatch.</p>
<h2 id="3-using-the-obeanpanel">3.  Using the OBeanPanel<a class="headerlink" href="#3-using-the-obeanpanel" title="Permanent link">&para;</a></h2>
<p>Figure 4 shows SwingViewer.java at start-up; the buttons on the right are for quickly
moving through a multi-page (or multi-slide) document, and for zooming in and out
on a document. The controls at the bottom show the number of pages (or slides) in the
document, and allow the user to jump to a specified page/slide number. Figure 5
shows the controls in close-up.</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-5.png" /></p>
<p>Figure 5. The Buttons and Page Controls in SwingViewer.</p>
<p>Aside from text documents and slide decks, SwingViewer can load Draw, Calc, and
Base files; Figure 6 shows a sample.</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-6.jpg" /></p>
<p>Figure 6. Different Documents Displayed by SwingViewer.</p>
<p>The SwingViewer constructor is passed the document's filename, creates an
OBeanPanel in a JFrame with buttons and other controls, and loads the document:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// globals</span>
<span class="kd">private</span> <span class="n">OBeanPanel</span> <span class="n">officePanel</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">docType</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">UNKNOWN</span><span class="p">;</span>


<span class="kd">public</span> <span class="nf">SwingViewer</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kd">super</span><span class="p">(</span><span class="s">&quot;SwingViewer&quot;</span><span class="p">);</span>
  <span class="n">Container</span> <span class="n">c</span> <span class="o">=</span> <span class="n">getContentPane</span><span class="p">();</span>

  <span class="n">officePanel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OBeanPanel</span><span class="p">(</span><span class="mi">850</span><span class="p">,</span> <span class="mi">600</span><span class="p">);</span>
                   <span class="c1">// OOoBean inside a JPanel</span>
  <span class="n">c</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">officePanel</span><span class="p">,</span> <span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">officePanel</span><span class="p">.</span><span class="na">getBean</span><span class="p">()</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;OOoBean not created&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">c</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">makeButtons</span><span class="p">(),</span> <span class="n">BorderLayout</span><span class="p">.</span><span class="na">EAST</span><span class="p">);</span>
  <span class="n">c</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">makePageControls</span><span class="p">(),</span> <span class="n">BorderLayout</span><span class="p">.</span><span class="na">SOUTH</span><span class="p">);</span>

  <span class="n">addWindowListener</span><span class="p">(</span><span class="k">new</span> <span class="n">WindowAdapter</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">windowClosing</span><span class="p">(</span><span class="n">WindowEvent</span> <span class="n">e</span><span class="p">){</span>
      <span class="n">officePanel</span><span class="p">.</span><span class="na">closeDown</span><span class="p">();</span>
      <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="n">pack</span><span class="p">();</span>
  <span class="n">setLocationRelativeTo</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>  <span class="c1">// center the window</span>
  <span class="n">setResizable</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="n">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>    <span class="c1">// give time for the OOBean to appear</span>

  <span class="n">doc</span> <span class="o">=</span> <span class="n">officePanel</span><span class="p">.</span><span class="na">loadDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">);</span>

  <span class="n">docType</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">reportDocType</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">officePanel</span><span class="p">.</span><span class="na">closeDown</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>

 <span class="c1">// initialize loaded document</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">WRITER</span><span class="p">)</span>
    <span class="n">initTextDoc</span><span class="p">();</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">IMPRESS</span><span class="p">)</span>
    <span class="n">initDrawDoc</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of SwingViewer()</span>
</code></pre></div>
<p>OOoBean termination is done by OBeanPanel.closeDown() in a window listener. It
calls OOoBean.stopOOoConnection(), but this sometimes hangs, so it also invokes
Lo.killOffice():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the OBeanPanel class</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">closeDown</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">oob</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Closing connection to office&quot;</span><span class="p">);</span>
    <span class="n">oob</span><span class="p">.</span><span class="na">stopOOoConnection</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>   <span class="c1">// wait for close down to finish</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">killOffice</span><span class="p">();</span>  <span class="c1">// make sure office processes are gone</span>
<span class="p">}</span>  <span class="c1">// end of closeDown()</span>
</code></pre></div>
<p>The loading of a Writer or Impress document causes several globals to be initialized
by initTextDoc() or initDrawDoc(). initTextDoc() stores the page count and creates a
visible text cursor for moving through the document's pages:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the SwingViewer class</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">pageCount</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">XTextViewCursor</span> <span class="n">tvCursor</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>   <span class="c1">// for text docs</span>


<span class="kd">private</span> <span class="kt">void</span> <span class="nf">initTextDoc</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// report the number of pages in the doc</span>
  <span class="n">XTextDocument</span> <span class="n">textDoc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextDocument</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="n">pageCount</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getPageCount</span><span class="p">(</span><span class="n">textDoc</span><span class="p">);</span>
  <span class="n">setLastPage</span><span class="p">(</span><span class="n">pageCount</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>  <span class="c1">// get the document&#39;s visible cursor</span>
    <span class="n">XController</span> <span class="n">xc</span> <span class="o">=</span> <span class="n">officePanel</span><span class="p">.</span><span class="na">getController</span><span class="p">();</span>
    <span class="n">XTextViewCursorSupplier</span> <span class="n">tvcSupplier</span> <span class="o">=</span>
                  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextViewCursorSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xc</span><span class="p">);</span>
    <span class="n">tvCursor</span> <span class="o">=</span> <span class="n">tvcSupplier</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access document cursor&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of initTextDoc()</span>
</code></pre></div>
<p>initTextDoc() calls setLastPage() to write the pageCount value into the "Last Page"
field shown in Figure 5.</p>
<p>initDrawDoc() also initializes the global pageCount variable, but with the number of
slides in the document. However, instead of a text cursor, it create XDrawPages and
XDrawView instances for moving through the slides on-screen.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// globals</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">pageCount</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">XDrawView</span> <span class="n">xDrawView</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>     <span class="c1">// for slide docs</span>
<span class="kd">private</span> <span class="n">XDrawPages</span> <span class="n">xDrawPages</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


<span class="kd">private</span> <span class="kt">void</span> <span class="nf">initDrawDoc</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// report the number of slides in the doc</span>
    <span class="n">xDrawPages</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlides</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">pageCount</span> <span class="o">=</span> <span class="n">Draw</span><span class="p">.</span><span class="na">getSlidesCount</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">setLastPage</span><span class="p">(</span><span class="n">pageCount</span><span class="p">);</span>

    <span class="c1">// get a slide view</span>
    <span class="n">xDrawView</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDrawView</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">officePanel</span><span class="p">.</span><span class="na">getController</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access document pages&quot;</span><span class="p">);</span>  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of initDrawDoc()</span>
</code></pre></div>
<p>The globals are utilized when the user presses one of SwingViewer's button. For
example, clicking on the "Up" and "Down" buttons triggers calls to pageChange():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of SwingViewer.makeButtons()</span>
   <span class="p">:</span>
<span class="n">JButton</span> <span class="n">upButton</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JButton</span><span class="p">(</span><span class="s">&quot;Up&quot;</span><span class="p">);</span>
<span class="n">upButton</span><span class="p">.</span><span class="na">addActionListener</span><span class="p">(</span><span class="k">new</span> <span class="n">ActionListener</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="p">(</span><span class="n">ActionEvent</span> <span class="n">ev</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">pageChange</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>  <span class="p">}</span>   <span class="c1">// isDown is false, i.e. move up</span>
<span class="p">});</span>

<span class="n">JButton</span> <span class="n">downButton</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JButton</span><span class="p">(</span><span class="s">&quot;Down&quot;</span><span class="p">);</span>
<span class="n">downButton</span><span class="p">.</span><span class="na">addActionListener</span><span class="p">(</span><span class="k">new</span> <span class="n">ActionListener</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="p">(</span><span class="n">ActionEvent</span> <span class="n">ev</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">pageChange</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>  <span class="p">}</span>   <span class="c1">// isDown is true, i.e. move down</span>
<span class="p">});</span>
   <span class="p">:</span>
</code></pre></div>
<p>pageChange() uses the document's type to decide whether to change pages or slides:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">pageChange</span><span class="p">(</span><span class="kt">boolean</span> <span class="n">isDown</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">WRITER</span><span class="p">)</span>
    <span class="n">textChange</span><span class="p">(</span><span class="n">isDown</span><span class="p">);</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">IMPRESS</span><span class="p">)</span>
    <span class="n">slideChange</span><span class="p">(</span><span class="n">isDown</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of pageChange()</span>
</code></pre></div>
<p>textChange() utilizes the visible text cursor, while slideChange() uses the
XDrawPages and XDrawView variables. If the document isn't textual or a slide deck,
then pageChange() returns without doing anything.</p>
<h2 id="4-using-an-undecorated-office-window">4.  Using an Undecorated Office Window<a class="headerlink" href="#4-using-an-undecorated-office-window" title="Permanent link">&para;</a></h2>
<p>As I mentioned at the start, there are two ways of employing Office as a GUI
component: one is to use OOoBean inside a JPanel, as just explained. The other is to
have the program make Office visible on-screen, which I've done many times in
earlier examples. The main difference in my OffViewer.java example is that most of
Office's GUI is hidden, so the document appears in an undecorated window.</p>
<p>Figure 7 shows the five documents from Figure 6, this time loaded by OffViewer:</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-7.png" /></p>
<p>Figure 7. Different Documents Displayed by OffViewer.</p>
<p>There are a few differences between SwingViewer's display and OffViewer. For
instance, OffViewer uses some of Office's toolbars and tool panes, depending on the
document type. The "Find" bar is visible underneath the Writer, Draw, and Impress
documents, and the slide pane is present to the left of the current slide. The Draw,
Impress, and Calc documents also include a yellow pane along their tops containing a
button for enabling editing of the read-only document. I've not been able to find a way
to hide that pane.</p>
<p>The OffViewer constructor loads Office, loads the document, attaches listeners, and
displays some toolbars and panes depending on the document's type:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// global</span>
<span class="kd">private</span> <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


<span class="kd">public</span> <span class="nf">OffViewer</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openReadOnlyDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// attach listeners</span>
  <span class="n">doc</span><span class="p">.</span><span class="na">addEventListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="n">XWindow</span> <span class="n">win</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getWindow</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">win</span><span class="p">.</span><span class="na">addWindowListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="n">win</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>   <span class="c1">// give window time to appear</span>

  <span class="n">XUserInputInterception</span> <span class="n">uii</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getUII</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">uii</span><span class="p">.</span><span class="na">addMouseClickHandler</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="n">uii</span><span class="p">.</span><span class="na">addKeyHandler</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="c1">// modify UI visibility</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">showElems</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="n">showElems</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="na">FIND_BAR</span><span class="p">);</span>
  <span class="n">showElems</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="na">STATUS_BAR</span><span class="p">);</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">showOnly</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">showElems</span><span class="p">);</span>

  <span class="c1">// call dispatches *after* the window is visible</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;Sidebar&quot;</span><span class="p">,</span>
          <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;Sidebar&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">));</span>      <span class="c1">// hide sidebar</span>

  <span class="c1">// modify UI based on the document type</span>
  <span class="kt">int</span> <span class="n">docType</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">reportDocType</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">DRAW</span><span class="p">)</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;LeftPaneDraw&quot;</span><span class="p">,</span>
       <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;LeftPaneDraw&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span> <span class="p">);</span>  <span class="c1">// hide Pages pane</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">IMPRESS</span><span class="p">)</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;LeftPaneImpress&quot;</span><span class="p">,</span>
       <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;LeftPaneImpress&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="p">);</span><span class="c1">// show Slides pane</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">CALC</span><span class="p">)</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;InputLineVisible&quot;</span><span class="p">,</span>
       <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;InputLineVisible&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span> <span class="p">);</span>
                                                 <span class="c1">// hide formula bar</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">docType</span> <span class="o">==</span> <span class="n">Lo</span><span class="p">.</span><span class="na">BASE</span><span class="p">)</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;DBViewTables&quot;</span><span class="p">);</span>    <span class="c1">// switch to tables view</span>
<span class="p">}</span>  <span class="c1">// end of OffViewer()</span>
</code></pre></div>
<p>Several common toolbar resource names are defined as constants in the GUI class:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the GUI class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MENU_BAR</span> <span class="o">=</span>
                      <span class="s">&quot;private:resource/menubar/menubar&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">STATUS_BAR</span> <span class="o">=</span>
                      <span class="s">&quot;private:resource/statusbar/statusbar&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FIND_BAR</span> <span class="o">=</span>
                      <span class="s">&quot;private:resource/toolbar/findbar&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">STANDARD_BAR</span> <span class="o">=</span>
                      <span class="s">&quot;private:resource/toolbar/standardbar&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TOOL_BAR</span> <span class="o">=</span>
                      <span class="s">&quot;private:resource/toolbar/toolbar&quot;</span><span class="p">;</span>
</code></pre></div>
<p>A lengthy list of all the toolbars in LibreOffice is stored in TOOLBAR_NMS[] in
GUI.java, and can be accessed by calling GUI.getToobarResource() with a partial
string; the first matching toolbar resource name is returned. For example:
GUI.getToobarResource("zoom");
returns the string "private:resource/toolbar/zoombar".</p>
<p>The visibility of Office's toolbars is managed by the LayoutManager service as
before, but in a somewhat more complex way because OffViewer can both hide and
show toolbars.</p>
<p>GUI.showOnly() hides all the toolbars accessible to the layout manager, except for
those in its showElems argument. The difficulty is that some of these visible toolbars
may not currently exist, and so need to be created and then made visible.</p>
<p>GUI.showOnly() is:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the GUI class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showOnly</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span>
                                   <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">showElems</span><span class="p">)</span>
<span class="c1">// leave only the toolbars in showElems visible</span>
<span class="p">{</span>
  <span class="n">XLayoutManager</span> <span class="n">lm</span> <span class="o">=</span> <span class="n">getLayoutManager</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">lm</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No layout manager found&quot;</span><span class="p">);</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">XUIElement</span><span class="o">[]</span> <span class="n">uiElems</span> <span class="o">=</span> <span class="n">lm</span><span class="p">.</span><span class="na">getElements</span><span class="p">();</span>
    <span class="n">hideExcept</span><span class="p">(</span><span class="n">lm</span><span class="p">,</span> <span class="n">uiElems</span><span class="p">,</span> <span class="n">showElems</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">elemName</span> <span class="p">:</span> <span class="n">showElems</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// these elems are not in lm</span>
      <span class="n">lm</span><span class="p">.</span><span class="na">createElement</span><span class="p">(</span><span class="n">elemName</span><span class="p">);</span>  <span class="c1">// so need to be created &amp; shown</span>
      <span class="n">lm</span><span class="p">.</span><span class="na">showElement</span><span class="p">(</span><span class="n">elemName</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">elemName</span> <span class="o">+</span> <span class="s">&quot; made visible&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of showOnly()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">hideExcept</span><span class="p">(</span><span class="n">XLayoutManager</span> <span class="n">lm</span><span class="p">,</span>
           <span class="n">XUIElement</span><span class="o">[]</span> <span class="n">uiElems</span><span class="p">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">showElems</span><span class="p">)</span>
<span class="c1">// hide all of uiElems toolbars, except ones in showElems;</span>
<span class="c1">// delete any showElems toolbar strings that match</span>
<span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="n">XUIElement</span> <span class="n">uiElem</span> <span class="p">:</span> <span class="n">uiElems</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">elemName</span> <span class="o">=</span> <span class="n">uiElem</span><span class="p">.</span><span class="na">getResourceURL</span><span class="p">();</span>
    <span class="kt">boolean</span> <span class="n">toHide</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="n">i</span> <span class="o">&lt;</span> <span class="n">showElems</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">showElems</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="na">equals</span><span class="p">(</span><span class="n">elemName</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">showElems</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                     <span class="c1">// this elem is in lm so remove from showElems</span>
        <span class="n">toHide</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>       <span class="c1">// since the toolbar is already shown</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">toHide</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">lm</span><span class="p">.</span><span class="na">hideElement</span><span class="p">(</span><span class="n">elemName</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">elemName</span> <span class="o">+</span> <span class="s">&quot; hidden&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of hideExcept()</span>
</code></pre></div>
<p>GUI.showOnly() hides toolbars by calling hideExcept(), which calls
XLayoutManager.hideElement() on all the layout manager's toolbars except ones in
the showElems list, which are meant to stay visible. If a showElems toolbar is left
unhidden then its name is deleted from the list because it's not needed in the next step
back in GUI.showOnly()</p>
<p>When hideExcept() returns, showOnly() iterates through the remaining toolbars in
showElems which are there because they were  unknown to the layout manager.Each
of these toolbars must be created (with XLayoutManager.createElement()) before
being made visible by XLayoutManager.showElement().</p>
<p>In OffViewer, several tool panes, such as the slides pane in Impress, have to be
enabled or disabled, but they're not accessible through the layout manager. Instead, I
use dispatch commands which only work if the Office window is visible and active.</p>
<p>I couldn't find any documentation about dispatch commands for UI panes, but it
appears that a pane can be made visible or invisible by including its name as a
property with the value true or false. For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;LeftPaneImpress&quot;</span><span class="p">,</span>
      <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;LeftPaneImpress&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="p">);</span> <span class="c1">// show Slides pane</span>
</code></pre></div>
<p>This call sends a ".uno:LeftPanelImpress" dispatch to Office to make the slides pane
visible.</p>
<p>The easiest way to find dispatch names is to browse through the long list at
<a href="https://wiki.documentfoundation.org/Development/DispatchCommands">https://wiki.documentfoundation.org/Development/DispatchCommands</a>. It's divided
into application and tool subcategories, which narrows the search a little. Also, each
entry includes a "Label value" field which for UI elements (i.e. toolbars, panes, and
menus) corresponds to its name in Office's GUI.</p>
<p>Another approach is to search Office's source code â€“ dispatches are defined inside
".xcu" files, and the UI related files are mostly in the subdirectory
<OFFICE>\officecfg\registry\schema\org\openoffice\Office\UI.</p>
<h4 id="listening-to-user-input-and-the-window">Listening to User Input and the Window<a class="headerlink" href="#listening-to-user-input-and-the-window" title="Permanent link">&para;</a></h4>
<p>OffViewer implements four listeners for mouse presses, keyboard handling, window
changes, and document events:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OffViewer</span> <span class="kd">implements</span>
               <span class="n">XMouseClickHandler</span><span class="p">,</span> <span class="n">XKeyHandler</span><span class="p">,</span> <span class="n">XWindowListener</span><span class="p">,</span>
               <span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">document</span><span class="p">.</span><span class="na">XEventListener</span>
<span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</code></pre></div>
<p>The listeners are attached in the constructor for OffViewer, which implements all the
methods itself:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of OffViewer()...</span>
<span class="n">doc</span><span class="p">.</span><span class="na">addEventListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

<span class="n">XWindow</span> <span class="n">win</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getWindow</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">win</span><span class="p">.</span><span class="na">addWindowListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="n">win</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>

<span class="n">XUserInputInterception</span> <span class="n">uii</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getUII</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">uii</span><span class="p">.</span><span class="na">addMouseClickHandler</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="n">uii</span><span class="p">.</span><span class="na">addKeyHandler</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</code></pre></div>
<p>The event listener's disposing() method is triggered as the document is closed, and
uses Lo.killOffice() to terminate Office. As with SwingViewer.java, only calling
Lo.closeOffice() is insufficient, causing Office to hang.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the OffViewer class</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">disposing</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">EventObject</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document is closing&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="c1">// Lo.closeOffice();   // Office hangs, so kill it instead</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">killOffice</span><span class="p">();</span>
  <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>The window, mouse, and keyboard handlers print simple information:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// XWindow listener methods</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">windowShown</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">EventObject</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Doc window has become visible&quot;</span><span class="p">);</span>  <span class="p">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">windowHidden</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">EventObject</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Doc window has been hidden&quot;</span><span class="p">);</span>  <span class="p">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">windowResized</span><span class="p">(</span><span class="n">WindowEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Resized to &quot;</span> <span class="o">+</span><span class="n">e</span><span class="p">.</span><span class="na">Width</span> <span class="o">+</span><span class="s">&quot; x &quot;</span> <span class="o">+</span><span class="n">e</span><span class="p">.</span><span class="na">Height</span><span class="p">);</span> <span class="p">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">windowMoved</span><span class="p">(</span><span class="n">WindowEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Moved to (&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">X</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">Y</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>  <span class="p">}</span>


<span class="c1">// XMouseClickHandler methods</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">mousePressed</span><span class="p">(</span><span class="n">MouseEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mouse pressed (&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">X</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">Y</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>    <span class="c1">// send event on, or use true not to send</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">mouseReleased</span><span class="p">(</span><span class="n">MouseEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mouse released (&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">X</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">Y</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// XKeyHandler methods</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">keyPressed</span><span class="p">(</span><span class="n">KeyEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Key pressed: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">KeyCode</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">KeyChar</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">keyReleased</span><span class="p">(</span><span class="n">KeyEvent</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Key released: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">KeyCode</span> <span class="o">+</span><span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">KeyChar</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>The mouse handlers allow their events to be used by other handlers (i.e. they return
false), but the keyboard handlers consume their inputs.</p>
<h2 id="5-augmenting-the-user-interface-a-new-toolbar-item">5.  Augmenting the User Interface: a New Toolbar Item<a class="headerlink" href="#5-augmenting-the-user-interface-a-new-toolbar-item" title="Permanent link">&para;</a></h2>
<p>TBViewer.java is a variant of OffViewer which adds a toolbar item called "Hello" to
the "Find" toolbar, as shown in Figure 8 on the left.</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-8.png" /></p>
<p>Figure 8. The "Find" Toolbar with the "Hello" Item.</p>
<p>When the user clicks on "Hello", ToolbarItemListener is woken up, and its clicked()
method called. clicked() displays a message box (see Figure 9).</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-9.png" /></p>
<p>Figure 9. The Message Box that Appears when "Hello" is Clicked.</p>
<p>This toolbar extension technique is similar to Office's Add-ons, which I'll be
discussing in Chapter 46. However, the item isn't permanently added to the toolbar,
existing only while TBViewer is executing.</p>
<p>The TBViewer constructor:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// global</span>
<span class="kd">private</span> <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


<span class="kd">public</span> <span class="nf">TBViewer</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openReadOnlyDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XWindow</span> <span class="n">win</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getWindow</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">win</span><span class="p">.</span><span class="na">addWindowListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="n">win</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>   <span class="c1">// give window time to appear</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">showOne</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">GUI</span><span class="p">.</span><span class="na">FIND_BAR</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;Sidebar&quot;</span><span class="p">,</span>
          <span class="n">Props</span><span class="p">.</span><span class="na">makeProps</span><span class="p">(</span><span class="s">&quot;Sidebar&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">));</span>    <span class="c1">// hide sidebar</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">addItemToToolbar</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">GUI</span><span class="p">.</span><span class="na">FIND_BAR</span><span class="p">,</span> <span class="s">&quot;Hello&quot;</span><span class="p">,</span> <span class="s">&quot;h.png&quot;</span><span class="p">);</span>

  <span class="c1">// add an dispatch interceptor for the &quot;Hello&quot; item</span>
  <span class="n">XDispatchProviderInterception</span> <span class="n">dpi</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getDPI</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dpi</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">dpi</span><span class="p">.</span><span class="na">registerDispatchProviderInterceptor</span><span class="p">(</span>
                         <span class="k">new</span> <span class="n">ItemInterceptor</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s">&quot;Hello&quot;</span><span class="p">));</span>
<span class="p">}</span>  <span class="c1">// end of TBViewer()</span>

<span class="n">GUI</span><span class="p">.</span><span class="na">showOne</span><span class="p">()</span> <span class="n">utilizes</span> <span class="n">GUI</span><span class="p">.</span><span class="na">showOnly</span><span class="p">()</span> <span class="n">to</span> <span class="n">leave</span> <span class="n">only</span> <span class="n">the</span> <span class="s">&quot;Find&quot;</span> <span class="n">toolbar</span> <span class="n">visible</span><span class="p">:</span>

<span class="c1">// in the GUI class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showOne</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span> <span class="n">String</span> <span class="n">showElem</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">showElems</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="n">showElems</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">showElem</span><span class="p">);</span>
  <span class="n">showOnly</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">showElems</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of showOne()</span>
</code></pre></div>
<p>GUI.addItemToToolbar() creates the toolbar item:
GUI.addItemToToolbar(doc, GUI.FIND_BAR, "Hello", "h.png");
Its arguments are the document, the toolbar's resource name, the item name, and the
filename of an image icon.</p>
<p>A dispatch interceptor (an ItemInterceptor object) is registered to catch clicks
(dispatches) on the "Hello" item, and redirect them to TBViewer:</p>
<div class="highlight"><pre><span></span><code><span class="n">XDispatchProviderInterception</span> <span class="n">dpi</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getDPI</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">dpi</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
  <span class="n">dpi</span><span class="p">.</span><span class="na">registerDispatchProviderInterceptor</span><span class="p">(</span>
                       <span class="k">new</span> <span class="n">ItemInterceptor</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s">&quot;Hello&quot;</span><span class="p">));</span>
</code></pre></div>
<p>ItemInterceptor processes each click by calling ToolbarItemListener.clicked() which
is implemented by TBViewer as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the TBViewer class</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">clicked</span><span class="p">(</span><span class="n">String</span> <span class="n">itemName</span><span class="p">,</span> <span class="n">URL</span> <span class="n">cmdURL</span><span class="p">,</span>
                                     <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span><span class="p">)</span>
<span class="p">{</span> <span class="n">GUI</span><span class="p">.</span><span class="na">showMessageBox</span><span class="p">(</span><span class="s">&quot;Item Dialog&quot;</span><span class="p">,</span> <span class="s">&quot;Processing the \&quot;&quot;</span> <span class="o">+</span>
                                        <span class="n">itemName</span> <span class="o">+</span> <span class="s">&quot;\&quot; command&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of clicked()</span>
</code></pre></div>
<h3 id="51-intercepting-dispatches">5.1.  Intercepting Dispatches<a class="headerlink" href="#51-intercepting-dispatches" title="Permanent link">&para;</a></h3>
<p>ItemInterceptor implements XDispatchProviderInterceptor and XDispatch so it can
both intercept dispatches and process them:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ItemInterceptor</span> <span class="kd">implements</span>
                     <span class="n">XDispatchProviderInterceptor</span><span class="p">,</span> <span class="n">XDispatch</span>
<span class="p">{</span>
  <span class="kd">private</span> <span class="n">XDispatchProvider</span> <span class="n">slaveDP</span><span class="p">,</span> <span class="n">masterDP</span><span class="p">;</span>
        <span class="c1">// pointers to next and previous dispatch providers in list</span>

  <span class="kd">private</span> <span class="n">ToolbarItemListener</span> <span class="n">viewer</span><span class="p">;</span>   <span class="c1">// object sent dispatch info</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">itemName</span><span class="p">;</span>  <span class="c1">// toolbar item name</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">cmd</span><span class="p">;</span>       <span class="c1">// toolbar item&#39;s dispatch command</span>


  <span class="kd">public</span> <span class="nf">ItemInterceptor</span><span class="p">(</span><span class="n">ToolbarItemListener</span> <span class="n">v</span><span class="p">,</span> <span class="n">String</span> <span class="n">itemName</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">viewer</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
     <span class="k">this</span><span class="p">.</span><span class="na">itemName</span> <span class="o">=</span> <span class="n">itemName</span><span class="p">;</span>
     <span class="n">cmd</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">makeUnoCmd</span><span class="p">(</span><span class="n">itemName</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// : more XDispatchProviderInterceptor and XDispatch methods;</span>
  <span class="c1">// : see below</span>

<span class="p">}</span>  <span class="c1">// end of ItemInterceptor class</span>
</code></pre></div>
<p>The ItemInterceptor() arguments are a reference to ToolbarItemListener (which
implements clicked()), and the toolbar item name ("Hello") which is converted into a
UNO command string by Lo.makeUnoCmd():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">makeUnoCmd</span><span class="p">(</span><span class="n">String</span> <span class="n">itemName</span><span class="p">)</span>
<span class="c1">// use a dummy Java class name, Foo</span>
<span class="p">{</span>  <span class="k">return</span> <span class="s">&quot;vnd.sun.star.script:Foo/Foo.&quot;</span> <span class="o">+</span> <span class="n">itemName</span> <span class="o">+</span>
                         <span class="s">&quot;?language=Java&amp;location=share&quot;</span><span class="p">;</span>  <span class="p">}</span>
</code></pre></div>
<p>The returned command string is mostly make-believe â€“ there's no
vnd.sun.star.script:Foo/Foo class, but that doesn't matter so long as the string is
unique, and matches the command string in the toolbar item (which is set up by
GUI.addItemToToolbar(), as shown below).</p>
<p>Office adds the ItemInterceptor object to an interceptors list, which is doubly-linked
so that each node points to the previous (master) and next (slave) list element. These
are accessible through get/set master/slave methods:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in ItemInterceptor class</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMasterDispatchProvider</span><span class="p">(</span><span class="n">XDispatchProvider</span> <span class="n">dp</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">masterDP</span> <span class="o">=</span> <span class="n">dp</span><span class="p">;</span>  <span class="p">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSlaveDispatchProvider</span><span class="p">(</span><span class="n">XDispatchProvider</span> <span class="n">dp</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">slaveDP</span> <span class="o">=</span> <span class="n">dp</span><span class="p">;</span>  <span class="p">}</span>

<span class="kd">public</span> <span class="n">XDispatchProvider</span> <span class="nf">getMasterDispatchProvider</span><span class="p">()</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">masterDP</span><span class="p">;</span>  <span class="p">}</span>

<span class="kd">public</span> <span class="n">XDispatchProvider</span> <span class="nf">getSlaveDispatchProvider</span><span class="p">()</span>
<span class="p">{</span>  <span class="k">return</span> <span class="n">slaveDP</span><span class="p">;</span>  <span class="p">}</span>
</code></pre></div>
<p>XDispatchProviderInterceptor also requires implementations for queryDispatches()
and queryDispatch(). queryDispatches() iterates through the array of dispatch
descriptors passed to it, and calls queryDispatch() on each one:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in ItemInterceptor class</span>
<span class="kd">public</span> <span class="n">XDispatch</span><span class="o">[]</span> <span class="nf">queryDispatches</span><span class="p">(</span><span class="n">DispatchDescriptor</span><span class="o">[]</span> <span class="n">descrs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">descrs</span><span class="p">.</span><span class="na">length</span><span class="p">;</span>
  <span class="n">XDispatch</span><span class="o">[]</span> <span class="n">xDispatch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XDispatch</span><span class="o">[</span><span class="n">count</span><span class="o">]</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">xDispatch</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">queryDispatch</span><span class="p">(</span><span class="n">descrs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">FeatureURL</span><span class="p">,</span>
                                 <span class="n">descrs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">FrameName</span><span class="p">,</span>
                                 <span class="n">descrs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">SearchFlags</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">xDispatch</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of queryDispatches()</span>
</code></pre></div>
<p>If the dispatch passed to queryDispatch() is recognized by this interceptor then an
XDispatch object is returned; otherwise the dispatch is sent to the next interceptor in
the list:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in ItemInterceptor class</span>
<span class="kd">public</span> <span class="n">XDispatch</span> <span class="nf">queryDispatch</span><span class="p">(</span><span class="n">URL</span> <span class="n">cmdURL</span><span class="p">,</span> <span class="n">String</span> <span class="n">target</span><span class="p">,</span>
                               <span class="kt">int</span> <span class="n">srchFlags</span><span class="p">)</span>
<span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">cmdURL</span><span class="p">.</span><span class="na">Complete</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>  <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">itemName</span> <span class="o">+</span> <span class="s">&quot; seen&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>   <span class="c1">// this will cause dispatch() to be called</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">slaveDP</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">slaveDP</span><span class="p">.</span><span class="na">queryDispatch</span><span class="p">(</span><span class="n">cmdURL</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">srchFlags</span><span class="p">);</span>
      <span class="c1">// pass command to next interceptor in list</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of queryDispatch()</span>
</code></pre></div>
<p>Office processes the returned XDispatch object by calling its dispatch() method,
which is implemented by ItemInterceptor:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in ItemInterceptor class</span>
<span class="c1">// global</span>
<span class="kd">private</span> <span class="n">ToolbarItemListener</span> <span class="n">viewer</span><span class="p">;</span>   <span class="c1">// object sent dispatch info</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">dispatch</span><span class="p">(</span><span class="n">URL</span> <span class="n">cmdURL</span><span class="p">,</span> <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">props</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">viewer</span><span class="p">.</span><span class="na">clicked</span><span class="p">(</span><span class="n">itemName</span><span class="p">,</span> <span class="n">cmdURL</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>  <span class="p">}</span>
</code></pre></div>
<p>Control is passed to the listener's clicked() method, which is in TBViewer.</p>
<p>For more information on dispatch interception, see chapter 6 of the Developer's
Guide, which is also online at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/OfficeDev/Dispatch_Interception">https://wiki.openoffice.org/wiki/Documentation/DevGuide/OfficeDev/Dispatch_Interception</a>
(or use <code>loGuide "Dispatch Interception"</code>).</p>
<h3 id="52-displaying-a-message-box">5.2.  Displaying a Message Box<a class="headerlink" href="#52-displaying-a-message-box" title="Permanent link">&para;</a></h3>
<p>TBViewer's clicked() creates an Office message dialog (see Figure 10) by calling
GUI.showMessageBox(). This dialog requires some complicated coding, and you may
wonder why I didn't just use Java's dialogs. For example, as in
GUI.showJMessageBox():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the GUI class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showJMessageBox</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="n">String</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">JOptionPane</span><span class="p">.</span><span class="na">showMessageDialog</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                          <span class="n">JOptionPane</span><span class="p">.</span><span class="na">INFORMATION_MESSAGE</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>I did try this, and it works fine most of the time, but sometimes the dialog appears
behind Office's window, and so is hidden from the user. The problem lies with the
null first argument of JOptionPane.showMessageDialog() which leaves the dialog's
parent window unspecified.</p>
<p>An Office message dialog is created in two main steps, as shown in
GUI.showMessageBox():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the GUI class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showMessageBox</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="n">String</span> <span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XToolkit</span> <span class="n">xToolkit</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XToolkit</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                                  <span class="s">&quot;com.sun.star.awt.Toolkit&quot;</span><span class="p">);</span>
  <span class="n">XWindow</span> <span class="n">xWindow</span> <span class="o">=</span> <span class="n">getWindow</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">xToolkit</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">xWindow</span> <span class="o">==</span> <span class="kc">null</span><span class="p">))</span>
    <span class="k">return</span><span class="p">;</span>

  <span class="n">XWindowPeer</span> <span class="n">xPeer</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XWindowPeer</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xWindow</span><span class="p">);</span>

  <span class="c1">// initialize window description</span>
  <span class="n">WindowDescriptor</span> <span class="n">desc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WindowDescriptor</span><span class="p">();</span>
  <span class="n">desc</span><span class="p">.</span><span class="na">Type</span> <span class="o">=</span> <span class="n">WindowClass</span><span class="p">.</span><span class="na">MODALTOP</span><span class="p">;</span>
  <span class="n">desc</span><span class="p">.</span><span class="na">WindowServiceName</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="s">&quot;infobox&quot;</span><span class="p">);</span>
  <span class="n">desc</span><span class="p">.</span><span class="na">ParentIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">desc</span><span class="p">.</span><span class="na">Parent</span> <span class="o">=</span> <span class="n">xPeer</span><span class="p">;</span>
  <span class="n">desc</span><span class="p">.</span><span class="na">Bounds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
  <span class="n">desc</span><span class="p">.</span><span class="na">WindowAttributes</span> <span class="o">=</span> <span class="n">WindowAttribute</span><span class="p">.</span><span class="na">BORDER</span> <span class="o">|</span>
                          <span class="n">WindowAttribute</span><span class="p">.</span><span class="na">MOVEABLE</span> <span class="o">|</span>
                          <span class="n">WindowAttribute</span><span class="p">.</span><span class="na">CLOSEABLE</span><span class="p">;</span>

  <span class="c1">// create message box using the description</span>
  <span class="n">XWindowPeer</span> <span class="n">descPeer</span> <span class="o">=</span> <span class="n">xToolkit</span><span class="p">.</span><span class="na">createWindow</span><span class="p">(</span><span class="n">desc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">descPeer</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">XMessageBox</span> <span class="n">msgBox</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XMessageBox</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">descPeer</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">msgBox</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">msgBox</span><span class="p">.</span><span class="na">setCaptionText</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
      <span class="n">msgBox</span><span class="p">.</span><span class="na">setMessageText</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
      <span class="n">msgBox</span><span class="p">.</span><span class="na">execute</span><span class="p">();</span>   <span class="c1">// show the box</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of showMessageBox()</span>
</code></pre></div>
<p>A WindowDescriptor object is initialized to specify the type of window that will be
created, including its parent (the Office window). The descriptor is used to create a
XWindowPeer object, which is converted into an XMessageBox.</p>
<h3 id="53-adding-hello-to-the-toolbar">5.3.  Adding "Hello" to the Toolbar<a class="headerlink" href="#53-adding-hello-to-the-toolbar" title="Permanent link">&para;</a></h3>
<p>GUI.addItemToToolbar() adds the "Hello" item to the "Find" toolbar:</p>
<div class="highlight"><pre><span></span><code><span class="n">GUI</span><span class="p">.</span><span class="na">addItemToToolbar</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">GUI</span><span class="p">.</span><span class="na">FIND_BAR</span><span class="p">,</span> <span class="s">&quot;Hello&quot;</span><span class="p">,</span> <span class="s">&quot;h.png&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The code:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the GUI class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addItemToToolbar</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">,</span>
                          <span class="n">String</span> <span class="n">toolbarName</span><span class="p">,</span>
                          <span class="n">String</span> <span class="n">itemName</span><span class="p">,</span> <span class="n">String</span> <span class="n">imFnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">makeUnoCmd</span><span class="p">(</span><span class="n">itemName</span><span class="p">);</span>
  <span class="n">XUIConfigurationManager</span> <span class="n">confMan</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getUIConfigManagerDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">confMan</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Cannot create configuration manager&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// add icon for the command</span>
    <span class="n">XImageManager</span> <span class="n">imageMan</span> <span class="o">=</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XImageManager</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                                   <span class="n">confMan</span><span class="p">.</span><span class="na">getImageManager</span><span class="p">());</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">cmds</span> <span class="o">=</span> <span class="p">{</span><span class="n">cmd</span><span class="p">};</span>
    <span class="n">XGraphic</span><span class="o">[]</span> <span class="n">pics</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XGraphic</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
    <span class="n">pics</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">Images</span><span class="p">.</span><span class="na">loadGraphicFile</span><span class="p">(</span><span class="n">imFnm</span><span class="p">);</span>
    <span class="n">imageMan</span><span class="p">.</span><span class="na">insertImages</span><span class="p">((</span><span class="kt">short</span><span class="p">)</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmds</span><span class="p">,</span> <span class="n">pics</span><span class="p">);</span>

    <span class="c1">// add item to toolbar</span>
    <span class="n">XIndexAccess</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">confMan</span><span class="p">.</span><span class="na">getSettings</span><span class="p">(</span><span class="n">toolbarName</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="n">XIndexContainer</span> <span class="n">conSettings</span> <span class="o">=</span>
                            <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XIndexContainer</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">settings</span><span class="p">);</span>
    <span class="n">PropertyValue</span><span class="o">[]</span> <span class="n">itemProps</span> <span class="o">=</span> <span class="n">Props</span><span class="p">.</span><span class="na">makeBarItem</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">itemName</span><span class="p">);</span>
    <span class="n">conSettings</span><span class="p">.</span><span class="na">insertByIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">itemProps</span><span class="p">);</span>
                           <span class="c1">// place first in the toolbar</span>
    <span class="n">confMan</span><span class="p">.</span><span class="na">replaceSettings</span><span class="p">(</span><span class="n">toolbarName</span><span class="p">,</span> <span class="n">conSettings</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of addItemToToolbar()</span>
</code></pre></div>
<p>It accesses the toolbar with XUIConfigurationManager. A toolbar item is created (as
an array of properties), and added to the bar at the specified index position.</p>
<p>The icon that should be drawn next to "Hello" on the toolbar is loaded by
XImageManager. As Figure 8 shows, this image doesn't appear, although it has been
loaded since it's listed in the "Visible Buttons" window in Figure 10.</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-10.png" /></p>
<p>Figure 10. The "Visible Buttons" Window for the Toolbar.</p>
<h2 id="6-augmenting-the-user-interface-a-new-menu-item">6.  Augmenting the User Interface: a New Menu Item<a class="headerlink" href="#6-augmenting-the-user-interface-a-new-menu-item" title="Permanent link">&para;</a></h2>
<p>MenuViewer.java is a variant of OffViewer which either adds a menu at the end of
Office's menubar (see Figure 11a), or creates a new menubar for the menu (see Figure
11b).</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-11.png" /></p>
<p>Figure 11.  Adding an Item to a Menubar.</p>
<p>The same menu is created in both cases, and is shown in pop-down form in Figure 12.</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-12.png" /></p>
<p>Figure 12. The "My_menu" Menu.</p>
<p>The menu includes a "Hello" item with an icon, "Quit" for quitting Office, and some
radio button and checkbox items that do nothing. When "Hello" is clicked, the same
Office message box appears as in Figure 10.</p>
<p>The MenuViewer constructor creates a new menubar (see Figure 11b), but contains
commented out code for adding the menu to Office's menubar (as in Figure 11a):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in MenuViewer.java</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="kt">short</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// used for menu IDs</span>


<span class="kd">public</span> <span class="nf">MenuViewer</span><span class="p">(</span><span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openReadOnlyDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XWindow</span> <span class="n">win</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getWindow</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">win</span><span class="p">.</span><span class="na">addWindowListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="n">win</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>   <span class="c1">// wait for window to appear</span>


  <span class="c1">// create new menubar</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">showNone</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>  <span class="c1">// hide all toolbars</span>
  <span class="n">makeMenubar</span><span class="p">(</span><span class="n">win</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">  // or modify the existing menubar</span>
<span class="cm">  GUI.showOne(doc, GUI.MENU_BAR);</span>
<span class="cm">             // hide all toolbars except the menubar</span>
<span class="cm">  setMenubar(doc);</span>
<span class="cm">*/</span>
<span class="p">}</span>  <span class="c1">// end of MenuViewer()</span>
</code></pre></div>
<p>This MenuViewer example is based on one in the "Creating Menus" section at the end
of chapter 19, "Graphical user Interfaces", in the Developer's Guide; it can be found
online at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/GUI/Creating_Menus">https://wiki.openoffice.org/wiki/Documentation/DevGuide/GUI/Creating_Menus</a> (or
use <code>loGuide "Creating Menus"</code>). The corresponding code is at
<a href="https://api.libreoffice.org/examples/DevelopersGuide/examples.html#GraphicalUserInterfaces">https://api.libreoffice.org/examples/DevelopersGuide/examples.html#GraphicalUserInterfaces</a>,
and includes the use of a context menu, which I don't consider here.</p>
<h3 id="61-creating-a-new-menubar">6.1.  Creating a New Menubar<a class="headerlink" href="#61-creating-a-new-menubar" title="Permanent link">&para;</a></h3>
<p>makeMenubar() attaches an XMenubar instance to the Office window using
XTopWindow.setMenuBar():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in MenuViewer.java</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">makeMenubar</span><span class="p">(</span><span class="n">XWindow</span> <span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XTopWindow</span> <span class="n">topWin</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTopWindow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">win</span><span class="p">);</span>
  <span class="n">XMenuBar</span> <span class="n">menubar</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XMenuBar</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                                       <span class="s">&quot;com.sun.star.awt.MenuBar&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">menubar</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not create a menu bar&quot;</span><span class="p">);</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">addMenu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">topWin</span><span class="p">.</span><span class="na">setMenuBar</span><span class="p">(</span><span class="n">menubar</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of makeMenubar()</span>
</code></pre></div>
<p>addMenu() labels the menu, which is generated by makePopupMenu():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in MenuViewer.java</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="kt">short</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// used for menu IDs</span>


<span class="kd">private</span> <span class="kt">void</span> <span class="nf">addMenu</span><span class="p">(</span><span class="n">XMenuBar</span> <span class="n">bar</span><span class="p">,</span> <span class="kt">short</span> <span class="n">mPos</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">short</span> <span class="n">menuID</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
  <span class="n">bar</span><span class="p">.</span><span class="na">insertItem</span><span class="p">(</span><span class="n">menuID</span><span class="p">,</span> <span class="s">&quot;My ~Menu&quot;</span><span class="p">,</span>
                         <span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">AUTOCHECK</span><span class="p">,</span> <span class="n">mPos</span><span class="p">);</span>
  <span class="n">id</span><span class="o">++</span><span class="p">;</span>
  <span class="n">bar</span><span class="p">.</span><span class="na">setPopupMenu</span><span class="p">(</span><span class="n">menuID</span><span class="p">,</span> <span class="n">makePopupMenu</span><span class="p">());</span>
                          <span class="c1">// add menu to menubar</span>
<span class="p">}</span>  <span class="c1">// end of addMenu()</span>
</code></pre></div>
<p>The three important menu interfaces are shown in Figure 13.</p>
<p><img alt="" src="images/44-Office_as_GUI_Comp-13.png" /></p>
<p>Figure 13. The Menu Services and Interfaces.</p>
<p>Although addMenu() initializes an XMenuBar instance, the interface doesn't contain
any methods, inheriting its functionality from XMenu, as indicated in Figure 13.</p>
<p>The menu methods, such as XMenu.insertItem() used by addMenu(), can be a little
confusing because of their use of shorts in different ways. Every menu and menu item
is assigned an ID, which is useful in listener code for identifying which item was
clicked. In my code, each menu ID is initialized using a global id variable, which is
incremented after each use.</p>
<p>Every menu and item also uses a position short value which determines where the
menu appears in the bar, and where an item appears in the menu. For example,
addMenu() is called by makeMenubar() with a position value set to 0, which will
place the menu first on the bar.</p>
<p>The third use of short is as MenuItemStyle constants, which specify behavior for
menu items acting as check and radio boxes.</p>
<h4 id="creating-the-menu">Creating the Menu<a class="headerlink" href="#creating-the-menu" title="Permanent link">&para;</a></h4>
<p>The menu in Figure 12 is created by makePopupMenu():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in MenuViewer.java</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CMD_HELLO</span> <span class="o">=</span> <span class="s">&quot;Cmd_Hello&quot;</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CMD_QUIT</span> <span class="o">=</span> <span class="s">&quot;Cmd_Quit&quot;</span><span class="p">;</span>

<span class="kd">private</span> <span class="kt">short</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// used for menu IDs</span>


<span class="kd">public</span> <span class="n">XPopupMenu</span> <span class="nf">makePopupMenu</span><span class="p">()</span>
<span class="cm">/* Popup menu consists of:</span>
<span class="cm">            * Hello + image</span>
<span class="cm">            * three radio buttons (only one on)</span>
<span class="cm">            * a separator</span>
<span class="cm">            * two check boxes</span>
<span class="cm">            * Quit</span>
<span class="cm">*/</span>
<span class="p">{</span> <span class="n">XPopupMenu</span> <span class="n">pum</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createInstanceMCF</span><span class="p">(</span><span class="n">XPopupMenu</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                                 <span class="s">&quot;com.sun.star.awt.PopupMenu&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">pum</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not create a menu&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">short</span> <span class="n">mPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">pum</span><span class="p">.</span><span class="na">insertItem</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s">&quot;Hello&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="mi">0</span><span class="p">,</span> <span class="n">mPos</span><span class="o">++</span><span class="p">);</span>
      <span class="c1">// first short is an ID for the new menu item;</span>
      <span class="c1">// the second is the style for the item, 0 means none/ordinary;</span>
      <span class="c1">// the third is the items&#39; position on the menu</span>

  <span class="n">pum</span><span class="p">.</span><span class="na">setItemImage</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">Images</span><span class="p">.</span><span class="na">loadGraphicFile</span><span class="p">(</span><span class="s">&quot;H.png&quot;</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
  <span class="n">pum</span><span class="p">.</span><span class="na">setCommand</span><span class="p">(</span><span class="n">id</span><span class="o">++</span><span class="p">,</span> <span class="n">CMD_HELLO</span><span class="p">);</span>

  <span class="n">pum</span><span class="p">.</span><span class="na">insertItem</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s">&quot;First Radio&quot;</span><span class="p">,</span>
             <span class="p">(</span><span class="kt">short</span><span class="p">)</span> <span class="p">(</span><span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">RADIOCHECK</span> <span class="o">+</span>
                      <span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">AUTOCHECK</span><span class="p">),</span> <span class="n">mPos</span><span class="o">++</span><span class="p">);</span>
  <span class="n">pum</span><span class="p">.</span><span class="na">enableItem</span><span class="p">(</span><span class="n">id</span><span class="o">++</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>   <span class="c1">// grayed out</span>

  <span class="n">pum</span><span class="p">.</span><span class="na">insertItem</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s">&quot;Second Radio&quot;</span><span class="p">,</span>
             <span class="p">(</span><span class="kt">short</span><span class="p">)</span> <span class="p">(</span><span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">RADIOCHECK</span> <span class="o">+</span>
                      <span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">AUTOCHECK</span><span class="p">),</span> <span class="n">mPos</span><span class="o">++</span><span class="p">);</span>
  <span class="n">pum</span><span class="p">.</span><span class="na">checkItem</span><span class="p">(</span><span class="n">id</span><span class="o">++</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>  <span class="c1">// selected</span>

  <span class="n">pum</span><span class="p">.</span><span class="na">insertItem</span><span class="p">(</span><span class="n">id</span><span class="o">++</span><span class="p">,</span> <span class="s">&quot;Third Radio&quot;</span><span class="p">,</span>
             <span class="p">(</span><span class="kt">short</span><span class="p">)</span> <span class="p">(</span><span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">RADIOCHECK</span> <span class="o">+</span>
                      <span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">AUTOCHECK</span><span class="p">),</span> <span class="n">mPos</span><span class="o">++</span><span class="p">);</span>

  <span class="n">pum</span><span class="p">.</span><span class="na">insertSeparator</span><span class="p">(</span><span class="n">mPos</span><span class="o">++</span><span class="p">);</span>

  <span class="n">pum</span><span class="p">.</span><span class="na">insertItem</span><span class="p">(</span><span class="n">id</span><span class="o">++</span><span class="p">,</span> <span class="s">&quot;Check 1&quot;</span><span class="p">,</span>
             <span class="p">(</span><span class="kt">short</span><span class="p">)</span> <span class="p">(</span><span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">CHECKABLE</span> <span class="o">+</span>
                      <span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">AUTOCHECK</span><span class="p">),</span> <span class="n">mPos</span><span class="o">++</span><span class="p">);</span>

  <span class="n">pum</span><span class="p">.</span><span class="na">insertItem</span><span class="p">(</span><span class="n">id</span><span class="o">++</span><span class="p">,</span> <span class="s">&quot;Check 2&quot;</span><span class="p">,</span>
             <span class="p">(</span><span class="kt">short</span><span class="p">)</span> <span class="p">(</span><span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">CHECKABLE</span> <span class="o">+</span>
                      <span class="n">MenuItemStyle</span><span class="p">.</span><span class="na">AUTOCHECK</span><span class="p">),</span> <span class="n">mPos</span><span class="o">++</span><span class="p">);</span>

  <span class="n">pum</span><span class="p">.</span><span class="na">insertItem</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s">&quot;Quit&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="mi">0</span><span class="p">,</span> <span class="n">mPos</span><span class="o">++</span><span class="p">);</span>
  <span class="n">pum</span><span class="p">.</span><span class="na">setCommand</span><span class="p">(</span><span class="n">id</span><span class="o">++</span><span class="p">,</span> <span class="n">CMD_QUIT</span><span class="p">);</span>

  <span class="n">pum</span><span class="p">.</span><span class="na">addMenuListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">pum</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of makePopupMenu()</span>
</code></pre></div>
<p>Ordinary menu items (in my case, "Hello" and "Quit") are assigned a style value of 0.</p>
<p>Menu items activation by the user are detected by attaching a listener to the menu.
When an item is pressed, an event containing its ID is sent to the listener. Optionally
items can be assigned command strings (as for the "Hello" and "Quit" items) to better
distinguish them.</p>
<p>MenuViewer.java implements XMenuListener, which requires four methods â€“
itemSelected(), itemHighlighted(), itemActivated(), and itemDeactivated(). Only
itemSelected() does anything of note:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in MenuViewer.java</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">itemSelected</span><span class="p">(</span><span class="n">MenuEvent</span> <span class="n">menuEvent</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">short</span> <span class="n">id</span> <span class="o">=</span> <span class="n">menuEvent</span><span class="p">.</span><span class="na">MenuId</span><span class="p">;</span>
  <span class="n">XPopupMenu</span> <span class="n">pum</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPopupMenu</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">menuEvent</span><span class="p">.</span><span class="na">Source</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">pum</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Menu item &quot;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span>
                            <span class="s">&quot; selected; popupmenu is null&quot;</span><span class="p">);</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">itemName</span> <span class="o">=</span> <span class="n">pum</span><span class="p">.</span><span class="na">getItemText</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">pum</span><span class="p">.</span><span class="na">getCommand</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Menu item \&quot;&quot;</span> <span class="o">+</span> <span class="n">pum</span><span class="p">.</span><span class="na">getItemText</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span>
                                  <span class="s">&quot;\&quot; selected&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  is checked? &quot;</span> <span class="o">+</span> <span class="n">pum</span><span class="p">.</span><span class="na">isItemChecked</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
    <span class="n">processCmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of itemSelected()</span>


<span class="kd">public</span> <span class="kt">void</span> <span class="nf">itemHighlighted</span><span class="p">(</span><span class="n">MenuEvent</span> <span class="n">menuEvent</span><span class="p">)</span>
<span class="p">{</span> <span class="c1">// System.out.println(menuEvent.MenuId + &quot; highlighted&quot;);</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">itemDeactivated</span><span class="p">(</span><span class="n">MenuEvent</span> <span class="n">menuEvent</span><span class="p">)</span>
<span class="p">{</span> <span class="c1">// System.out.println(menuEvent.MenuId + &quot; deactivated&quot;);</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">itemActivated</span><span class="p">(</span><span class="n">MenuEvent</span> <span class="n">menuEvent</span><span class="p">)</span>
<span class="p">{</span> <span class="c1">// System.out.println(menuEvent.MenuId + &quot; activated&quot;);</span>
<span class="p">}</span>

<span class="n">Each</span> <span class="n">MenuEvent</span> <span class="n">object</span> <span class="n">includes</span> <span class="n">the</span> <span class="n">menu</span> <span class="n">item</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">ID</span> <span class="n">and</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">its</span> <span class="n">menu</span><span class="p">,</span>
<span class="n">which</span> <span class="n">are</span> <span class="n">accessed</span> <span class="n">at</span> <span class="n">the</span> <span class="n">start</span> <span class="n">of</span> <span class="nf">itemSelected</span><span class="p">():</span>

<span class="kt">short</span> <span class="n">id</span> <span class="o">=</span> <span class="n">menuEvent</span><span class="p">.</span><span class="na">MenuId</span><span class="p">;</span>
<span class="n">XPopupMenu</span> <span class="n">pum</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPopupMenu</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">menuEvent</span><span class="p">.</span><span class="na">Source</span><span class="p">);</span>

<span class="n">itemSelected</span><span class="p">()</span> <span class="n">uses</span> <span class="n">the</span> <span class="n">ID</span> <span class="n">and</span> <span class="n">menu</span> <span class="n">to</span> <span class="n">access</span> <span class="n">details</span><span class="p">,</span> <span class="n">including</span> <span class="n">the</span> <span class="n">menu</span> <span class="n">item</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">label</span>
<span class="n">and</span> <span class="n">command</span> <span class="n">string</span><span class="p">.</span> <span class="n">Item</span> <span class="n">processing</span> <span class="n">is</span> <span class="n">handled</span> <span class="n">by</span> <span class="nf">processCmd</span><span class="p">():</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">processCmd</span><span class="p">(</span><span class="n">String</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">cmd</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span> <span class="n">cmd</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  No command&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">CMD_HELLO</span><span class="p">))</span>
    <span class="n">GUI</span><span class="p">.</span><span class="na">showMessageBox</span><span class="p">(</span><span class="s">&quot;Item Dialog&quot;</span><span class="p">,</span>
                       <span class="s">&quot;Processing the \&quot;Hello\&quot; command&quot;</span><span class="p">);</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">CMD_QUIT</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  Quiting the Application&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>   <span class="c1">// will trigger a call to disposing()</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  Got command: &quot;</span> <span class="o">+</span> <span class="n">cmd</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of processCmd()</span>
</code></pre></div>
<p>Clicking on "Hello" results in a call to GUI.showMessageBox() which was used
earlier in ItemViewer. Clicking on "Quit" causes the document to be closed by
Lo.closeDoc() which in turn triggers a call to XWindowListener.disposing() which
MenuViewer.java also implements:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in MenuViewer.java</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">disposing</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">EventObject</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Doc window is closing&quot;</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
   <span class="c1">// Lo.closeOffice();  // Office hangs, so kill it instead</span>
   <span class="n">Lo</span><span class="p">.</span><span class="na">killOffice</span><span class="p">();</span>
   <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="62-adding-to-the-existing-menubar">6.2.  Adding to the Existing Menubar<a class="headerlink" href="#62-adding-to-the-existing-menubar" title="Permanent link">&para;</a></h3>
<p>MenuViewer.java can be edited to add the menu to Office's menubar rather than
create a new one. The end of the constructor becomes:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// end of MenuViewer()...</span>
<span class="cm">/*</span>
<span class="cm">  // create new menu bar</span>
<span class="cm">  GUI.showNone(doc);</span>
<span class="cm">  makeMenubar(win);</span>
<span class="cm">*/</span>
  <span class="c1">// or modify the existing menubar</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">showOne</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">GUI</span><span class="p">.</span><span class="na">MENU_BAR</span><span class="p">);</span>
  <span class="n">setMenubar</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
</code></pre></div>
<p>setMenuBar() uses the layout manager to obtain a reference to Office's menubar, and
calculates a unique ID for the new menu and its position on the bar:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in MenuViewer.java</span>
<span class="c1">// globals</span>
<span class="kd">private</span> <span class="kt">short</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// used for menu IDs</span>


<span class="kd">private</span> <span class="kt">void</span> <span class="nf">setMenubar</span><span class="p">(</span><span class="n">XComponent</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XLayoutManager</span> <span class="n">lm</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getLayoutManager</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">XMenuBar</span> <span class="n">menubar</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getMenubar</span><span class="p">(</span><span class="n">lm</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">menubar</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Menubar not found&quot;</span><span class="p">);</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="kt">short</span> <span class="n">menuCount</span> <span class="o">=</span> <span class="n">menubar</span><span class="p">.</span><span class="na">getItemCount</span><span class="p">();</span>
            <span class="c1">// count along the menu bar to get no. of menus</span>
    <span class="kt">short</span> <span class="n">maxID</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">.</span><span class="na">getMenuMaxID</span><span class="p">(</span><span class="n">menubar</span><span class="p">);</span>
            <span class="c1">// find the largest menu item ID</span>
    <span class="n">id</span> <span class="o">=</span> <span class="p">(</span><span class="kt">short</span><span class="p">)(</span><span class="n">maxID</span> <span class="o">+</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="mi">100</span><span class="p">);</span>    <span class="c1">// hacky</span>
      <span class="cm">/* add a big number to account for the IDs used by</span>
<span class="cm">         menu items in the menu  */</span>

    <span class="n">addMenu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="n">menuCount</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of setMenubar()</span>
</code></pre></div>
<p>The XMenuBar reference is retrieved from a property in the XUIElement for the bar:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the GUI class</span>
<span class="c1">//globals</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MENU_BAR</span> <span class="o">=</span>
                         <span class="s">&quot;private:resource/menubar/menubar&quot;</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XMenuBar</span> <span class="nf">getMenubar</span><span class="p">(</span><span class="n">XLayoutManager</span> <span class="n">lm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">lm</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No layout manager available&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XMenuBar</span> <span class="n">bar</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XUIElement</span> <span class="n">oMenuBar</span> <span class="o">=</span> <span class="n">lm</span><span class="p">.</span><span class="na">getElement</span><span class="p">(</span><span class="n">GUI</span><span class="p">.</span><span class="na">MENU_BAR</span><span class="p">);</span>
    <span class="n">XPropertySet</span> <span class="n">props</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XPropertySet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">oMenuBar</span><span class="p">);</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XMenuBar</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
                            <span class="n">props</span><span class="p">.</span><span class="na">getPropertyValue</span><span class="p">(</span><span class="s">&quot;XMenuBar&quot;</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bar</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Menubar reference not found&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not access menubar&quot;</span><span class="p">);</span>  <span class="p">}</span>
  <span class="k">return</span> <span class="n">bar</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getMenubar()</span>
</code></pre></div>
<p>Back in setMenubar(), XMenuBar.getItemCount() returns the number of menus
already on the bar, which can be used as the position of the new menu.</p>
<p>Deciding on a unique menu ID is a little difficult since the IDs of all the items on the
existing menus, including submenus, should be examined. A simpler, and faster,
solution is implemented by GUI.getMenuMaxID(), which only finds the largest ID of
the menus (items in the menus aren't considered):</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the GUI class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">short</span> <span class="nf">getMenuMaxID</span><span class="p">(</span><span class="n">XMenuBar</span> <span class="n">bar</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">bar</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">short</span> <span class="n">itemCount</span> <span class="o">=</span> <span class="n">bar</span><span class="p">.</span><span class="na">getItemCount</span><span class="p">();</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No items in menu bar: &quot;</span> <span class="o">+</span> <span class="n">itemCount</span><span class="p">);</span>
  <span class="kt">short</span> <span class="n">maxID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">short</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">itemCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">short</span> <span class="n">id</span> <span class="o">=</span>  <span class="n">bar</span><span class="p">.</span><span class="na">getItemId</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">&gt;</span> <span class="n">maxID</span><span class="p">)</span>
      <span class="n">maxID</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">maxID</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getMenuMaxID()</span>
</code></pre></div>
<p>The drawback is that the menu with the largest ID will probably contain some items
with larger IDs. setMenubar() deals with this by adding 100 to the ID returned by
getMenuMaxID(), in the hope that this exceeds the largest item ID.</p>
<p>setMenubar() finished with a call to addMenu(), the same function used by
makeMenubar() from earlier; it creates the menu and adds it to the bar.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="43-Using_the_Clipboard.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 43. Using the Clipboard" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 43. Using the Clipboard
            </div>
          </div>
        </a>
      
      
        
        <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-footer__link md-footer__link--next" aria-label="Next: Part 8 Extending LibreOffice" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Part 8 Extending LibreOffice
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>