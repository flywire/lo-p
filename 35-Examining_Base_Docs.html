
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
      
        <link rel="canonical" href="https://flywire.github.io/lo-p/35-Examining_Base_Docs.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Chapter 35. Examining Base Documents - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-35-examining-base-documents" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 35. Examining Base Documents
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05-Text_API_Overview.html" class="md-nav__link">
        Chapter 5. Text API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 35. Examining Base Documents
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="35-Examining_Base_Docs.html" class="md-nav__link md-nav__link--active">
        Chapter 35. Examining Base Documents
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-querying-an-embedded-hsqldb-database" class="md-nav__link">
    1.  Querying an Embedded HSQLDB Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-using-metadata-when-querying-a-base-document" class="md-nav__link">
    2.  Using Metadata when Querying a Base Document
  </a>
  
    <nav class="md-nav" aria-label="2.  Using Metadata when Querying a Base Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-the-datasource-service" class="md-nav__link">
    2.1.  The DataSource Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-the-databasedefinition-services" class="md-nav__link">
    2.2.  The DatabaseDefinition Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-the-databasemetadata-service" class="md-nav__link">
    2.3.  The DatabaseMetaData Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-the-resultsetmetadata-service" class="md-nav__link">
    2.4.  The ResultSetMetaData Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-debugging-database-code" class="md-nav__link">
    3.  Debugging Database Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-a-base-document" class="md-nav__link">
    4.  Creating a Base Document
  </a>
  
    <nav class="md-nav" aria-label="4.  Creating a Base Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viewing-database-creation" class="md-nav__link">
    Viewing Database Creation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-processing-multiple-sql-commands" class="md-nav__link">
    5.  Processing Multiple SQL Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-displaying-table-relationships" class="md-nav__link">
    6.  Displaying Table Relationships
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-prepared-statements" class="md-nav__link">
    7.  Prepared Statements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-scrollable-and-updatable-result-sets" class="md-nav__link">
    8.  Scrollable and Updatable Result Sets
  </a>
  
    <nav class="md-nav" aria-label="8.  Scrollable and Updatable Result Sets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-a-firebird-date-bug" class="md-nav__link">
    8.1.  A Firebird Date Bug
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-using-a-scrollable-result-set" class="md-nav__link">
    8.2.  Using a Scrollable Result Set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-using-an-updatable-result-set" class="md-nav__link">
    8.3.  Using an Updatable Result Set
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-converting-a-database-to-text" class="md-nav__link">
    9.  Converting a Database to Text
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-querying-an-embedded-hsqldb-database" class="md-nav__link">
    1.  Querying an Embedded HSQLDB Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-using-metadata-when-querying-a-base-document" class="md-nav__link">
    2.  Using Metadata when Querying a Base Document
  </a>
  
    <nav class="md-nav" aria-label="2.  Using Metadata when Querying a Base Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-the-datasource-service" class="md-nav__link">
    2.1.  The DataSource Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-the-databasedefinition-services" class="md-nav__link">
    2.2.  The DatabaseDefinition Services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-the-databasemetadata-service" class="md-nav__link">
    2.3.  The DatabaseMetaData Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-the-resultsetmetadata-service" class="md-nav__link">
    2.4.  The ResultSetMetaData Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-debugging-database-code" class="md-nav__link">
    3.  Debugging Database Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-a-base-document" class="md-nav__link">
    4.  Creating a Base Document
  </a>
  
    <nav class="md-nav" aria-label="4.  Creating a Base Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#viewing-database-creation" class="md-nav__link">
    Viewing Database Creation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-processing-multiple-sql-commands" class="md-nav__link">
    5.  Processing Multiple SQL Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-displaying-table-relationships" class="md-nav__link">
    6.  Displaying Table Relationships
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-prepared-statements" class="md-nav__link">
    7.  Prepared Statements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-scrollable-and-updatable-result-sets" class="md-nav__link">
    8.  Scrollable and Updatable Result Sets
  </a>
  
    <nav class="md-nav" aria-label="8.  Scrollable and Updatable Result Sets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-a-firebird-date-bug" class="md-nav__link">
    8.1.  A Firebird Date Bug
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-using-a-scrollable-result-set" class="md-nav__link">
    8.2.  Using a Scrollable Result Set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-using-an-updatable-result-set" class="md-nav__link">
    8.3.  Using an Updatable Result Set
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-converting-a-database-to-text" class="md-nav__link">
    9.  Converting a Database to Text
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/flywire/lo-p/edit/main/docs/35-Examining_Base_Docs.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="chapter-35-examining-base-documents">Chapter 35. Examining Base Documents<a class="headerlink" href="#chapter-35-examining-base-documents" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>Querying an
Embedded HSQLDB
Database; Using
Metadata when
Querying; Debugging
Database Code; Creating
a Base Document;
Processing Multiple
SQL Commands;
Displaying Table
Relationships; Prepared
Statements; Scrollable
and Updatable Result
Sets; Converting a
Database to Text</p>
<p>Example folders: "Base
Tests" and "Utils"</p>
</div>
<p>This chapter looks at programming with Base documents
using the XOfficeDatabaseDocument interface, which was
labelled with a (1) in Figure 5 of the previous chapter.</p>
<p>Figure 1 repeats that figure but without the alternative
query approaches (labels (2), (3), and (4)).</p>
<p><img alt="" src="images/35-Examining_Base_Docs-1.png" /></p>
<p>Figure 1.  Querying a Base Document.</p>
<p>XOfficeDatabaseDocument accesses a database via the ODB document that's
connected to the database. The connection can take two forms â€“ the database can be
embedded inside the ODB file, or the connection can be a URL which links to an
external database. Most of my examples will utilize ODB files that contain embedded
databases.</p>
<h2 id="1-querying-an-embedded-hsqldb-database">1.  Querying an Embedded HSQLDB Database<a class="headerlink" href="#1-querying-an-embedded-hsqldb-database" title="Permanent link">&para;</a></h2>
<p>The following SimpleQuery.java example shows how to query a HSQLDB database
embedded inside an ODB file called liangTables.odb. It has three tables, called
Course, Enrollment, and Student. Figure 2 shows the data in the Course table,
displayed by Base. The filename reflects the fact that the database is based on one in
Y. Daniel Liang's "Introduction to Java Programming" textbook.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-2.png" /></p>
<p>Figure 2. The Course Table in liangTables.odb.</p>
<p>Although SimpleQuery.java only queries liangTables.odb, the support methods it
utilizes are capable of accessing other kinds of ODB document, including ones
containing embedded Firebird databases, and database URLs.</p>
<p>The main() method for SimpleQuery.java is given below:</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FNM</span> <span class="o">=</span> <span class="s">&quot;liangTables.odb&quot;</span><span class="p">;</span>


<span class="c1">// in SimpleQuery.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">openBaseDoc</span><span class="p">(</span><span class="n">FNM</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dbDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open database &quot;</span> <span class="o">+</span> <span class="n">FNM</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>  <span class="c1">// no login/password</span>
    <span class="n">XStatement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>

    <span class="c1">// first query</span>
    <span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span>
          <span class="n">statement</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="s">&quot;SELECT * FROM \&quot;Course\&quot;&quot;</span><span class="p">);</span>

    <span class="n">XRow</span> <span class="n">xRow</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>

    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;CourseID \tSubjectID \tCourseNumber</span>
<span class="s">                                 \tTitle  \tNumOfCredits&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;=========================&quot;</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span> <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,   \t&quot;</span> <span class="o">+</span>
                          <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,   \t&quot;</span> <span class="o">+</span>
                          <span class="n">xRow</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,   \t&quot;</span> <span class="o">+</span>
                          <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,   &quot;</span> <span class="o">+</span>
                          <span class="n">xRow</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;=========================&quot;</span><span class="p">);</span>

    <span class="c1">// second query</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">statement</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span>
           <span class="s">&quot;SELECT \&quot;courseNumber\&quot;, \&quot;title\&quot; FROM \&quot;Course\&quot;&quot;</span><span class="p">);</span>
    <span class="n">xRow</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
    <span class="n">XColumnLocate</span> <span class="n">xLoc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span> <span class="n">XColumnLocate</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>

    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;CourseNumber \tTitle&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;====================================&quot;</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span>
            <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span> <span class="n">xLoc</span><span class="p">.</span><span class="na">findColumn</span><span class="p">(</span><span class="s">&quot;courseNumber&quot;</span><span class="p">))</span> <span class="o">+</span>
            <span class="s">&quot;,   \t&quot;</span> <span class="o">+</span>
            <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span> <span class="n">xLoc</span><span class="p">.</span><span class="na">findColumn</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">))</span> <span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;====================================&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Base</span><span class="p">.</span><span class="na">closeConnection</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
  <span class="n">Base</span><span class="p">.</span><span class="na">closeBaseDoc</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>The code is similar to the JDBC program described in the previous chapter, but uses
the sdbc interface, starting with XOfficeDatabaseDocument.</p>
<p>Base.openBaseDoc() loads the document as an instance of XComponent, then casts it
to XOfficeDatabaseDocument. The relationship between XOfficeDatabaseDocument
and XComponent is shown in Figure 3.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-3.png" /></p>
<p>Figure 3. Obtaining an OfficeDataBaseDocument Instance.</p>
<p>The Base.openBaseDoc() method:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XOfficeDatabaseDocument</span> <span class="nf">openBaseDoc</span><span class="p">(</span>
                        <span class="n">String</span> <span class="n">fnm</span><span class="p">,</span> <span class="n">XComponentLoader</span> <span class="n">loader</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document is null&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="na">reportDocType</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">BASE</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Not a database doc; closing &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// cast XComponent to XOfficeDatabaseDocument</span>
  <span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span> <span class="o">=</span>
             <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XOfficeDatabaseDocument</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dbDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Not a database doc; closing &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">dbDoc</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of openDoc()</span>
</code></pre></div>
<p>Database details, such as whether it's embedded inside or linked to the ODB file, and
its type (e.g. HSQLDB, Firebird), are stored in the DataSource service, which is
accessed by XOfficeDatabaseDocument.getDataSource():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in SimpleQuery.java...</span>
<span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
</code></pre></div>
<p>The simplest way of using the data source is to connect to the database by calling
getConnection():</p>
<div class="highlight"><pre><span></span><code><span class="n">XConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
                                     <span class="c1">// no login/password</span>
</code></pre></div>
<p>XConnection.createStatement() returns an XStatement reference, which can be used
to send SQL queries to the database. A query's result set is stored in an XResultSet
instance:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in SimpleQuery.java...</span>
<span class="n">XStatement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
<span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">statement</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="s">&quot;SELECT * FROM \&quot;Course\&quot;&quot;</span><span class="p">);</span>
</code></pre></div>
<p>Sdbc differs a little from JDBC in how the rows of a result set are examined. A row is
represented by a XRow instance which is a cast of XResultSet. However, the set's
cursor is still moved through the rows using XResultSet.next():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in SimpleQuery.java...</span>
<span class="n">XRow</span> <span class="n">xRow</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span> <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,   \t&quot;</span> <span class="o">+</span>
                      <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,   \t&quot;</span> <span class="o">+</span>
                      <span class="n">xRow</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>    <span class="o">+</span> <span class="s">&quot;,   \t&quot;</span> <span class="o">+</span>
                      <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,   &quot;</span> <span class="o">+</span>
                      <span class="n">xRow</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">);</span>
</code></pre></div>
<p>Access to data through XRow.getXXX() methods is only possible with column
indices. Column names can be used indirectly via XColumnLocate.findColumn()
which maps names to indices:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in SimpleQuery.java...</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">statement</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span>
       <span class="s">&quot;SELECT \&quot;courseNumber\&quot;, \&quot;title\&quot; FROM \&quot;Course\&quot;&quot;</span><span class="p">);</span>

<span class="n">xRow</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
<span class="n">XColumnLocate</span> <span class="n">xLoc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span> <span class="n">XColumnLocate</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;CourseNumber \tTitle&quot;</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;====================================&quot;</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span>
         <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span> <span class="n">xLoc</span><span class="p">.</span><span class="na">findColumn</span><span class="p">(</span><span class="s">&quot;courseNumber&quot;</span><span class="p">))</span> <span class="o">+</span>
         <span class="s">&quot;,   \t&quot;</span> <span class="o">+</span>
         <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span> <span class="n">xLoc</span><span class="p">.</span><span class="na">findColumn</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">))</span> <span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;====================================&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The output from SimpleQuery.java is shown in Figure 4.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-4.png" /></p>
<p>Figure 4. SimpleQuery.java Output.</p>
<p>The program ends by closing the connection to the database (with
Base.closeConnection()) and the ODB file (with Base.closeBaseDoc()). Both methods
cast their arguments to XCloseable, and then call XCloseable.close().</p>
<h2 id="2-using-metadata-when-querying-a-base-document">2.  Using Metadata when Querying a Base Document<a class="headerlink" href="#2-using-metadata-when-querying-a-base-document" title="Permanent link">&para;</a></h2>
<p>Metadata is information about a database, such as a table's schema, and driver and
database engine details. There are four sources of such information in the Base API:</p>
<ul>
<li>the DataSource service;</li>
<li>the DatabaseDefinition services;</li>
<li>the sdbc metadata services, DatabaseMetaData and ResultSetMetaData.</li>
</ul>
<p>SimpleQuery.java is hardwired to query the Course table in the liangTables.odb
database, and prints rather ugly looking output (see Figure 4). Both these issues can
be addressed by utilizing database metadata information, as in DBQuery.java
described next. I'll use the program to illustrate how the four metadata services can be
employed.</p>
<h3 id="21-the-datasource-service">2.1.  The DataSource Service<a class="headerlink" href="#21-the-datasource-service" title="Permanent link">&para;</a></h3>
<p>The DataSource service is depicted in Figure 5.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-5.png" /></p>
<p>Figure 5. The DataSource Service and Interface.</p>
<p>A simple way to access a data source's properties is with my Props.java utility class.
For example, the following code prints all of its properties:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of DBQuery.java...</span>
<span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span> <span class="o">=</span>  <span class="p">...</span> <span class="c1">// reference to a Base doc;</span>
<span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
<span class="n">Props</span><span class="p">.</span><span class="na">showObjProps</span><span class="p">(</span><span class="s">&quot;Data Source&quot;</span><span class="p">,</span> <span class="n">dataSource</span><span class="p">);</span>
</code></pre></div>
<p>This information includes the data source type (e.g. whether it is an embedded
HSQLDB or Firebird database), whether a password is required to access the tables,
and whether the database is read-only. My Base utility class includes several methods
that access this information individually. For example:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of DBQuery.java...</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Database type: &quot;</span> <span class="o">+</span>
                     <span class="n">Base</span><span class="p">.</span><span class="na">getDataSourceType</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">));</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Is embedded? &quot;</span> <span class="o">+</span> <span class="n">Base</span><span class="p">.</span><span class="na">isEmbedded</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">));</span>

<span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
<span class="n">Base</span><span class="p">.</span><span class="na">printDataSourceInfo</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Is password required: &quot;</span> <span class="o">+</span>
                     <span class="n">Base</span><span class="p">.</span><span class="na">isPasswordRequired</span><span class="p">(</span><span class="n">dataSource</span><span class="p">));</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Is read-only: &quot;</span> <span class="o">+</span> <span class="n">Base</span><span class="p">.</span><span class="na">isReadOnly</span><span class="p">(</span><span class="n">dataSource</span><span class="p">));</span>
</code></pre></div>
<p>For the liangTables.odb file, the listed details are:</p>
<div class="highlight"><pre><span></span><code><span class="n">Database</span> <span class="n">type</span><span class="p">:</span> <span class="n">sdbc</span><span class="p">:</span><span class="n">embedded</span><span class="p">:</span><span class="n">hsqldb</span>
<span class="n">Is</span> <span class="n">embedded</span><span class="o">?</span> <span class="kc">true</span>

<span class="n">Data</span> <span class="n">Source</span> <span class="n">Properties</span>
  <span class="n">Info</span> <span class="o">==</span> <span class="o">[</span><span class="n">Lcom</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">beans</span><span class="p">.</span><span class="na">PropertyValue</span><span class="p">;</span><span class="nd">@cf768c</span>
  <span class="n">IsPasswordRequired</span> <span class="o">==</span> <span class="kc">false</span>
  <span class="n">IsReadOnly</span> <span class="o">==</span> <span class="kc">false</span>
  <span class="c1">// ... many more lines</span>
  <span class="c1">// :</span>

<span class="n">Is</span> <span class="n">password</span> <span class="n">required</span><span class="p">:</span> <span class="kc">false</span>
<span class="n">Is</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="p">:</span> <span class="kc">false</span>
</code></pre></div>
<h3 id="22-the-databasedefinition-services">2.2.  The DatabaseDefinition Services<a class="headerlink" href="#22-the-databasedefinition-services" title="Permanent link">&para;</a></h3>
<p>After a database connection is established, metadata about the structure of the
database, its tables, columns, user and group permissions, becomes available. It's
accessible through services in the sdbcx module, starting from DatabaseDefinition
shown in Figure 6.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-6.png" /></p>
<p>Figure 6. Accessing Database MetaData via a Connection.</p>
<p>For example, Base.getTablesNames() casts an XConnection reference to a
XTablesSupplier, which gives access to information about the database's tables:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getTablesNames</span><span class="p">(</span><span class="n">XConnection</span> <span class="n">conn</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XTablesSupplier</span> <span class="n">tblsSupplier</span> <span class="o">=</span>
                    <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTablesSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
  <span class="n">XNameAccess</span> <span class="n">tables</span> <span class="o">=</span> <span class="n">tblsSupplier</span><span class="p">.</span><span class="na">getTables</span><span class="p">();</span>
  <span class="n">String</span><span class="o">[]</span> <span class="n">tableNms</span> <span class="o">=</span> <span class="n">tables</span><span class="p">.</span><span class="na">getElementNames</span><span class="p">();</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">tableNms</span><span class="p">));</span>
<span class="p">}</span>  <span class="c1">// end of getTablesNames()</span>
</code></pre></div>
<p>Base.getTablesNames() is called in DBQuery.java like so:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of DBQuery.java...</span>
<span class="n">XConnection</span> <span class="n">conn</span> <span class="o">=</span>
        <span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span> <span class="c1">// no login/password</span>

<span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">tableNames</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">getTablesNames</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No. of tables: &quot;</span> <span class="o">+</span> <span class="n">tableNames</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span> <span class="n">Arrays</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">tableNames</span><span class="p">.</span><span class="na">toArray</span><span class="p">()));</span>
</code></pre></div>
<p>The names of the three tables in liangTables.odb are reported as:</p>
<div class="highlight"><pre><span></span><code>No. of tables: 3
[Course, Enrollment, Student]
</code></pre></div>
<p>Just as XTablesSupplier is for supplying table information, there are similarly named
'Supplier' interfaces for retrieving details about the database's views, groups, and user
accounts. Base.displayTablesInfo() prints all of this information, but the output can be
very large if there are more than one or two tables in the database.</p>
<h3 id="23-the-databasemetadata-service">2.3.  The DatabaseMetaData Service<a class="headerlink" href="#23-the-databasemetadata-service" title="Permanent link">&para;</a></h3>
<p>Another way to obtain metadata is to utilize the JDBC-inspired XDatabaseMetaData
interface by calling XConnection.getMetaData():</p>
<div class="highlight"><pre><span></span><code><span class="n">XConnection</span> <span class="n">conn</span> <span class="o">=</span>  <span class="p">...</span> <span class="c1">// a connection to the database;</span>
<span class="n">XDatabaseMetaData</span> <span class="n">md</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">getMetaData</span><span class="p">();</span>
</code></pre></div>
<p>The metadata includes database engine and driver details, as reported by
Base.reportDBInfo():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">reportDBInfo</span><span class="p">(</span><span class="n">XConnection</span> <span class="n">conn</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XDatabaseMetaData</span> <span class="n">md</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">getMetaData</span><span class="p">();</span>

    <span class="n">String</span> <span class="n">productName</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="na">getDatabaseProductName</span><span class="p">();</span>
    <span class="n">String</span> <span class="n">productVersion</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="na">getDatabaseProductVersion</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">productName</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span> <span class="n">productName</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No database info found&quot;</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;DB:  &quot;</span> <span class="o">+</span> <span class="n">productName</span> <span class="o">+</span>
                              <span class="s">&quot; v.&quot;</span> <span class="o">+</span> <span class="n">productVersion</span><span class="p">);</span>

    <span class="n">String</span> <span class="n">driverName</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="na">getDriverName</span><span class="p">();</span>
    <span class="n">String</span> <span class="n">driverVersion</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="na">getDriverVersion</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">driverName</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span> <span class="n">driverName</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No driver info found&quot;</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;SDBC driver:  &quot;</span> <span class="o">+</span> <span class="n">driverName</span> <span class="o">+</span>
                                 <span class="s">&quot; v.&quot;</span> <span class="o">+</span> <span class="n">driverVersion</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of reportDBInfo()</span>
</code></pre></div>
<p>The output for liangTables.odb shows that it utilizes HSQLDB:</p>
<div class="highlight"><pre><span></span><code>DB:  HSQL Database Engine v.1.8.0
SDBC driver:  HSQL Database Engine Driver v.1.8.0
</code></pre></div>
<p>Unfortunately the XDatabaseMetaData methods don't return anything useful for
embedded Firebird databases. The output is:</p>
<div class="highlight"><pre><span></span><code>No database info found
No driver info found
</code></pre></div>
<p>However, data source metadata is available for Firebird via
Base.getDataSourceType():</p>
<div class="highlight"><pre><span></span><code><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Database type: &quot;</span> <span class="o">+</span>
                     <span class="n">Base</span><span class="p">.</span><span class="na">getDataSourceType</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">));</span>
</code></pre></div>
<p>For the same Firebird database, it reports:</p>
<div class="highlight"><pre><span></span><code>Database type: sdbc:embedded:firebird
</code></pre></div>
<p>This illustrates that the functionalities of the HSQLDB and Firebird engines aren't
identical, and that the DataSource (section 2.1) and DataDefinition services (section
2.2) may produce more information than the sdbc metadata approach (this section).</p>
<p>Base.reportSQLTypes() and Base.reportFunctionSupport() utilize
XDatabaseMetaData. The former returns a list of SQL types, and the latter a list of
functions supported by the database engine; their use is illustrated in DBQuery.java.</p>
<h3 id="24-the-resultsetmetadata-service">2.4.  The ResultSetMetaData Service<a class="headerlink" href="#24-the-resultsetmetadata-service" title="Permanent link">&para;</a></h3>
<p>XResultSetMetaData data allows a result set to be better formatted. It's used in
Base.printResultSet() to print results sets and in Base.displayResultSet() to fill a
scrollable JTable displayed inside a JFrame.</p>
<p>The following query prints a result set to standard output:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of DBQuery.java...</span>
<span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">tableNames</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">getTablesNames</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
<span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="s">&quot;SELECT * FROM \&quot;&quot;</span> <span class="o">+</span>
                            <span class="n">tableNames</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
<span class="n">Base</span><span class="p">.</span><span class="na">printResultSet</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span>
</code></pre></div>
<p>The query employs the first string from the tableNames list as the SELECT's table.</p>
<p>The output for liangTables.odb is:</p>
<div class="highlight"><pre><span></span><code>  courseId,  subjectId, courseNumber,      title, numOfCredits
--------------------------------------------------------------
     11111,       CSCI,       1301, Introduction to Java I,          4
     11112,       CSCI,       1302, Introduction to Java II,          3
     11113,       CSCI,       3720, Database Systems,          4
</code></pre></div>
<p>The formatting isn't perfect since its quite tricky to determine the maximum width
required for a column. Base.printResultSet() uses XResultSetMetaData to determine
the number of columns and their names:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printResultSet</span><span class="p">(</span><span class="n">XResultSet</span> <span class="n">rs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">rs</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No results set to print&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XResultSetMetaDataSupplier</span> <span class="n">rsMetaSupp</span> <span class="o">=</span>
             <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XResultSetMetaDataSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
    <span class="n">XResultSetMetaData</span> <span class="n">rsmd</span> <span class="o">=</span> <span class="n">rsMetaSupp</span><span class="p">.</span><span class="na">getMetaData</span><span class="p">();</span>

    <span class="kt">int</span> <span class="n">tableWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">numCols</span> <span class="o">=</span> <span class="n">rsmd</span><span class="p">.</span><span class="na">getColumnCount</span><span class="p">();</span>

    <span class="n">String</span> <span class="n">colName</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numCols</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">);</span>
        <span class="n">tableWidth</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">colName</span> <span class="o">=</span> <span class="n">rsmd</span><span class="p">.</span><span class="na">getColumnName</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;%10s&quot;</span><span class="p">,</span> <span class="n">colName</span><span class="p">);</span>
      <span class="n">tableWidth</span> <span class="o">+=</span> <span class="n">Math</span><span class="p">.</span><span class="na">max</span><span class="p">(</span><span class="n">colName</span><span class="p">.</span><span class="na">length</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tableWidth</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>

    <span class="n">XRow</span> <span class="n">xRow</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numCols</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
          <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;%10s&quot;</span><span class="p">,</span> <span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of printResultSet()</span>
</code></pre></div>
<p>Fortunately, the hard work of writing a good ASCII-based table printer has already
been done by Hami Galip Torun with his DBTablePrinter class, available from
<a href="https://github.com/htorun/dbtableprinter/">https://github.com/htorun/dbtableprinter/</a>. It offers printTable() and printResultSet() for
printing a JDBC table and result set in beautiful ASCII.</p>
<p>I made a few small changes to his class to allow it to handle sdbc tables and result
sets, which consisted mainly of changing the Connection, Statement, and ResultSet
names to XConnection, XStatement, and XResultSet. I've also renamed the class as
BaseTablePrinter so I could keep using Torun's original DBTablePrinter for printing
JDBC results.</p>
<p>The result set shown above is printed by:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of DBQuery.java...</span>
<span class="n">BaseTablePrinter</span><span class="p">.</span><span class="na">printResultSet</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span>
</code></pre></div>
<p>The output:</p>
<div class="highlight"><pre><span></span><code>Printing 3 rows from table Course
+----------+-----------+--------------+-------------------------+--------------+
| courseId | subjectId | courseNumber |          title          | numOfCredits |
+----------+-----------+--------------+-------------------------+--------------+
| 11111    | CSCI      |         1301 | Introduction to Java I  |            4 |
+----------+-----------+--------------+-------------------------+--------------+
| 11112    | CSCI      |         1302 | Introduction to Java II |            3 |
+----------+-----------+--------------+-------------------------+--------------+
| 11113    | CSCI      |         3720 | Database Systems        |            4 |
+----------+-----------+--------------+-------------------------+--------------+
</code></pre></div>
<p>A graphical display is implemented by my Base.displayResultSet(), which uses the
result set to fill a JTable GUI component inside a JFrame. This result set from above
is displayed by:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of DBQuery.java...</span>
<span class="n">Base</span><span class="p">.</span><span class="na">displayResultSet</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span>
</code></pre></div>
<p>Figure 7 shows the JFrame.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-7.png" /></p>
<p>Figure 7. The Result Set Displayed in a Window.</p>
<p>There are some problems with the layout: too much vertical space below the table,
and column formatting which shows all the data, but not all the headings. However,
the user can resize the window and columns, so these drawbacks aren't serious.</p>
<p>displayResultSet() is coded as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">displayResultSet</span><span class="p">(</span><span class="n">XResultSet</span> <span class="n">rs</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">displayResultSet</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="s">&quot;Result set&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>  <span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">displayResultSet</span><span class="p">(</span><span class="n">XResultSet</span> <span class="n">rs</span><span class="p">,</span>
                                  <span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">rs</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No results set to display&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XResultSetMetaDataSupplier</span> <span class="n">rsMetaSupp</span> <span class="o">=</span>
             <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XResultSetMetaDataSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
    <span class="n">XResultSetMetaData</span> <span class="n">rsmd</span> <span class="o">=</span> <span class="n">rsMetaSupp</span><span class="p">.</span><span class="na">getMetaData</span><span class="p">();</span>

    <span class="c1">// names of columns</span>
    <span class="kt">int</span> <span class="n">numCols</span> <span class="o">=</span> <span class="n">rsmd</span><span class="p">.</span><span class="na">getColumnCount</span><span class="p">();</span>
    <span class="n">String</span><span class="o">[]</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">numCols</span><span class="o">]</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numCols</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">headers</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">rsmd</span><span class="p">.</span><span class="na">getColumnName</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// create table with column heads</span>
    <span class="n">DefaultTableModel</span> <span class="n">tableModel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultTableModel</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">JTable</span> <span class="n">table</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JTable</span><span class="p">(</span><span class="n">tableModel</span><span class="p">);</span>

    <span class="c1">// fill table with XResultSet contents, one row at a time</span>
    <span class="n">XRow</span> <span class="n">xRow</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span>
      <span class="n">tableModel</span><span class="p">.</span><span class="na">addRow</span><span class="p">(</span> <span class="n">getRow</span><span class="p">(</span><span class="n">xRow</span><span class="p">,</span> <span class="n">numCols</span><span class="p">));</span>

    <span class="c1">// resize columns so data is visible</span>
    <span class="n">table</span><span class="p">.</span><span class="na">setAutoResizeMode</span><span class="p">(</span><span class="n">JTable</span><span class="p">.</span><span class="na">AUTO_RESIZE_ALL_COLUMNS</span><span class="p">);</span>
    <span class="n">resizeColumnWidth</span><span class="p">(</span><span class="n">table</span><span class="p">);</span>

    <span class="n">SwingUtilities</span><span class="p">.</span><span class="na">invokeLater</span><span class="p">(</span> <span class="k">new</span> <span class="n">Runnable</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span>
      <span class="p">{</span>  <span class="n">JFrame</span> <span class="n">frame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JFrame</span><span class="p">();</span>
         <span class="n">frame</span><span class="p">.</span><span class="na">setBounds</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
         <span class="n">frame</span><span class="p">.</span><span class="na">setTitle</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
         <span class="n">frame</span><span class="p">.</span><span class="na">setDefaultCloseOperation</span><span class="p">(</span><span class="n">JFrame</span><span class="p">.</span><span class="na">DISPOSE_ON_CLOSE</span><span class="p">);</span>
                 <span class="c1">// so JFrame closure doesn&#39;t kill the main prog</span>
         <span class="n">frame</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">JScrollPane</span><span class="p">(</span><span class="n">table</span><span class="p">),</span> <span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span>
         <span class="n">frame</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of displayResultSet()</span>
</code></pre></div>
<p>This sdbc display code is different from the JDBC version in only two ways. The first
is the use of XResultSetMetaDataSupplier to access the result set's metadata:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of Base.displayResultSet()...</span>
<span class="n">XResultSetMetaDataSupplier</span> <span class="n">rsMetaSupp</span> <span class="o">=</span>
                 <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XResultSetMetaDataSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
<span class="n">XResultSetMetaData</span> <span class="n">rsmd</span> <span class="o">=</span> <span class="n">rsMetaSupp</span><span class="p">.</span><span class="na">getMetaData</span><span class="p">();</span>
</code></pre></div>
<p>The second is the utilization of an XRow instance to refer to each row in the result
set:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of Base.displayResultSet()...</span>
<span class="n">XRow</span> <span class="n">xRow</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span>
  <span class="n">tableModel</span><span class="p">.</span><span class="na">addRow</span><span class="p">(</span> <span class="n">getRow</span><span class="p">(</span><span class="n">xRow</span><span class="p">,</span> <span class="n">numCols</span><span class="p">));</span>
</code></pre></div>
<h2 id="3-debugging-database-code">3.  Debugging Database Code<a class="headerlink" href="#3-debugging-database-code" title="Permanent link">&para;</a></h2>
<p>A useful way to debug larger programs is to display the database tables they're
manipulating. The simplest way of doing this is to open the tables inside Base.</p>
<p>A call to GUI.setVisible() makes Base and the loaded file visible. However, Base's
default behavior is to display its Forms view rather than the Tables view. Even after
changing to the Tables view, only the names of the tables are listed not their contents.
Base.showTables() deals with these issues, so that the following call:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of DBQuery.java...</span>
<span class="n">Base</span><span class="p">.</span><span class="na">showTables</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
<span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
</code></pre></div>
<p>produces the windows shown in Figure 8 when liangTables.odb is being processed.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-8.png" /></p>
<p>Figure 8. The liangTables.odb Tables in Base.</p>
<p>The call to Lo.waitEnter() gives the user a chance to examine the tables before the
program continues.</p>
<p>A drawback of this approach is that having open table windows at the end of the
program often causes Office to crash after Lo.closeOffice() is called.</p>
<p>Base.showTables() utilizes a series of dispatch commands to make the GUI visible,
show the Tables view, and open the tables in separate windows:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showTables</span><span class="p">(</span><span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span><span class="p">)</span>
<span class="c1">// open windows for all the tables in the doc</span>
<span class="p">{</span>
  <span class="n">showTablesView</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>  <span class="c1">// wait for Tables View to appear</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;SelectAll&quot;</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;DBTableOpen&quot;</span><span class="p">);</span>  <span class="c1">// open all tables</span>
<span class="p">}</span>  <span class="c1">// end of showTables()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showTablesView</span><span class="p">(</span><span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span><span class="p">)</span>
<span class="c1">// make Base visible, and switch to its Table view</span>
<span class="p">{</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XComponent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">dbDoc</span><span class="p">);</span>
  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>  <span class="c1">// wait for GUI to appear</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;DBViewTables&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of showTablesView()</span>
</code></pre></div>
<p>As usual, using dispatches makes the code very fragile. For example, consider the
"SelectAll" dispatch which causes Office to select all the table names in the Tables
View. To be more precise, "SelectAll" selects everything in the active window, which
should be the Tables view, but could easily be something else if the user clicked on
another window at the wrong time.</p>
<p>My Base class offers two alternatives to showTables(): Base.printDatabase() and
Base.displayDatabase(); the first builds upon Hami Galip Torun's class to generate
textual output of every table in the database, while the second uses my
Base.displayResultSet() to render each table in its own JFrame. They are called like
so:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of DBQuery.java...</span>
<span class="n">Base</span><span class="p">.</span><span class="na">printDatabase</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>

<span class="n">Base</span><span class="p">.</span><span class="na">displayDatabase</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
</code></pre></div>
<p>Base.displayDatabase() is a better choice for displaying large databases since each
JFrame can be resized and is scrollable, as in Figure 9.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-9.png" /></p>
<p>Figure 9.  The liangTables.odb Tables shown in JFrames.</p>
<h2 id="4-creating-a-base-document">4.  Creating a Base Document<a class="headerlink" href="#4-creating-a-base-document" title="Permanent link">&para;</a></h2>
<p>The DBCreate.java example creates a new document called spies.odb which holds a
single table of "top-secret" information on spies. Figure 10 shows the table inside
Base.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-10.png" /></p>
<p>Figure 10. The SPIES Table inside spies.odb.</p>
<p>The example employs Base.createBaseDoc() to create an embedded database (which
can be either HSQLDB or Firebird).</p>
<p>The main() function for DBCreate.java is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FNM</span> <span class="o">=</span> <span class="s">&quot;spies.odb&quot;</span><span class="p">;</span>


<span class="c1">// in DBCreate.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">createBaseDoc</span><span class="p">(</span><span class="n">FNM</span><span class="p">,</span>
                                        <span class="n">Base</span><span class="p">.</span><span class="na">HSQLDB</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
                                     <span class="c1">// Base.FIREBIRD, loader);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dbDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>

    <span class="c1">// create a table in the database</span>
    <span class="n">Base</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="s">&quot;CREATE TABLE SPIES &quot;</span> <span class="o">+</span>
         <span class="s">&quot;( FIRSTNAME VARCHAR(50), LASTNAME VARCHAR(50),</span>
<span class="s">            ID VARCHAR(50), PRIMARY KEY (ID) )&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>

    <span class="n">Base</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="s">&quot;INSERT INTO SPIES VALUES(</span>
<span class="s">                         &#39;James&#39;, &#39;Bond&#39;, &#39;007&#39;)&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
    <span class="n">Base</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="s">&quot;INSERT INTO SPIES VALUES(</span>
<span class="s">                         &#39;Johnny&#39;, &#39;English&#39;, &#39;013&#39;)&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
    <span class="n">Base</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="s">&quot;INSERT INTO SPIES VALUES(</span>
<span class="s">                         &#39;Maxwell&#39;, &#39;Smart&#39;, &#39;Agent 86&#39;)&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>

    <span class="n">XFlushable</span> <span class="n">flusher</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XFlushable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">dataSource</span><span class="p">);</span>
    <span class="n">flusher</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span>
      <span class="c1">// needed or data not saved to file; can only be called once</span>

    <span class="c1">// test the database with a query</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
    <span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="s">&quot;SELECT * FROM SPIES&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
    <span class="n">BaseTablePrinter</span><span class="p">.</span><span class="na">printResultSet</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Base</span><span class="p">.</span><span class="na">closeConnection</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
  <span class="n">Base</span><span class="p">.</span><span class="na">closeBaseDoc</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>There's something missing from main() â€“ there's no call to a 'save' function to save the
new spies.odb file before the program exits. There's no need because of how the
spies.odb file and database are created in two phases.</p>
<p>First, Base.createBaseDoc() creates an ODB file with an empty embedded database.
The file is saved by createBaseDoc(), then reloaded, and a reference returned by the
method. This unusual behavior is necessary or no link (an XConnection) can be
opened to the new database.</p>
<p>The second phase employs SQL DDL and DML commands to create and populate a
table inside the file. The unusual part of this phase is the need to finish off with a call
to XFlushable.flush(). This ensures that the table is written out to the embedded
database in the file.</p>
<p>The final part of the try-catch block is a test to see if the SPIES table can be
successfully queried. The BaseTablePrinter.printResultSet() output is:</p>
<div class="highlight"><pre><span></span><code>Printing 3 rows from table SPIES
+-----------+----------+----------+
| FIRSTNAME | LASTNAME |    ID    |
+-----------+----------+----------+
| James     | Bond     | 007      |
+-----------+----------+----------+
| Johnny    | English  | 013      |
+-----------+----------+----------+
| Maxwell   | Smart    | Agent 86 |
+-----------+----------+----------+
</code></pre></div>
<p>Base.createBaseDoc() is defined as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="c1">// globals</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">HSQLDB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">FIREBIRD</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">HSQL_EMBEDDED</span> <span class="o">=</span> <span class="s">&quot;sdbc:embedded:hsqldb&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FIREBIRD_EMBEDDED</span> <span class="o">=</span>
                                         <span class="s">&quot;sdbc:embedded:firebird&quot;</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">XOfficeDatabaseDocument</span> <span class="nf">createBaseDoc</span><span class="p">(</span>
               <span class="n">String</span> <span class="n">fnm</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dbType</span><span class="p">,</span> <span class="n">XComponentLoader</span> <span class="n">loader</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">dbType</span> <span class="o">!=</span> <span class="n">HSQLDB</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">dbType</span> <span class="o">!=</span> <span class="n">FIREBIRD</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unknown db type; using HSQLDB&quot;</span><span class="p">);</span>
    <span class="n">dbType</span> <span class="o">=</span> <span class="n">HSQLDB</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="s">&quot;sdatabase&quot;</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Document creation failed&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span> <span class="o">=</span>
          <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XOfficeDatabaseDocument</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>

  <span class="n">String</span> <span class="n">sourceStr</span> <span class="o">=</span> <span class="p">(</span><span class="n">dbType</span> <span class="o">==</span> <span class="n">FIREBIRD</span><span class="p">)</span> <span class="o">?</span> <span class="n">FIREBIRD_EMBEDDED</span> <span class="p">:</span>
                                            <span class="n">HSQL_EMBEDDED</span><span class="p">;</span>
  <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span> <span class="s">&quot;URL&quot;</span><span class="p">,</span> <span class="n">sourceStr</span><span class="p">);</span>

  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Created a \&quot;&quot;</span> <span class="o">+</span> <span class="n">sourceStr</span> <span class="o">+</span>
                         <span class="s">&quot;\&quot; Base document in &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>

  <span class="c1">// save, close, reopen,</span>
  <span class="c1">// or no subsequent connection can be made to database</span>
  <span class="n">Base</span><span class="p">.</span><span class="na">saveBaseDoc</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">,</span> <span class="n">fnm</span><span class="p">);</span>
  <span class="n">Base</span><span class="p">.</span><span class="na">closeBaseDoc</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">openBaseDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of createBaseDoc()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">saveBaseDoc</span><span class="p">(</span><span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span><span class="p">,</span>
                               <span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XComponent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">dbDoc</span><span class="p">);</span>
   <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">fnm</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Base.createBaseDoc() utilizes Lo.createDoc() to create an empty ODB document, and
then sets its data source to be an embedded HSQLDB or Firebird database. The URL
property in the DataSource service is assigned "sdbc:embedded:hsqldb" or
"sdbc:embedded:firebird".</p>
<h4 id="viewing-database-creation">Viewing Database Creation<a class="headerlink" href="#viewing-database-creation" title="Permanent link">&para;</a></h4>
<p>It's sometimes useful to observe the stages in a database's creation, and that's most
easily achieved by making Base's GUI visible during DBCreate.java's execution.</p>
<p>GUI.setVisible() is called at the start of the program:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of DBCreate.java...</span>
<span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre></div>
<p>Of course, Base's tables view will not show anything initially since the database  is
empty. More surprisingly, the view remains empty after the SQL commands have
finished and XFlushable.flush() has been called. The table view must be 'refreshed' in
order for the new tables to be listed, which is done by Base.refreshTables():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of DBCreate.java...</span>
<span class="n">Base</span><span class="p">.</span><span class="na">refreshTables</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
      <span class="c1">// place after the call to XFlushable.flush()</span>
<span class="n">Base</span><span class="p">.</span><span class="na">showTablesView</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
</code></pre></div>
<p>Base.refreshTables() is implemented as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">refreshTables</span><span class="p">(</span><span class="n">XConnection</span> <span class="n">conn</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XTablesSupplier</span> <span class="n">suppTables</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTablesSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
  <span class="n">XRefreshable</span> <span class="n">refresh</span> <span class="o">=</span>
           <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRefreshable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">suppTables</span><span class="p">.</span><span class="na">getTables</span><span class="p">());</span>
  <span class="n">refresh</span><span class="p">.</span><span class="na">refresh</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of refreshTables()</span>
</code></pre></div>
<h2 id="5-processing-multiple-sql-commands">5.  Processing Multiple SQL Commands<a class="headerlink" href="#5-processing-multiple-sql-commands" title="Permanent link">&para;</a></h2>
<p>The simplest way to build databases with more tables and data is by storing the
necessary DDL and DML commands in a text file. This can be loaded by
Base.readCmds(), as in the DBCmdsQuery.java example.</p>
<p>main() creates an ODB document with an empty embedded HSQLDB database,
builds its tables by executing the commands loaded by Base.readCmds(), and displays
the tables inside Base:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in DBCmdsCreate.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: java DBCmdsCreate &lt;cmds fnm&gt;&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">String</span> <span class="n">fnm</span> <span class="o">=</span> <span class="n">Info</span><span class="p">.</span><span class="na">getName</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.odb&quot;</span><span class="p">;</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">createBaseDoc</span><span class="p">(</span><span class="n">fnm</span><span class="p">,</span>
                                   <span class="n">Base</span><span class="p">.</span><span class="na">HSQLDB</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
                                <span class="c1">// Base.FIREBIRD, loader);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dbDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">cmds</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">readCmds</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">cmds</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No commands to process&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Read in &quot;</span> <span class="o">+</span> <span class="n">cmds</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; commands&quot;</span><span class="p">);</span>

  <span class="n">XConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>  <span class="c1">// no login/password</span>
    <span class="n">processCmds</span><span class="p">(</span><span class="n">cmds</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>

    <span class="n">XFlushable</span> <span class="n">flusher</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XFlushable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">dataSource</span><span class="p">);</span>
    <span class="n">flusher</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span>   <span class="c1">// needed or data not saved to file</span>

    <span class="c1">// must refresh the connection or the tables</span>
    <span class="c1">// will not be visible inside Base</span>
    <span class="n">Base</span><span class="p">.</span><span class="na">refreshTables</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
    <span class="n">Base</span><span class="p">.</span><span class="na">showTables</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
          <span class="c1">// Office may not close cleanly while showing tables</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">waitEnter</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Base</span><span class="p">.</span><span class="na">closeConnection</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
  <span class="n">Base</span><span class="p">.</span><span class="na">closeBaseDoc</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>



<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">processCmds</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">cmds</span><span class="p">,</span>
                                <span class="n">XConnection</span> <span class="n">conn</span><span class="p">)</span>
<span class="c1">// filter out SELECTs since only creating in this example</span>
<span class="p">{</span> <span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">cmd</span> <span class="p">:</span> <span class="n">cmds</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;SELECT&quot;</span><span class="p">))</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Ignoring: \&quot;&quot;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">Base</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of processCmds()</span>
</code></pre></div>
<p>Base.readCmds() is a standard piece of Java for reading lines from a file, returning
them in a list. Each line is assumed to start with "CREATE", "INSERT", "UPDATE",
"DELETE", or SELECT". processCmds() in DBCmdsCreate.java skips over
"SELECT" queries.</p>
<p>Base.exec() hides the details of creating an Statement object, and deciding whether to
call XStatement.execute() for "CREATE" commands, XStatement.executeUpdate()
for "INSERT", "UPDATE", and DELETE", or XStatement.executeQuery() for
"SELECT".</p>
<p>After the commands have been processed, it's necessary to flush the newly created
tables to the file and refresh Base's Table view.</p>
<p>The call:</p>
<div class="highlight"><pre><span></span><code><span class="n">run</span> <span class="n">DBCmdsCreate</span> <span class="n">liangTables</span><span class="p">.</span><span class="na">txt</span>
</code></pre></div>
<p>creates liangTables.odb and populates it with three tables called Course, Enrollment,
and Student, which can be seen in Figure 8.</p>
<p>The DBCmdsQuery.java example uses the same Base.readCmds() to read in queries
applied to a database. The only difference from DBCmdsCreate.java is that a database
is opened with Base.openBaseDoc() rather than created from scratch.</p>
<h2 id="6-displaying-table-relationships">6.  Displaying Table Relationships<a class="headerlink" href="#6-displaying-table-relationships" title="Permanent link">&para;</a></h2>
<p>A  good way to understand the relationships between multiple tables in a database is
with a relation design diagram, which is generated by the Tools, Relationships
menu item in Base. For example, the diagram for the three tables in liangTables.odb is
shown in Figure 11.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-11.png" /></p>
<p>Figure 11. The Relation Design Diagram for liangTables.odb.</p>
<p>Unfortunately, there's no way to generate relation design diagrams programmatically
except via dispatch commands. Another problem is that there's no API or Base menu
item for saving a diagram as an image. My solution uses Java's Robot class to send
the <alt> <print screen> keys to Windows to trigger a screenshot of the currently
active window. My code reads the image from the clipboard and saves it to a file.</p>
<p>This programming mishmash is demoed by DBRels.java:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in DBRels.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: run DBRels &lt;fnm&gt;&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span> <span class="o">=</span>
                   <span class="n">Base</span><span class="p">.</span><span class="na">openBaseDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dbDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open database &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">Base</span><span class="p">.</span><span class="na">isFirebirdEmbedded</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">))</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Embedded Firebird does not</span>
<span class="s">                                  support relation design&quot;</span><span class="p">);</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>  <span class="c1">// wait for GUI to appear</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;DBRelationDesign&quot;</span><span class="p">);</span>
        <span class="c1">// open the relation design diagram window in Base</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

    <span class="n">JNAUtils</span><span class="p">.</span><span class="na">shootWindow</span><span class="p">();</span>
        <span class="c1">// take a screenshot of the currently active window</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

    <span class="c1">// read an image from the clipboard, and save it</span>
    <span class="n">BufferedImage</span> <span class="n">im</span> <span class="o">=</span> <span class="n">Clip</span><span class="p">.</span><span class="na">readImage</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">im</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
      <span class="n">Images</span><span class="p">.</span><span class="na">saveImage</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="s">&quot;relations.png&quot;</span><span class="p">);</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">dispatchCmd</span><span class="p">(</span><span class="s">&quot;CloseWin&quot;</span><span class="p">);</span>  <span class="c1">// close relation design window</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Base</span><span class="p">.</span><span class="na">closeBaseDoc</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<p>JNAUtils.shootWindow() doesn't utilize the JNA library, but its use of OS-level
functionality means it doesn't really belong in any of my other Office support classes.</p>
<p>The code:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the JNA class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">shootWindow</span><span class="p">()</span>
<span class="c1">// take a screenshot of the window in focus</span>
<span class="p">{</span>
  <span class="n">EventQueue</span><span class="p">.</span><span class="na">invokeLater</span><span class="p">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="n">Robot</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Robot</span><span class="p">();</span>
        <span class="n">r</span><span class="p">.</span><span class="na">keyPress</span><span class="p">(</span><span class="n">KeyEvent</span><span class="p">.</span><span class="na">VK_ALT</span><span class="p">);</span> <span class="c1">// press &lt;alt&gt; &lt;print screen&gt;</span>
        <span class="n">r</span><span class="p">.</span><span class="na">keyPress</span><span class="p">(</span><span class="n">KeyEvent</span><span class="p">.</span><span class="na">VK_PRINTSCREEN</span><span class="p">);</span>
        <span class="n">r</span><span class="p">.</span><span class="na">keyRelease</span><span class="p">(</span><span class="n">KeyEvent</span><span class="p">.</span><span class="na">VK_ALT</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Screenshot of window completed&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">catch</span><span class="p">(</span><span class="n">AWTException</span> <span class="n">e</span><span class="p">)</span>
      <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unable to do screenshot: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>  <span class="c1">// end of shootWindow()</span>
</code></pre></div>
<p>Of course, there's a danger that the user (or OS) will move the window focus away
from the relation design window, causing the wrong window to be screenshot and
stored on the clipboard.</p>
<p>Clip.readImage() converts the first Bitmap it finds on the system clipboard into a
BufferedImage. I'll talk about my Clipboard support class in Chapter 43.</p>
<p>The image is saved to relations.png, which is shown in Figure 12.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-12.png" /></p>
<p>Figure 12. Part of the relations.png Image.</p>
<p>Figure 12 isn't the same as Figure 11 because I rearranged and resized the boxes
before snapping the image. Figure 12 shows the original layout produced by Base.</p>
<p>Another issue with Base's relation design tool is that it's currently not implemented for
embedded Firebird databases. This explains the call to Base.isFirebirdEmbedded() in
DBRels.java which lets the diagram creation be skipped.</p>
<p>isFirebirdEmbedded() examines the document's DataSource "URL" property to see if
it contains the string "sdbc:embedded:firebird":</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="c1">// globals</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">HSQL_EMBEDDED</span> <span class="o">=</span> <span class="s">&quot;sdbc:embedded:hsqldb&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FIREBIRD_EMBEDDED</span> <span class="o">=</span>
                                         <span class="s">&quot;sdbc:embedded:firebird&quot;</span><span class="p">;</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isFirebirdEmbedded</span><span class="p">(</span>
                           <span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span><span class="p">)</span>
<span class="p">{</span> <span class="n">String</span> <span class="n">embedFnm</span> <span class="o">=</span> <span class="n">getDataSourceType</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">embedFnm</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">embedFnm</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">FIREBIRD_EMBEDDED</span><span class="p">));</span>
<span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isHSQLEmbedded</span><span class="p">(</span>
                          <span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span><span class="p">)</span>
<span class="p">{</span> <span class="n">String</span> <span class="n">embedFnm</span> <span class="o">=</span> <span class="n">getDataSourceType</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">embedFnm</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">embedFnm</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">HSQL_EMBEDDED</span><span class="p">));</span>
<span class="p">}</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getDataSourceType</span><span class="p">(</span><span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dbDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Database is null&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dataSource</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;DataSource is null&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">Props</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span> <span class="s">&quot;URL&quot;</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of getDataSourceType()</span>
</code></pre></div>
<p>There's also an isHSQLEmbedded() method for checking if the document contains an
embedded HSQLDB database.</p>
<h2 id="7-prepared-statements">7.  Prepared Statements<a class="headerlink" href="#7-prepared-statements" title="Permanent link">&para;</a></h2>
<p>Sdbc supports prepared statements, which are SQL commands with Java-level
parameters (denoted by '?'s). The PreparedStatement service stores properties related
to how the result set is created, and XPreparedStatement contains the methods.</p>
<p>PreparedSales.java shows how prepared statements are created and used. It starts by
creating a salesman.odb file containing a SALESMAN table with 5 rows of data.
Figure 13 shows the table inside Base.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-13.png" /></p>
<p>Figure 13. The Initial SALESMAN Table in salesman.odb.</p>
<p>At this point, PreparedSales.java calls updatePs():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in PreparedSales.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">updatePs</span><span class="p">(</span><span class="n">XConnection</span> <span class="n">conn</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SQLException</span>
<span class="c1">// update the table with a prepared statement; 4 changes made</span>
<span class="p">{</span>
  <span class="n">XPreparedStatement</span> <span class="n">preStmt</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span>
                <span class="s">&quot;UPDATE SALESMAN SET STREET = ? WHERE SNR = ?&quot;</span><span class="p">);</span>

  <span class="c1">// change STREET for Joseph (SNR == 1) to 34 Main Road</span>
  <span class="n">XParameters</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XParameters</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">preStmt</span><span class="p">);</span>
  <span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;34 Main Road&quot;</span><span class="p">);</span>
  <span class="n">ps</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">preStmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>

  <span class="c1">// change STREET for George (SNR == 4) to Marryland</span>
  <span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Marryland&quot;</span><span class="p">);</span>
  <span class="n">ps</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
  <span class="n">preStmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>

  <span class="c1">// 2nd change of STREET of George to Michigan road</span>
  <span class="c1">// (since SNR is still == 4)</span>
  <span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Michigan road&quot;</span><span class="p">);</span>
  <span class="n">preStmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>

  <span class="c1">// change STREET for Jane (SNR == 3) to Bond Street</span>
  <span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Bond Street&quot;</span><span class="p">);</span>
  <span class="n">ps</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">numRowsChanged</span> <span class="o">=</span> <span class="n">preStmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No. of rows changed by executeUpdate(): &quot;</span> <span class="o">+</span>
                               <span class="n">numRowsChanged</span><span class="p">);</span>  <span class="c1">// == 1</span>
  <span class="p">}</span>  <span class="c1">// end of updatePs()</span>
</code></pre></div>
<p>The prepared statement is an UPDATE command which can change the STREET
entry for a given SNR value, but the street and SNR values are specified as "?"s.
updatePs() changes rows 1, 4, and 2 of SNR a total of four times (row 4 is changed
twice). The final result is shown in Figure 14.</p>
<p><img alt="" src="images/35-Examining_Base_Docs-14.png" /></p>
<p>Figure 14. The Updated SALESMAN Table in salesman.odb.</p>
<p>Office's XPreparedStatement methods are similar to those in JDBC's
PreparedStatement, except that the set() methods for the "?"s are in the XParameters
interface.</p>
<h2 id="8-scrollable-and-updatable-result-sets">8.  Scrollable and Updatable Result Sets<a class="headerlink" href="#8-scrollable-and-updatable-result-sets" title="Permanent link">&para;</a></h2>
<p>Sdbc's scrollable and updatable result set features are borrowed from JDBC.</p>
<p>Scrollability lets the result set's cursor move backwards and jump to a particular row.
It can be combined with sensitivity, which allows the set to be automatically updated
when the database is modified.</p>
<p>An updatable result set means that changes made to the result set's data will trigger
updates to the database.</p>
<p>Before you become too excited, there's some bad news. Result sets in the current
version of Base's HSQLDB (v.1.8) support scrollability, but not sensitivity or
updatability. The situation is worse for the current version of Base's Firebird (v. 2.5.2)
which doesn't support any of these features; only forward movement of the cursor
through the result set is possible.</p>
<p>The engine's capabilities are likely to improve in the future, so it's a good idea to
check their status when you want to use them. Base.reportResultSetSupport() prints
relevant information by examining the XDatabaseMetaData interface:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">reportResultSetSupport</span><span class="p">(</span><span class="n">XConnection</span> <span class="n">conn</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XDatabaseMetaData</span> <span class="n">md</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">getMetaData</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Resultset Capabilities:&quot;</span><span class="p">);</span>
    <span class="n">printTypeConcurrency</span><span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="n">ResultSetType</span><span class="p">.</span><span class="na">FORWARD_ONLY</span><span class="p">,</span>
                             <span class="s">&quot;forward only&quot;</span><span class="p">);</span>
    <span class="n">printTypeConcurrency</span><span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="n">ResultSetType</span><span class="p">.</span><span class="na">SCROLL_INSENSITIVE</span><span class="p">,</span>
                             <span class="s">&quot;scrollable; db insensitive&quot;</span><span class="p">);</span>
    <span class="n">printTypeConcurrency</span><span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="n">ResultSetType</span><span class="p">.</span><span class="na">SCROLL_SENSITIVE</span><span class="p">,</span>
                             <span class="s">&quot;scrollable; db sensitive&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of reportResultSetSupport()</span>


<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printTypeConcurrency</span><span class="p">(</span><span class="n">XDatabaseMetaData</span> <span class="n">md</span><span class="p">,</span>
                 <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="n">String</span> <span class="n">typeStr</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SQLException</span>
<span class="cm">/*</span>
<span class="cm">  Possible ResultSet Type Values:</span>
<span class="cm">     FORWARD_ONLY: The result set is not scrollable (default)</span>
<span class="cm">     SCROLL_INSENSITIVE: The result set is scrollable but not</span>
<span class="cm">                         sensitive to database changes.</span>

<span class="cm">     SCROLL_SENSITIVE: The result set is scrollable and sensitive to</span>
<span class="cm">                       database changes.</span>


<span class="cm">   Possible &#39;Concurrency&#39; Values:</span>
<span class="cm">      READ_ONLY: The result set cannot be used to update</span>
<span class="cm">                 the database (default)</span>
<span class="cm">      UPDATABLE: The result set can be used to update the database.</span>

<span class="cm">*/</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">md</span><span class="p">.</span><span class="na">supportsResultSetType</span><span class="p">(</span><span class="n">type</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;  Supports &quot;</span> <span class="o">+</span> <span class="n">typeStr</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">md</span><span class="p">.</span><span class="na">supportsResultSetConcurrency</span><span class="p">(</span><span class="n">type</span><span class="p">,</span>
                               <span class="n">ResultSetConcurrency</span><span class="p">.</span><span class="na">READ_ONLY</span><span class="p">))</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; + read-only&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">md</span><span class="p">.</span><span class="na">supportsResultSetConcurrency</span><span class="p">(</span><span class="n">type</span><span class="p">,</span>
                               <span class="n">ResultSetConcurrency</span><span class="p">.</span><span class="na">UPDATABLE</span><span class="p">))</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; + updatable&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of printTypeConcurrency()</span>
</code></pre></div>
<p>FancyRS.java contains an example call:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// part of FancyRS.java...</span>
<span class="n">Base</span><span class="p">.</span><span class="na">reportResultSetSupport</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
</code></pre></div>
<p>The output for an embedded HSQLDB database is:</p>
<div class="highlight"><pre><span></span><code>Supports forward only + read only
Supports scrollable; db insensitive + read-only
</code></pre></div>
<p>The following is printed for an embedded Firebird database:</p>
<div class="highlight"><pre><span></span><code>Supports forward only + read-only
</code></pre></div>
<p>FancyRS.java shows how scrollable and updatable result sets might be utilized if they
were available. The program begins by creating a sales.odb document which can
either hold an embedded HSQLDB or Firebird database with a small SALES table.
The table printed in ASCII is:</p>
<div class="highlight"><pre><span></span><code>+--------+--------+-----+--------+------------+---------+
| SALENR | COS_NR | SNR |  NAME  |  SALEDATE  |  PRICE  |
+--------+--------+-----+--------+------------+---------+
|      1 |    100 |   1 | Linux  | 2016-02-12 |  15.000 |
+--------+--------+-----+--------+------------+---------+
|      2 |    101 |   2 | Beef   | 2016-10-18 |  15.780 |
+--------+--------+-----+--------+------------+---------+
|      3 |    104 |   4 | Juice  | 2016-08-09 |   1.500 |
+--------+--------+-----+--------+------------+---------+
</code></pre></div>
<p>The database and table are constructed in main():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// global</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FNM</span> <span class="o">=</span> <span class="s">&quot;sales.odb&quot;</span><span class="p">;</span>


<span class="c1">// in FancyRS.java</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">createBaseDoc</span><span class="p">(</span><span class="n">FNM</span><span class="p">,</span>
                                       <span class="n">Base</span><span class="p">.</span><span class="na">HSQLDB</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
                                    <span class="c1">// Base.FIREBIRD, loader);</span>
                                    <span class="c1">// date bug with Firebird</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dbDoc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>

    <span class="n">Base</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="s">&quot;CREATE TABLE SALES &quot;</span> <span class="o">+</span>
        <span class="s">&quot;(SALENR INTEGER NOT NULL, &quot;</span> <span class="o">+</span>
        <span class="s">&quot; COS_NR INTEGER,  SNR INTEGER, NAME VARCHAR(50),&quot;</span> <span class="o">+</span>
        <span class="s">&quot; SALEDATE DATE, PRICE FLOAT(10), PRIMARY KEY(SALENR) )&quot;</span><span class="p">,</span>
             <span class="n">conn</span><span class="p">);</span>

    <span class="n">Base</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="s">&quot;INSERT INTO SALES &quot;</span> <span class="o">+</span>
        <span class="s">&quot;VALUES (1, &#39;100&#39;, &#39;1&#39;,&#39;Linux&#39;,&#39;2016-02-12&#39;,15)&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
    <span class="n">Base</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="s">&quot;INSERT INTO SALES &quot;</span> <span class="o">+</span>
        <span class="s">&quot;VALUES (2, &#39;101&#39;, &#39;2&#39;,&#39;Beef&#39;,&#39;2016-10-18&#39;,15.78)&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
    <span class="n">Base</span><span class="p">.</span><span class="na">exec</span><span class="p">(</span><span class="s">&quot;INSERT INTO SALES &quot;</span> <span class="o">+</span>
        <span class="s">&quot;VALUES (3, &#39;104&#39;, &#39;4&#39;,&#39;Juice&#39;,&#39;2016-08-09&#39;,1.5)&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>

    <span class="n">XFlushable</span> <span class="n">flusher</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XFlushable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">dataSource</span><span class="p">);</span>
    <span class="n">flusher</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>

    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;DataSource type: &quot;</span> <span class="o">+</span>
                     <span class="n">Base</span><span class="p">.</span><span class="na">getDataSourceType</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">));</span>
    <span class="n">Base</span><span class="p">.</span><span class="na">reportDBInfo</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
    <span class="n">Base</span><span class="p">.</span><span class="na">reportResultSetSupport</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>

    <span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="s">&quot;SELECT * FROM SALES&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
    <span class="n">BaseTablePrinter</span><span class="p">.</span><span class="na">printResultSet</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span>

    <span class="n">useScrollable</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
    <span class="n">useUpdatable</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>

 <span class="n">Base</span><span class="p">.</span><span class="na">closeConnection</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
 <span class="n">Base</span><span class="p">.</span><span class="na">closeBaseDoc</span><span class="p">(</span><span class="n">dbDoc</span><span class="p">);</span>
 <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
<h3 id="81-a-firebird-date-bug">8.1.  A Firebird Date Bug<a class="headerlink" href="#81-a-firebird-date-bug" title="Permanent link">&para;</a></h3>
<p>FancyRS.java creates the correct embedded HSQLDB database printed above, but if
the database type is changed to embedded Firebird (i.e. by changing the second
argument of Base.createBaseDoc()), then a well-known LibreOffice/Firebird bug
reveals itself. The SALESDATE column of the table will contain the wrong year and
month, as shown below:</p>
<div class="highlight"><pre><span></span><code>+--------+--------+-----+--------+------------+---------+
| SALENR | COS_NR | SNR |  NAME  |  SALEDATE  |  PRICE  |
+--------+--------+-----+--------+------------+---------+
|      1 |    100 |   1 | Linux  | 0116-01-12 |  15.000 |
+--------+--------+-----+--------+------------+---------+
|      2 |    101 |   2 | Beef   | 0116-09-18 |  15.780 |
+--------+--------+-----+--------+------------+---------+
|      3 |    104 |   4 | Juice  | 0116-07-09 |   1.500 |
+--------+--------+-----+--------+------------+---------+
</code></pre></div>
<p>The century is set to 01, and each month is decremented by one.</p>
<p>This bug is discussed at
<a href="https://libreoffice-bugs.freedesktop.narkive.com/fPfsZXpa/bug-91324-new-embedded-firebird-current-date-gives-wrong-date-back">https://libreoffice-bugs.freedesktop.narkive.com/fPfsZXpa/bug-91324-new-embedded-firebird-current-date-gives-wrong-date-back</a>.</p>
<h3 id="82-using-a-scrollable-result-set">8.2.  Using a Scrollable Result Set<a class="headerlink" href="#82-using-a-scrollable-result-set" title="Permanent link">&para;</a></h3>
<p>useScrollable() in FancyRS.java creates a scrollable result set which is neither
sensitive to database changes nor can update the underlying database. In other words,
its result set type is assigned ResultSetType.SCROLL_INSENSITIVE and its
concurrency is ResultSetConcurrency.READ_ONLY. (For JDBC programmers, these
are equivalent to the JDBC constants TYPE_SCROLL_INSENSITIVE and
CONCUR_READ_ONLY.)</p>
<p>useScrollable() obtains a result set for the NAME and PRICE columns of the SALES
table, and prints them in reverse by moving backwards through the result set. The
output for the embedded HSQLDB version of the database is:</p>
<div class="highlight"><pre><span></span><code>Report name and price backwards:
  Juice: 1.5
  Beef: 15.78
  Linux: 15.0
</code></pre></div>
<p>The output when the database is embedded Firebird:</p>
<div class="highlight"><pre><span></span><code>Report name and price backwards:
useScrollable(): The driver does not support the function &#39;afterLast
not supported in firebird&#39;.
</code></pre></div>
<p>The useScrollable() function:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FancyRS.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">useScrollable</span><span class="p">(</span><span class="n">XConnection</span> <span class="n">conn</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XStatement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
    <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="s">&quot;ResultSetType&quot;</span><span class="p">,</span>
                    <span class="n">ResultSetType</span><span class="p">.</span><span class="na">SCROLL_INSENSITIVE</span><span class="p">);</span>
          <span class="c1">// does not update if there are changes to the database</span>

    <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="s">&quot;ResultSetConcurrency&quot;</span><span class="p">,</span>
                    <span class="n">ResultSetConcurrency</span><span class="p">.</span><span class="na">READ_ONLY</span><span class="p">);</span>
          <span class="c1">// does not update the database</span>

    <span class="n">XResultSet</span> <span class="n">srs</span> <span class="o">=</span> <span class="n">stmt</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span>
                      <span class="s">&quot;SELECT NAME, PRICE FROM SALES&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;\nReport name and price backwards:&quot;</span><span class="p">);</span>

    <span class="c1">// report in reverse order (works for HSQLDB, but</span>
    <span class="c1">// not supported by Firebird)</span>
    <span class="n">XRow</span> <span class="n">row</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">srs</span><span class="p">);</span>
    <span class="n">srs</span><span class="p">.</span><span class="na">afterLast</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">srs</span><span class="p">.</span><span class="na">previous</span><span class="p">())</span>   <span class="c1">// name: price printed</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                         <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">.</span><span class="na">getFloat</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;useScrollable(): &quot;</span> <span class="o">+</span>
                              <span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of useScrollable()</span>
</code></pre></div>
<h3 id="83-using-an-updatable-result-set">8.3.  Using an Updatable Result Set<a class="headerlink" href="#83-using-an-updatable-result-set" title="Permanent link">&para;</a></h3>
<p>useUpdatable() in FancyRS.java tries to create a result set that is insensitive to
database changes but can write its own changes to the database.  In other words, its
result set type is assigned ResultSetType.SCROLL_INSENSITIVE and its
concurrency is ResultSetConcurrency.UPDATABLE. (For JDBC programmers, these
are equivalent to TYPE_SCROLL_INSENSITIVE and CONCUR_UPDATABLE.)</p>
<p>Since neither of the embedded databases support updating result sets, the code will
raise an exception when the XResultSetUpdate methods are called.</p>
<p>The code for useUpdatable():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in FancyRS.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">useUpdatable</span><span class="p">(</span><span class="n">XConnection</span> <span class="n">conn</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XStatement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
    <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="s">&quot;ResultSetType&quot;</span><span class="p">,</span>
                        <span class="n">ResultSetType</span><span class="p">.</span><span class="na">SCROLL_INSENSITIVE</span><span class="p">);</span>
         <span class="c1">// does not update if there are changes to the database</span>

    <span class="n">Props</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="s">&quot;ResultSetConcurrency&quot;</span><span class="p">,</span>
                        <span class="n">ResultSetConcurrency</span><span class="p">.</span><span class="na">UPDATABLE</span><span class="p">);</span>
         <span class="c1">// tries to update the database</span>

    <span class="n">XResultSet</span> <span class="n">srs</span> <span class="o">=</span> <span class="n">stmt</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span>
                             <span class="s">&quot;SELECT NAME, PRICE FROM SALES&quot;</span><span class="p">);</span>
    <span class="n">srs</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
    <span class="n">XRowUpdate</span> <span class="n">updateRow</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRowUpdate</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">srs</span><span class="p">);</span>
    <span class="n">updateRow</span><span class="p">.</span><span class="na">updateFloat</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
      <span class="c1">// not possible since UPDATABLE downgraded to read-only;</span>
      <span class="c1">// an exception occurs</span>

    <span class="n">XResultSetUpdate</span> <span class="n">updateRs</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XResultSetUpdate</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">srs</span><span class="p">);</span>
    <span class="n">updateRs</span><span class="p">.</span><span class="na">updateRow</span><span class="p">();</span>
      <span class="c1">// this call tries to update the data in DBMS;</span>
      <span class="c1">// an exception would occur if execution reached here</span>

    <span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="s">&quot;SELECT * FROM SALES&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
    <span class="n">BaseTablePrinter</span><span class="p">.</span><span class="na">printResultSet</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;useUpdatable(): &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of useUpdatable()</span>
</code></pre></div>
<p>The database is updated in two steps: first a row in the result set is updated, by casting
the current row to XRowUpdate, and calling one of its update() methods. Then the
modified row is written back to the database by casting the row to XResultSetUpdate
and calling updateRow().</p>
<p>An exception is raised when XRowUpdate.updateXXX() is called since sdbc (and
JDBC) react to the non-support of updating result sets by downgrading the
concurrency setting to ResultSetConcurrency.READ_ONLY.</p>
<h2 id="9-converting-a-database-to-text">9.  Converting a Database to Text<a class="headerlink" href="#9-converting-a-database-to-text" title="Permanent link">&para;</a></h2>
<p>Base doesn't have an export feature for saving a database as text. One solution is to
utilize the "INTO TEXT" form of the SELECT command, as in:</p>
<div class="highlight"><pre><span></span><code>SELECT * INTO TEXT FOO FROM SALES
</code></pre></div>
<p>This will store the SALES table as comma-separated rows in the FOO.csv file.</p>
<p>Unfortunately, although "INTO TEXT" is in HSQLDB (e.g. see
<a href="https://hsqldb.org/doc/guide/ch06.html">https://hsqldb.org/doc/guide/ch06.html</a>), it isn't currently part of the embedded Firebird
engine.</p>
<p>A more general approach is to obtain the result set for SELECT * FROM SALES,
then use Java to write each row into a text file in CSV format. This is implemented by
Base.saveDatabase() and Base.saveTable():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">saveDatabase</span><span class="p">(</span><span class="n">XConnection</span> <span class="n">conn</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">conn</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Connection is null&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">tableNames</span> <span class="o">=</span> <span class="n">getTablesNames</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tableNames</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No tables found in database&quot;</span><span class="p">);</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">tableName</span> <span class="p">:</span> <span class="n">tableNames</span><span class="p">)</span>
      <span class="n">saveTable</span><span class="p">(</span><span class="n">tableName</span><span class="p">,</span> <span class="n">conn</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of saveDatabase()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">saveTable</span><span class="p">(</span><span class="n">String</span> <span class="n">tableName</span><span class="p">,</span> <span class="n">XConnection</span> <span class="n">conn</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">XStatement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
    <span class="n">XResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">statement</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span>
                       <span class="s">&quot;SELECT * FROM &quot;</span> <span class="o">+</span> <span class="n">tableName</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Saving table: &quot;</span> <span class="o">+</span> <span class="n">tableName</span><span class="p">);</span>
    <span class="n">saveResultSet</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">tableName</span> <span class="o">+</span> <span class="s">&quot;.csv&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="n">com</span><span class="p">.</span><span class="na">sun</span><span class="p">.</span><span class="na">star</span><span class="p">.</span><span class="na">uno</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unable to save table: &quot;</span> <span class="o">+</span> <span class="n">tableName</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of saveTable()</span>
</code></pre></div>
<p>Base.saveDatabase() uses Base.getTablesNames() to get a list of table names, and
saveTable() is called for each one. saveTable() creates a CSV file for its table by
calling saveResultSet(), which writes the column headers and each row of the table
data to the file:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in the Base class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">saveResultSet</span><span class="p">(</span><span class="n">XResultSet</span> <span class="n">rs</span><span class="p">,</span> <span class="n">String</span> <span class="n">fnm</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  Writing result set to &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">BufferedWriter</span> <span class="n">bw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedWriter</span><span class="p">(</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="p">(</span><span class="n">fnm</span><span class="p">));</span>

    <span class="n">XResultSetMetaDataSupplier</span> <span class="n">rsMetaSupp</span> <span class="o">=</span>
             <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XResultSetMetaDataSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
    <span class="n">XResultSetMetaData</span> <span class="n">rsmd</span> <span class="o">=</span> <span class="n">rsMetaSupp</span><span class="p">.</span><span class="na">getMetaData</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">numCols</span> <span class="o">=</span> <span class="n">rsmd</span><span class="p">.</span><span class="na">getColumnCount</span><span class="p">();</span>

    <span class="c1">// include the headers row</span>
    <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numCols</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">);</span>
      <span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span> <span class="n">rsmd</span><span class="p">.</span><span class="na">getColumnName</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="n">bw</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">sb</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
    <span class="n">bw</span><span class="p">.</span><span class="na">newLine</span><span class="p">();</span>

    <span class="c1">// add data rows</span>
    <span class="n">XRow</span> <span class="n">xRow</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XRow</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">rs</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numCols</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
          <span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">);</span>
        <span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">xRow</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="n">bw</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">sb</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
      <span class="n">bw</span><span class="p">.</span><span class="na">newLine</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">bw</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Unable to store result set to &quot;</span> <span class="o">+</span> <span class="n">fnm</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of saveResultSet();</span>
</code></pre></div>
<p>SaveToCSV.java shows how to call Base.saveDatabase():</p>
<div class="highlight"><pre><span></span><code><span class="c1">// in SaveToCSV.java</span>
<span class="n">XOfficeDatabaseDocument</span> <span class="n">dbDoc</span> <span class="o">=</span> <span class="n">Base</span><span class="p">.</span><span class="na">openBaseDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
<span class="n">XDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">dbDoc</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
<span class="n">XConnection</span>  <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="n">Base</span><span class="p">.</span><span class="na">saveDatabase</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
</code></pre></div>
<p>There are third-party libraries for reading and writing CSV files. For example,
OpenCSV (<a href="https://opencsv.sourceforge.net/">https://opencsv.sourceforge.net/</a>) includes a CSVWriter.writeAll() method
for storing a JDBC result set. I can't utilize it (without changes) since the sdbc result
set is a different type.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="34-JDBC_to_Base_API.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Chapter 34. From JDBC to the Base API" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Chapter 34. From JDBC to the Base API
            </div>
          </div>
        </a>
      
      
        
        <a href="36-RowSets_DB_Context.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 36. Using RowSets and Database Context" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 36. Using RowSets and Database Context
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>