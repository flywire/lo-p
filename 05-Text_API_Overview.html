
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="LibreOffice Programming (LO-P) is intended for programmers who want  to learn how to use the the LibreOffice API. This allows programs to control  and manipulate LibreOffice's text, drawing, presentation, spreadsheet, and  database applications, and a lot more (e.g. its spell checker, forms  designer, and charting tools).  ">
      
      
      
        <link rel="canonical" href="https://flywire.github.io/lo-p/05-Text_API_Overview.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.8">
    
    
      
        <title>Chapter 5. Text API Overview - LibreOffice Programming</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6e60f8b8.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="css/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-5-text-api-overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="LibreOffice Programming" class="md-header__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LibreOffice Programming
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 5. Text API Overview
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="LibreOffice Programming" class="md-nav__button md-logo" aria-label="LibreOffice Programming" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LibreOffice Programming
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flywire/lo-p/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lo-p
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Preface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01%20Part%201%20Basics.html" class="md-nav__link">
        Part 1 Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="01-Concepts.html" class="md-nav__link">
        Chapter 1. LibreOffice API Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02-Starting_and_Stopping.html" class="md-nav__link">
        Chapter 2. Starting and Stopping
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03-Examining.html" class="md-nav__link">
        Chapter 3. Examining
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04-Listening.html" class="md-nav__link">
        Chapter 4. Listening, and Other Techniques
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05%20Part%202%20Writer.html" class="md-nav__link">
        Part 2 Writer
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Chapter 5. Text API Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="05-Text_API_Overview.html" class="md-nav__link md-nav__link--active">
        Chapter 5. Text API Overview
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-an-overview-of-the-text-document-api" class="md-nav__link">
    1.  An Overview of the Text Document API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-extracting-text-from-a-document" class="md-nav__link">
    2.  Extracting Text from a Document
  </a>
  
    <nav class="md-nav" aria-label="2.  Extracting Text from a Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-problem-with-writegetalltext" class="md-nav__link">
    A Problem with Write.getAllText()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-cursor-iteration" class="md-nav__link">
    3.  Cursor Iteration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-cursors" class="md-nav__link">
    4.  Creating Cursors
  </a>
  
    <nav class="md-nav" aria-label="4.  Creating Cursors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-counting-words" class="md-nav__link">
    4.1.  Counting Words
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-displaying-lines" class="md-nav__link">
    4.2.  Displaying Lines
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-creating-a-document" class="md-nav__link">
    5.  Creating a Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-using-and-comparing-text-cursors" class="md-nav__link">
    6.  Using and Comparing Text Cursors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-insertingchanging-text-in-a-document" class="md-nav__link">
    7.  Inserting/Changing Text in a Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-treating-a-document-as-paragraphs-and-text-portions" class="md-nav__link">
    8.  Treating a Document as Paragraphs and Text Portions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-appending-documents-together" class="md-nav__link">
    9.  Appending Documents Together
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="06-Text_Styles.html" class="md-nav__link">
        Chapter 6. Text Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07-Non-text_Content.html" class="md-nav__link">
        Chapter 7. Text Content Other than Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="08-Graphic_Content.html" class="md-nav__link">
        Chapter 8. Graphic Content
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="09-Text_Search.html" class="md-nav__link">
        Chapter 9. Text Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10-Linguistics.html" class="md-nav__link">
        Chapter 10. The Linguistics API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11%20Part%203%20Draw%20%26%20Impress.html" class="md-nav__link">
        Part 3 Draw & Impress
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="11-Draw_Impress_APIs.html" class="md-nav__link">
        Chapter 11. Draw/Impress APIs Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="12-Examining_DrawImpress.html" class="md-nav__link">
        Chapter 12. Examining a Draw/Impress Document
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="13-Basic_Shapes.html" class="md-nav__link">
        Chapter 13. Drawing Basic Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="14-Animation.html" class="md-nav__link">
        Chapter 14. Animation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="15-Complex_Shapes.html" class="md-nav__link">
        Chapter 15. Complex Shapes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="16-Making_Slides.html" class="md-nav__link">
        Chapter 16. Making Slides
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="17-Slide_Deck_Manipulation.html" class="md-nav__link">
        Chapter 17. Slide Deck Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="18-Slide_Shows.html" class="md-nav__link">
        Chapter 18. Slide Shows
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19%20Part%204%20Calc.html" class="md-nav__link">
        Part 4 Calc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="19-Calc_API_Overview.html" class="md-nav__link">
        Chapter 19. Calc API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="20-Spreadsheet_Manipulation.html" class="md-nav__link">
        Chapter 20. Spreadsheet Displaying and Creation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="21-Extracting_Data.html" class="md-nav__link">
        Chapter 21. Extracting Data
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="22-Styles.html" class="md-nav__link">
        Chapter 22. Styles
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="23-Garlic_Secrets.html" class="md-nav__link">
        Chapter 23. Garlic Secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="24-Complex_Data_Manipulation.html" class="md-nav__link">
        Chapter 24. Complex Data Manipulation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="25-Monitoring_Sheets.html" class="md-nav__link">
        Chapter 25. Monitoring Sheets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="26-Search_Replace.html" class="md-nav__link">
        Chapter 26. Search and Replace
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="27-Funcs_Analysis.html" class="md-nav__link">
        Chapter 27. Functions and Data Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28%20Part%205%20Chart.html" class="md-nav__link">
        Part 5 Chart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="28-Chart2_API_Overview.html" class="md-nav__link">
        Chapter 28. Chart2 API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="29-Column_Charts.html" class="md-nav__link">
        Chapter 29. Column Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="30-Bar_Pie_Area_Line_Charts.html" class="md-nav__link">
        Chapter 30. Bar, Pie, Area, Line Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="31-XY_Scatter_Charts.html" class="md-nav__link">
        Chapter 31. XY (Scatter) Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="32-Bubble_Net_Stock_Charts.html" class="md-nav__link">
        Chapter 32. Bubble, Net, Stock Charts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="33-Charts_in_Others_Docs.html" class="md-nav__link">
        Chapter 33. Using Charts in Other Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34%20Part%206%20Base.html" class="md-nav__link">
        Part 6 Base
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="34-JDBC_to_Base_API.html" class="md-nav__link">
        Chapter 34. From JDBC to the Base API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="35-Examining_Base_Docs.html" class="md-nav__link">
        Chapter 35. Examining Base Documents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="36-RowSets_DB_Context.html" class="md-nav__link">
        Chapter 36. Using RowSets and Database Context
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="37-Driver_Manager.html" class="md-nav__link">
        Chapter 37. Using the Driver Manager
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="38-ODB_as_Zip.html" class="md-nav__link">
        Chapter 38. Treating an ODB File as a Zipped Folder
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39%20Part%207%20Cross-application.html" class="md-nav__link">
        Part 7 Cross-application
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="39-Forms_API_Overview.html" class="md-nav__link">
        Chapter 39. Forms API Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="40-Building_a_Form.html" class="md-nav__link">
        Chapter 40. Building a Form Programmatically
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="41-Printing.html" class="md-nav__link">
        Chapter 41. Printing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="42-Sending_E-mail.html" class="md-nav__link">
        Chapter 42. Sending E-mail
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="43-Using_the_Clipboard.html" class="md-nav__link">
        Chapter 43. Using the Clipboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="44-Office_as_GUI_Comp.html" class="md-nav__link">
        Chapter 44. Office as a GUI Component
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45%20Part%208%20Extending%20LibreOffice.html" class="md-nav__link">
        Part 8 Extending LibreOffice
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="45-UNO_Components.html" class="md-nav__link">
        Chapter 45. Coding UNO Components
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="46-Addons.html" class="md-nav__link">
        Chapter 46. Add-ons
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="47-Calc_Add-ins.html" class="md-nav__link">
        Chapter 47. Calc Add-ins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="48-Event_Macros.html" class="md-nav__link">
        Chapter 48. Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="49-Ext_Doc_Event_Macros.html" class="md-nav__link">
        Chapter 49. Extension and Document Event Macros
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50%20Part%209%20The%20ODF%20Format.html" class="md-nav__link">
        Part 9 The ODF Format
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="50-Importing_XML.html" class="md-nav__link">
        Chapter 50. Importing XML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="51-Simple_ODF.html" class="md-nav__link">
        Chapter 51. Simple ODF
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-an-overview-of-the-text-document-api" class="md-nav__link">
    1.  An Overview of the Text Document API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-extracting-text-from-a-document" class="md-nav__link">
    2.  Extracting Text from a Document
  </a>
  
    <nav class="md-nav" aria-label="2.  Extracting Text from a Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-problem-with-writegetalltext" class="md-nav__link">
    A Problem with Write.getAllText()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-cursor-iteration" class="md-nav__link">
    3.  Cursor Iteration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-cursors" class="md-nav__link">
    4.  Creating Cursors
  </a>
  
    <nav class="md-nav" aria-label="4.  Creating Cursors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-counting-words" class="md-nav__link">
    4.1.  Counting Words
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-displaying-lines" class="md-nav__link">
    4.2.  Displaying Lines
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-creating-a-document" class="md-nav__link">
    5.  Creating a Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-using-and-comparing-text-cursors" class="md-nav__link">
    6.  Using and Comparing Text Cursors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-insertingchanging-text-in-a-document" class="md-nav__link">
    7.  Inserting/Changing Text in a Document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-treating-a-document-as-paragraphs-and-text-portions" class="md-nav__link">
    8.  Treating a Document as Paragraphs and Text Portions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-appending-documents-together" class="md-nav__link">
    9.  Appending Documents Together
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/flywire/lo-p/edit/main/docs/05-Text_API_Overview.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="chapter-5-text-api-overview">Chapter 5. Text API Overview<a class="headerlink" href="#chapter-5-text-api-overview" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Topics</p>
<p>API Overview;
Text Cursors; Extracting
Text; Cursor Iteration;
Creating Cursors;
Creating a Document;
Using and Comparing
Text Cursors;
Inserting/Changing Text
in a Document; Text
Enumeration;
Appending Documents</p>
<p>Example folders: "Text
Tests" and "Utils"</p>
</div>
<p>The next few chapters look at programming with the text
document part of the Office API. This chapter begins with
a quick overview of the text API, then a detailed look at
text cursors for moving about in a document, extracting
text, and adding/inserting new text.</p>
<p>Text cursors aren't the only way to move around inside a
document; it's also possible to iterate over a document by
treating it as a sequence of paragraphs.</p>
<p>The chapter finishes with a look at how two (or more) text
documents can be appended.</p>
<p>The online Developer's Guide begins text document programming at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/Text/Text_Documents">https://wiki.openoffice.org/wiki/Documentation/DevGuide/Text/Text_Documents</a>
(the easiest way of accessing that page is to type loguide writer). It corresponds to
Chapter 7 in the printed guide (available at
<a href="https://wiki.openoffice.org/w/images/d/d9/DevelopersGuide_OOo3.1.0.pdf">https://wiki.openoffice.org/w/images/d/d9/DevelopersGuide_OOo3.1.0.pdf</a>), but the
Web material is better structured and formatted.</p>
<p>The guide's text programming examples are in TextDocuments.java, downloadable
from <a href="https://api.libreoffice.org/examples/DevelopersGuide/examples.html#Text">https://api.libreoffice.org/examples/DevelopersGuide/examples.html#Text</a>.</p>
<p>Although the code is long, it's well-organized. Some smaller text processing examples
are available at <a href="https://api.libreoffice.org/examples/examples.html#Java_examples">https://api.libreoffice.org/examples/examples.html#Java_examples</a>.</p>
<p>This chapter (and later ones) assume that you're familiar with Writer, including text
concepts such as paragraph styles. If you're not, then I recommend the "Writer
Guide", a user manual, available at <a href="https://libreoffice.org/get-help/documentation">https://libreoffice.org/get-help/documentation</a>
or <a href="https://wiki.documentfoundation.org/Documentation/Publications">https://wiki.documentfoundation.org/Documentation/Publications</a>.</p>
<h2 id="1-an-overview-of-the-text-document-api">1.  An Overview of the Text Document API<a class="headerlink" href="#1-an-overview-of-the-text-document-api" title="Permanent link">&para;</a></h2>
<p>The API is centered around four text document services which subclass
OfficeDocument, as shown in Figure 1.</p>
<p><img alt="" src="images/05-Text_API_Overview-1.png" /></p>
<p>Figure 1. The Text Document Services.</p>
<p>I'll be concentrating on the TextDocument service, which is documented at
<a href="https://api.libreoffice.org/docs/idl/ref/servicecom_1_1sun_1_1star_1_1text_1_1TextDocument.html">https://api.libreoffice.org/docs/idl/ref/servicecom_1_1sun_1_1star_1_1text_1_1TextDocument.html</a>.
Or you can type <code>lodoc TextDocument service</code>, which unfortunately
takes you to the IDL page for TextDocument; to reach the documentation, click on
"TextDocument" under the "Classes" heading.</p>
<p>The GlobalDocument service in Figure 1 is employed by master documents, such as a
book or thesis. A master document is typically made up of links to files holding its
parts, such as chapters, bibliography, and appendices.</p>
<p>The WebDocument service in Figure 1 is for manipulating web pages, although its
also possible to generate HTML files with the TextDocument service.</p>
<p>TextDocument, GlobalDocument, and WebDocument are mostly empty because those
services don't define any interfaces or properties. The GenericTextDocument service
is where  the action takes place, as summarized in Figure 2.</p>
<p><img alt="" src="images/05-Text_API_Overview-2.png" /></p>
<p>Figure 2. The Text Document Services, and some Interfaces.</p>
<p>The numerous 'Supplier' interfaces in Figure 2 are Office's way of accessing different
elements in a document. For example, XStyleFamiliesSupplier manages character,
paragraph, and other styles, while XTextTableSupplier deals with tables.</p>
<p>I'll be looking at these suppliers in later chapters, which is why they're highlighted,
but for now let's only consider the XTextDocument interface at the top right of the
GenericTextDocument service box in Figure 2
XTextDocument has a getText() method for returning an XText object. XText
supports functionality related to text ranges and positions, cursors, and text contents.</p>
<p>It inherits XSimpleText and XTextRange, as indicated in Figure 3.</p>
<p><img alt="" src="images/05-Text_API_Overview-3.png" /></p>
<p>Figure 3. XText and its Superclasses.</p>
<p>Text content covers a multitude, such as embedded images, tables, footnotes, and text
fields. Many of the suppliers shown in Figure 2 (e.g. XTextTablesSupplier) are for
iterating through text content (e.g. accessing the document's tables).</p>
<p>I'll concentrate on ordinary text in this chapter, and look at more esoteric content
forms in Chapters 7 and 8.</p>
<p>A text document can utilize eight different cursors, which fall into two groups, as in</p>
<p><img alt="" src="images/05-Text_API_Overview-4.png" /></p>
<p>Figure 4.</p>
<p><img alt="" src="images/05-Text_API_Overview-4.png" /></p>
<p>Figure 4. Types of Cursor.</p>
<p>XTextCursor contains methods for moving around the document, and an instance is
often called a model cursor because of its close links to the document's data. A
program can create multiple XTextCursor objects if it wants, and can convert an
XTextCursor into XParagraphCursor, XSentenceCursor, or XWordCursor. The
differences are that while an XTextCursor moves through a document character by
character, the others travel in units of paragraphs, sentences, and words.</p>
<p>A program may employ a single XTextViewCursor cursor, to represent the cursor the
user sees in the Writer application window; for this reason, it's often called the view
cursor. XTextViewCursor can be converted into a XLineCursor, XPageCursor, or
XScreenCursor object, which allows it to move in terms of lines, pages, or screens.</p>
<p>A cursor's location is specified using a text range, which can be the currently selected
text, or a position in the document. A text position is a text range that begins and ends
at the same point.</p>
<h2 id="2-extracting-text-from-a-document">2.  Extracting Text from a Document<a class="headerlink" href="#2-extracting-text-from-a-document" title="Permanent link">&para;</a></h2>
<p>The ExtractText.java example opens a document using Lo.openOffice(), and tries to
print its text:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: ExtractText fnm&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="na">isDocType</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">Lo</span><span class="p">.</span><span class="na">WRITER_SERVICE</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">XTextDocument</span> <span class="n">textDoc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getTextDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
    <span class="n">XTextCursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getCursor</span><span class="p">(</span><span class="n">textDoc</span><span class="p">);</span>
    <span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getAllText</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;--------- Text Content --------&quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;-------------------------------&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Extraction unsupported for this doc type&quot;</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span> <span class="c1">// end of main()</span>
</code></pre></div>
</div>
</div>
</div>
<p>Info.isDocType() tests the document's type by casting it into an XServiceInfo
interface. Then it calls XServiceInfo.supportsService() to check the document's
service capabilities:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isDocType</span><span class="p">(</span><span class="n">Object</span> <span class="n">doc</span><span class="p">,</span> <span class="n">String</span> <span class="n">docType</span><span class="p">)</span>
<span class="c1">// in the Info utility class</span>
<span class="p">{</span> <span class="n">XServiceInfo</span> <span class="n">si</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XServiceInfo</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">si</span><span class="p">.</span><span class="na">supportsService</span><span class="p">(</span><span class="n">docType</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>The argument type of the document is Object rather than XComponent so that a wider
range of objects can be passed to the function for testing.</p>
<p>The service names for documents are hard to remember, so they're defined as
constants in my Lo class:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">WRITER_SERVICE</span> <span class="o">=</span>
               <span class="s">&quot;com.sun.star.text.TextDocument&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">BASE_SERVICE</span> <span class="o">=</span>
               <span class="s">&quot;com.sun.star.sdb.OfficeDatabaseDocument&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CALC_SERVICE</span> <span class="o">=</span>
               <span class="s">&quot;com.sun.star.sheet.SpreadsheetDocument&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DRAW_SERVICE</span> <span class="o">=</span>
               <span class="s">&quot;com.sun.star.drawing.DrawingDocument&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">IMPRESS_SERVICE</span> <span class="o">=</span>
              <span class="s">&quot;com.sun.star.presentation.PresentationDocument&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MATH_SERVICE</span> <span class="o">=</span>
              <span class="s">&quot;com.sun.star.formula.FormulaProperties&quot;</span><span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
<p>Write.getTextDoc() uses Lo.qi() to cast the document's XComponent interface into an
XTextDocument:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Lo class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">WRITER_SERVICE</span> <span class="o">=</span>
               <span class="s">&quot;com.sun.star.text.TextDocument&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">BASE_SERVICE</span> <span class="o">=</span>
               <span class="s">&quot;com.sun.star.sdb.OfficeDatabaseDocument&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CALC_SERVICE</span> <span class="o">=</span>
               <span class="s">&quot;com.sun.star.sheet.SpreadsheetDocument&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DRAW_SERVICE</span> <span class="o">=</span>
               <span class="s">&quot;com.sun.star.drawing.DrawingDocument&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">IMPRESS_SERVICE</span> <span class="o">=</span>
              <span class="s">&quot;com.sun.star.presentation.PresentationDocument&quot;</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MATH_SERVICE</span> <span class="o">=</span>
              <span class="s">&quot;com.sun.star.formula.FormulaProperties&quot;</span><span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
<p>TextDocument textDoc = Lo.qi(XTextDocument.class, doc);
This may fail (i.e. return null) if the loaded document isn't an instance of the
TextDocument service.</p>
<p>The casting 'power' of Lo.qi() is confusing â€“ it depends on the document's service
type. All text documents are instances of the TextDocument service (see Figure 2).
This means that Lo.qi() can 'switch' between any of the interfaces defined by
TextDocument or its superclasses (i.e. the interfaces in GenericTextDocument or
OfficeDocument). For instance, the following cast is fine:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XStyleFamiliesSupplier</span> <span class="n">xSupplier</span> <span class="o">=</span>
                   <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XStyleFamiliesSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>This changes the instance into an XStyleFamiliesSupplier, which can access the
document's styles.</p>
<p>Alternatively, the following converts the instance into a supplier defined in
OfficeDocument:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XDocumentPropertiesSupplier</span> <span class="n">xSupplier</span> <span class="o">=</span>
               <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDocumentPropertiesSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>Most of the examples in this chapter and the next few cast the document to
XTextDocument since that interface can access the document's contents as an XText
object:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XTextDocument</span> <span class="n">textDoc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextDocument</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="n">XText</span> <span class="n">xText</span> <span class="o">=</span> <span class="n">textDoc</span><span class="p">.</span><span class="na">getText</span><span class="p">();</span>
</code></pre></div>
</div>
</div>
</div>
<p>The XText instance can access all the capabilities shown in Figure 3.</p>
<p>A common next step is to create a cursor for moving around the document. This is
easy since XText inherits XSimpleText which has a createTextCursor() method:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XTextCursor</span> <span class="n">textCursor</span> <span class="o">=</span> <span class="n">xText</span><span class="p">.</span><span class="na">createTextCursor</span><span class="p">();</span>
</code></pre></div>
</div>
</div>
</div>
<p>These few lines are so useful that I've put them inside a Write.getCursor() method:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:1"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">XTextCursor</span> <span class="nf">getCursor</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">textDoc</span><span class="p">)</span>
<span class="c1">// get cursor from a text document</span>
<span class="p">{</span>
  <span class="n">XText</span> <span class="n">xText</span> <span class="o">=</span> <span class="n">textDoc</span><span class="p">.</span><span class="na">getText</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">xText</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Text not found in document&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">xText</span><span class="p">.</span><span class="na">createTextCursor</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of getCursor()</span>
</code></pre></div>
</div>
</div>
</div>
<p>An XTextCursor can be converted into other kinds of model cursors (e.g.</p>
<p>XParagraphCursor, XSentenceCursor, XWordCursor; see Figure 4). That's not
necessary in for the ExtractText.java example; instead, the XTextCursor is passed to
Write.getAllText() to access the text as a sequence of characters:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getAllText</span><span class="p">(</span><span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cursor</span><span class="p">.</span><span class="na">gotoStart</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="n">cursor</span><span class="p">.</span><span class="na">gotoEnd</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="na">getString</span><span class="p">();</span>
  <span class="n">cursor</span><span class="p">.</span><span class="na">gotoEnd</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>    <span class="c1">// to deselect everything in the doc</span>
  <span class="k">return</span> <span class="n">text</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of getAllText()</span>
</code></pre></div>
</div>
</div>
</div>
<p>All cursor movement operations take a boolean argument which specifies whether the
movement should also select the text. For example, in getAllText(),
cursor.gotoStart(false) shifts the cursor to the start of the text without selecting
anything. The subsequent call to cursor.gotoEnd(true) moves the cursor to the end of
the text and selects all the text moved over. The call to getString() on the third line
returns the selection (i.e. all the text in the document).</p>
<p>Two other useful XTextCursor methods are:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kt">boolean</span> <span class="nf">goLeft</span><span class="p">(</span><span class="kt">short</span> <span class="n">charCount</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isSelected</span><span class="p">)</span>
<span class="kt">boolean</span> <span class="nf">goRight</span><span class="p">(</span><span class="kt">short</span> <span class="n">charCount</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isSelected</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>
<p>They move the cursor left or right by a given number of characters, and the boolean
argument specifies whether the text moved over is selected.</p>
<p>All cursor methods return a boolean result which indicates if the move (and optional
selection) was successful.</p>
<p>Another method worth knowing is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:1"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kt">boolean</span> <span class="nf">gotoRange</span><span class="p">(</span><span class="n">XTextRange</span> <span class="n">textRange</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isSelected</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>
<p>gotoRange() takes an XTextRange argument, which represents a selected region or
position where the cursor should be moved to. For example, it's possible to find a
bookmark in a document, extract its text range/position, and move the cursor to that
location with gotoRange(). I'll show code for doing this in Chapter 7.</p>
<p>The XTextCursor methods are documented at
<a href="https://api.libreoffice.org/docs/idl/ref/interfacecom_1_1sun_1_1star_1_1text_1_1XTextCursor.html">https://api.libreoffice.org/docs/idl/ref/interfacecom_1_1sun_1_1star_1_1text_1_1XTextCursor.html</a>
(or type <code>lodoc XTextCursor</code>).</p>
<h4 id="a-problem-with-writegetalltext">A Problem with Write.getAllText()<a class="headerlink" href="#a-problem-with-writegetalltext" title="Permanent link">&para;</a></h4>
<p>Write.getAllText() may fail if supplied with a very large document because
XTextCursor.getString() might be unable to construct a big enough String object. For
that reason, it's better to iterate over large documents returning a paragraph of text at a
time. These iteration techniques are described next.</p>
<h2 id="3-cursor-iteration">3.  Cursor Iteration<a class="headerlink" href="#3-cursor-iteration" title="Permanent link">&para;</a></h2>
<p>My HighlightText.java example uses paragraph and word cursors (i.e. the
XParagraphCursor and XWordCursor interfaces in Figure 4). It also employs the view
cursor, an XTextViewCursor instance, to control the Writer application's visible
cursor.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:1"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">The</span> <span class="nf">main</span><span class="p">()</span> <span class="n">function</span> <span class="n">of</span> <span class="n">HighlightText</span><span class="p">:</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[]</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: run HighlightText &lt;fnm&gt;&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XTextDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">openDoc</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not open &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>  <span class="c1">// make doc visible on-screen</span>

  <span class="n">showParagraphs</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Word count: &quot;</span> <span class="o">+</span> <span class="n">countWords</span><span class="p">(</span><span class="n">doc</span><span class="p">));</span>
  <span class="n">showLines</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of main()</span>
</code></pre></div>
</div>
</div>
</div>
<p>main() calls Write.openDoc() to return the opened document as an XTextDocument
instance. If you recall, the previous ExtractText.java example started with an
XComponent instance by calling Lo.openDoc(), and then converted it to
XTextDocument. Write.openDoc() returns the XTextDocument reference in one go.</p>
<p>showParagraphs() moves the visible on-screen cursor through the document,
highlighting a paragraph at a time. This requires two cursors â€“ an instance of
XTextViewCursor and a separate XParagraphCursor. The paragraph cursor is capable
of moving through the document paragraph-by-paragraph, but it's a model cursor, so
invisible to the user looking at the document on-screen. showParagraphs() extracts the
start and end positions of each paragraph and uses them to move the view cursor,
which is visible.</p>
<p>The code for showParagraphs():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:1"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showParagraphs</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XTextViewCursor</span> <span class="n">tvc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">XParagraphCursor</span> <span class="n">paraCursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getParagraphCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">paraCursor</span><span class="p">.</span><span class="na">gotoStart</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
              <span class="c1">// go to start of text; no selection</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">paraCursor</span><span class="p">.</span><span class="na">gotoEndOfParagraph</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="c1">// select 1 paragraph</span>
    <span class="n">String</span> <span class="n">currPara</span> <span class="o">=</span> <span class="n">paraCursor</span><span class="p">.</span><span class="na">getString</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">currPara</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// move view cursor to highlight current paragraph</span>
      <span class="n">tvc</span><span class="p">.</span><span class="na">gotoRange</span><span class="p">(</span> <span class="n">paraCursor</span><span class="p">.</span><span class="na">getStart</span><span class="p">(),</span> <span class="kc">false</span><span class="p">);</span>
      <span class="n">tvc</span><span class="p">.</span><span class="na">gotoRange</span><span class="p">(</span> <span class="n">paraCursor</span><span class="p">.</span><span class="na">getEnd</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>

      <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>   <span class="c1">// slow down paragraph changing speed</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">paraCursor</span><span class="p">.</span><span class="na">gotoNextParagraph</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
<span class="p">}</span>  <span class="c1">// end of showParagraphs()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The code utilizes two Write utility functions (Write.getViewCursor() and
Write.getParagraphCursor()) to create the cursors. The subsequent do-while loop is a
common coding pattern for iterating over a text document:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:1"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">paraCursor</span><span class="p">.</span><span class="na">gotoStart</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="k">do</span> <span class="p">{</span>
  <span class="n">paraCursor</span><span class="p">.</span><span class="na">gotoEndOfParagraph</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>   <span class="c1">// select 1 paragraph</span>

  <span class="c1">// do something to the selected text range...</span>

<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">paraCursor</span><span class="p">.</span><span class="na">gotoNextParagraph</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
</code></pre></div>
</div>
</div>
</div>
<p>gotoNextParagraph() tries to move the cursor to the beginning of the next paragraph.</p>
<p>If the moves fails (i.e. when the cursor has reached the end of the document), the
function returns false, and the loop terminates.</p>
<p>The call to gotoEndOfParagraph() at the beginning of the loop moves the cursor to the
end of the paragraph and selects its text. Since the cursor was originally at the start of
the paragraph, the selection will span that paragraph.</p>
<p>XParagraphCursor and the sentence and word cursors inherit XTextCursor, as shown
in Figure 5.</p>
<p><img alt="" src="images/05-Text_API_Overview-5.png" /></p>
<p>Figure 5. The Model Cursors Inheritance Hierarchy.</p>
<p>Since all these cursors also inherit XTextRange, they can easily access and change
their text selections/positions. In the showParagraphs() method above, the two ends of
the paragraph are obtained by calling the inherited XTextRange.getStart() and
XTextRange.getEnd(), and the positions are used to move the view cursor:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:1"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XTextViewCursor</span> <span class="n">tvc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
       <span class="p">:</span>
<span class="n">tvc</span><span class="p">.</span><span class="na">gotoRange</span><span class="p">(</span><span class="n">paraCursor</span><span class="p">.</span><span class="na">getStart</span><span class="p">(),</span> <span class="kc">false</span><span class="p">);</span>
<span class="n">tvc</span><span class="p">.</span><span class="na">gotoRange</span><span class="p">(</span><span class="n">paraCursor</span><span class="p">.</span><span class="na">getEnd</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>gotoRange() sets the text range/position of the view cursor: the first call moves the
cursor to the paragraph's starting position without selecting anything, and the second
moves it to the end position, selecting all the text in between. Since this is a view
cursor, the selection is visible on-screen, as illustrated in Figure 6.</p>
<p><img alt="" src="images/05-Text_API_Overview-6.png" /></p>
<p>Figure 6. A Selected Paragraph.</p>
<p>Note that getStart() and getEnd() do not return integers but collapsed text ranges,
which is Office-lingo for a range that starts and ends at the same cursor position.</p>
<p>Somewhat confusingly, the XTextViewCursor interface inherits XTextCursor (as
shown in Figure 7). This only means that XTextViewCursor supports the same
character-based movement and text range operations as the model-based cursor.</p>
<p><img alt="" src="images/05-Text_API_Overview-7.png" /></p>
<p>Figure 7. The XTextViewCursor Inheritance Hierarchy.</p>
<h2 id="4-creating-cursors">4.  Creating Cursors<a class="headerlink" href="#4-creating-cursors" title="Permanent link">&para;</a></h2>
<p>An XTextCursor is created by calling Write.getCursor(), which can then be converted
into a paragraph, sentence, or word cursor by using Lo.qi(). For example, the Write
utility class defines getParagraphCursor() as:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:1"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">XParagraphCursor</span> <span class="nf">getParagraphCursor</span><span class="p">(</span>
                                      <span class="n">XTextDocument</span> <span class="n">textDoc</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XTextCursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">getCursor</span><span class="p">(</span><span class="n">textDoc</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">cursor</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Text cursor is null&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XParagraphCursor</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cursor</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of getParagraphCursor()</span>
</code></pre></div>
</div>
</div>
</div>
<p>Obtaining the view cursor is a little more tricky since it's only accessible via the
document's controller.</p>
<p>As described in Chapter 1, section 5 about the FCM relationship, the controller is
reached via the document's model, as shown in the first two lines of
Write.getViewCursor():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:1"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="__tabbed_18_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">XTextViewCursor</span> <span class="nf">getViewCursor</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">textDoc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XModel</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">textDoc</span><span class="p">);</span>
  <span class="n">XController</span> <span class="n">xController</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="na">getCurrentController</span><span class="p">();</span>

  <span class="c1">// the controller supplies the TextViewCursor</span>
  <span class="n">XTextViewCursorSupplier</span> <span class="n">supplier</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span>
                   <span class="n">XTextViewCursorSupplier</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xController</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">supplier</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of getViewCursor()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The view cursor isn't directly accessible from the controller; a supplier must be
queried, even though there's only one view cursor per document.</p>
<h3 id="41-counting-words">4.1.  Counting Words<a class="headerlink" href="#41-counting-words" title="Permanent link">&para;</a></h3>
<p>countWords() in HightlightText.java shows how to iterate over the document using a
word cursor:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:1"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="__tabbed_19_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">countWords</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XWordCursor</span> <span class="n">wordCursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getWordCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">wordCursor</span><span class="p">.</span><span class="na">gotoStart</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>     <span class="c1">// go to start of text</span>

  <span class="kt">int</span> <span class="n">wordCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">String</span> <span class="n">currWord</span><span class="p">;</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">wordCursor</span><span class="p">.</span><span class="na">gotoEndOfWord</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="n">currWord</span> <span class="o">=</span> <span class="n">wordCursor</span><span class="p">.</span><span class="na">getString</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">currWord</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">wordCount</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">while</span><span class="p">(</span> <span class="n">wordCursor</span><span class="p">.</span><span class="na">gotoNextWord</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">wordCount</span><span class="p">;</span>
<span class="p">}</span>  <span class="c1">// end of countWords()</span>
</code></pre></div>
</div>
</div>
</div>
<p>This uses the same kind of do-while loop as showParagraphs() except that the
XTextWordCursor methods gotoEndOfWord() and gotoNextWord() control the
iteration. Also, there's no need for an XTextViewCursor instance since the selected
words aren't shown on the screen.</p>
<h3 id="42-displaying-lines">4.2.  Displaying Lines<a class="headerlink" href="#42-displaying-lines" title="Permanent link">&para;</a></h3>
<p>showLines() in HightlightText.java iterates over the document highlighting a line at a
time. Don't confuse this with sentence selection because a sentence may consist of
several lines on the screen. A sentence is part of the text's organization (i.e. in terms
of words, sentences, and paragraphs) while a line is part of the document view (i.e.</p>
<p>line, page, screen). This means that XLineCursor is a view cursor, which is obtained
by converting XTextViewCursor with Lo.qi():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="20:1"><input checked="checked" id="__tabbed_20_1" name="__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="__tabbed_20_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XTextViewCursor</span> <span class="n">tvc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">XLineCursor</span> <span class="n">lineCursor</span> <span class="o">=</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XLineCursor</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">tvc</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>The line cursor has limited functionality compared to the model cursors (paragraph,
sentence, word). In particular, there's no "next' function for moving to the next line
(unlike gotoNextParagraph() or gotoNextWord()). The screen cursor also lacks this
ability, but the page cursor offers jumpToNextPage().</p>
<p>One way of getting around the absence of a 'next' operation is shown in showLines():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="21:1"><input checked="checked" id="__tabbed_21_1" name="__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="__tabbed_21_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showLines</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XTextViewCursor</span> <span class="n">tvc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">tvc</span><span class="p">.</span><span class="na">gotoStart</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>     <span class="c1">// go to start of text</span>

  <span class="n">XLineCursor</span> <span class="n">lineCursor</span> <span class="o">=</span>
         <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XLineCursor</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">tvc</span><span class="p">);</span>

  <span class="kt">boolean</span> <span class="n">haveText</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">lineCursor</span><span class="p">.</span><span class="na">gotoStartOfLine</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="n">lineCursor</span><span class="p">.</span><span class="na">gotoEndOfLine</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>  <span class="c1">// select 1 line</span>

    <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>   <span class="c1">// slow down the line changing speed</span>
    <span class="n">tvc</span><span class="p">.</span><span class="na">collapseToEnd</span><span class="p">();</span>  <span class="c1">// make selection disappear</span>

    <span class="n">haveText</span> <span class="o">=</span> <span class="n">tvc</span><span class="p">.</span><span class="na">goRight</span><span class="p">((</span><span class="kt">short</span><span class="p">)</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">// move 1 char</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">haveText</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of showLines()</span>
</code></pre></div>
</div>
</div>
</div>
<p>The view cursor is manipulated using the XTextViewCursor object and the
XLineCursor line cursor. This is possible since the two references point to the same
on-screen cursor. Either one can move it around the display.</p>
<p>Inside the loop, XLineCursor's gotoStartOfLine() and gotoEndOfLine() highlight a
single line. Then the XTextViewCursor instance deselects the line, by moving the
cursor to the end of the selection with collapseToEnd(). At the end of the loop,
goRight() tries to move the cursor one character to the right. If goRight() succeeds
then the cursor is shifted one position to the first character of the next line. When the
loop repeats, this line will be selected. If doRight() fails, then there are no more
characters to be read from the document, and the loop finishes.</p>
<h2 id="5-creating-a-document">5.  Creating a Document<a class="headerlink" href="#5-creating-a-document" title="Permanent link">&para;</a></h2>
<p>All the examples so far have involved the manipulation of an existing document. The
HelloText.java example creates a new text document, containing two short
paragraphs, and saves it as "hello.odt". The main() function is:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="22:1"><input checked="checked" id="__tabbed_22_1" name="__tabbed_22" type="radio" /><div class="tabbed-labels"><label for="__tabbed_22_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponentLoader</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">loadOffice</span><span class="p">();</span>
  <span class="n">XTextDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">loader</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Writer doc creation failed&quot;</span><span class="p">);</span>
    <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">GUI</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>    <span class="c1">// make the document visible</span>

  <span class="n">XTextCursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">cursor</span><span class="p">.</span><span class="na">gotoEnd</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
           <span class="c1">// move cursor to end of doc before appending</span>

  <span class="n">Write</span><span class="p">.</span><span class="na">appendPara</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="s">&quot;Hello LibreOffice.\n&quot;</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>   <span class="c1">// slow things down so they can be seen</span>

  <span class="n">Write</span><span class="p">.</span><span class="na">appendPara</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="s">&quot;How are you?.&quot;</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>

  <span class="n">Lo</span><span class="p">.</span><span class="na">saveDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s">&quot;hello.odt&quot;</span><span class="p">);</span>
         <span class="c1">// or use extension doc, docx, rtf, pdf, txt</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">Lo</span><span class="p">.</span><span class="na">closeOffice</span><span class="p">();</span>
<span class="p">}</span> <span class="c1">// end of main()</span>
</code></pre></div>
</div>
</div>
</div>
<p>Write.createDoc() calls Lo.createDoc() with the text document service name (the
Lo.WRITER_STR constant is "swriter"). Office creates a TextDocument service with
an XComponent interface, which is cast to the XTextDocument interface, and
returned:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="23:1"><input checked="checked" id="__tabbed_23_1" name="__tabbed_23" type="radio" /><div class="tabbed-labels"><label for="__tabbed_23_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Write class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">XTextDocument</span> <span class="nf">createDoc</span><span class="p">(</span><span class="n">XComponentLoader</span> <span class="n">loader</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XComponent</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">createDoc</span><span class="p">(</span><span class="n">Lo</span><span class="p">.</span><span class="na">WRITER_STR</span><span class="p">,</span> <span class="n">loader</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextDocument</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Text documents are saved using Lo.saveDoc() which was described in Chapter 2.
saveDoc() examines the filename's extension to determine its type. The known
extensions include doc, docx, rtf, odt, pdf, and txt.</p>
<p>Back in HelloText.java, a cursor is needed before text can be added; one is created by
calling Write.getCursor().</p>
<p>The call to XTextCursor.gotoEnd() isn't really necessary because the new cursor is
pointing to an empty document so is already at its end. It's included to emphasize the
assumption by Write.appendPara() (and other Write.appendXXX() functions) that the
cursor is positioned at the end of the document before new text is added.</p>
<p>Write.appendPara() calls three other methods in the Write utility class:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="24:1"><input checked="checked" id="__tabbed_24_1" name="__tabbed_24" type="radio" /><div class="tabbed-labels"><label for="__tabbed_24_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Write class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">appendPara</span><span class="p">(</span><span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">String</span> <span class="n">text</span><span class="p">)</span>
<span class="p">{</span> <span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">text</span><span class="p">);</span>
  <span class="n">append</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">ControlCharacter</span><span class="p">.</span><span class="na">PARAGRAPH_BREAK</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">getPosition</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>The 'append' name is utilized several times in Write â€“ one version takes a string as its
second argument, the other a short representing a control character:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="25:1"><input checked="checked" id="__tabbed_25_1" name="__tabbed_25" type="radio" /><div class="tabbed-labels"><label for="__tabbed_25_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// in the Write class</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">append</span><span class="p">(</span><span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">String</span> <span class="n">text</span><span class="p">)</span>
<span class="p">{</span> <span class="n">cursor</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="n">cursor</span><span class="p">.</span><span class="na">gotoEnd</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">getPosition</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// end of append()</span>


<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">append</span><span class="p">(</span><span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">,</span> <span class="kt">short</span> <span class="n">ctrlChar</span><span class="p">)</span>
<span class="p">{</span> <span class="n">XText</span> <span class="n">xText</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="na">getText</span><span class="p">();</span>
  <span class="n">xText</span><span class="p">.</span><span class="na">insertControlCharacter</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">ctrlChar</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="n">cursor</span><span class="p">.</span><span class="na">gotoEnd</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">getPosition</span><span class="p">(</span><span class="n">cursor</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>The first append() function uses XTextCursor.setString() to add the user-supplied
string. The second function employs XTextCursor.insertControlCharacter(). After the
addition of the text or character, the cursor is moved to the end of the document, and
getPosition() is called to return the cursor's new position as an integer:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="26:1"><input checked="checked" id="__tabbed_26_1" name="__tabbed_26" type="radio" /><div class="tabbed-labels"><label for="__tabbed_26_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getPosition</span><span class="p">(</span><span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">getString</span><span class="p">()).</span><span class="na">length</span><span class="p">();</span>  <span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>getPosition() is not very robust â€“ it assumes that getString() will be able to convert the
document's text into a string. This may fail if the document is very big (you may
recall the same problem with my Write.getAllText() described earlier).</p>
<p>Office deals with this size issue by using XTextRange instances, which encapsulate
text ranges and positions. Write.getPosition() returns an integer because its easier to
understand when you're first learning to program with Office. It's better style to use
and compare XTextRanges rather than integer positions, an approach I'll demonstrate
in the next section.</p>
<h2 id="6-using-and-comparing-text-cursors">6.  Using and Comparing Text Cursors<a class="headerlink" href="#6-using-and-comparing-text-cursors" title="Permanent link">&para;</a></h2>
<p>My TalkingBook.java example utilizes the third-party library FreeTTS
(<a href="https://freetts.sourceforge.net/">https://freetts.sourceforge.net/</a>) to convert text into speech. The inner workings of
FreeTTS aren't relevant here, so are hidden inside a support class called Speaker. It
has three public methods:</p>
<ul>
<li>Speaker(): instantiates a FreeTTS instance â€“ a male voice</li>
<li>say(String s): converts the string s into speech</li>
<li>dispose(): closes down the FreeTTS instance</li>
</ul>
<p>TalkingBook employs two text cursors: a paragraph cursor that iterates over the
paragraphs in the document, and a sentence cursor that iterates over all the sentences
in the current paragraph and passes each sentence to Speaker.say(). FreeTTS is
capable of speaking long or short sequences of text, but TalkingBook processes a
sentence at a time since this sounds more natural when spoken.</p>
<p>The crucial function in TalkingBook.java is speakSentences():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="27:1"><input checked="checked" id="__tabbed_27_1" name="__tabbed_27" type="radio" /><div class="tabbed-labels"><label for="__tabbed_27_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">speakSentences</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Speaker</span> <span class="n">speaker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Speaker</span><span class="p">();</span>  <span class="c1">// create FreeTTS voice</span>

  <span class="n">XTextViewCursor</span> <span class="n">tvc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">XParagraphCursor</span> <span class="n">paraCursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getParagraphCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">paraCursor</span><span class="p">.</span><span class="na">gotoStart</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>     <span class="c1">// go to start of text</span>

  <span class="c1">// create range comparer for the entire document</span>
  <span class="n">XTextRangeCompare</span> <span class="n">comparer</span> <span class="o">=</span>  <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span>
                        <span class="n">XTextRangeCompare</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">.</span><span class="na">getText</span><span class="p">());</span>

  <span class="n">String</span> <span class="n">currParaStr</span><span class="p">,</span> <span class="n">currSentStr</span><span class="p">;</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">paraCursor</span><span class="p">.</span><span class="na">gotoEndOfParagraph</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>  <span class="c1">// select 1 paragraph</span>
    <span class="n">XTextRange</span> <span class="n">endPara</span> <span class="o">=</span> <span class="n">paraCursor</span><span class="p">.</span><span class="na">getEnd</span><span class="p">();</span>

    <span class="n">currParaStr</span> <span class="o">=</span> <span class="n">paraCursor</span><span class="p">.</span><span class="na">getString</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">currParaStr</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// set sentence cursor to start of paragraph</span>
      <span class="n">XTextCursor</span> <span class="n">cursor</span> <span class="o">=</span>
            <span class="n">paraCursor</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">createTextCursorByRange</span><span class="p">(</span>
                                           <span class="n">paraCursor</span><span class="p">.</span><span class="na">getStart</span><span class="p">());</span>
      <span class="n">XSentenceCursor</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span>
                                  <span class="n">XSentenceCursor</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cursor</span><span class="p">);</span>
      <span class="n">sc</span><span class="p">.</span><span class="na">gotoStartOfSentence</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>   <span class="c1">// goto start</span>
      <span class="k">do</span> <span class="p">{</span>
        <span class="n">sc</span><span class="p">.</span><span class="na">gotoEndOfSentence</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>   <span class="c1">// select 1 sentence</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">comparer</span><span class="p">.</span><span class="na">compareRegionEnds</span><span class="p">(</span><span class="n">endPara</span><span class="p">,</span> <span class="n">sc</span><span class="p">.</span><span class="na">getEnd</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
          <span class="c1">// has sentence cursor passed end of current paragraph?</span>
          <span class="k">break</span><span class="p">;</span>

        <span class="c1">// move view cursor to highlight current sentence</span>
        <span class="n">tvc</span><span class="p">.</span><span class="na">gotoRange</span><span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="na">getStart</span><span class="p">(),</span> <span class="kc">false</span><span class="p">);</span>
        <span class="n">tvc</span><span class="p">.</span><span class="na">gotoRange</span><span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="na">getEnd</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>

        <span class="n">currSentStr</span> <span class="o">=</span> <span class="n">stripNonWordChars</span><span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="na">getString</span><span class="p">());</span>
                      <span class="c1">// clean up string to make speech nicer</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">currSentStr</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
          <span class="n">speaker</span><span class="p">.</span><span class="na">say</span><span class="p">(</span><span class="n">currSentStr</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="na">gotoNextSentence</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">paraCursor</span><span class="p">.</span><span class="na">gotoNextParagraph</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>

  <span class="n">speaker</span><span class="p">.</span><span class="na">dispose</span><span class="p">();</span>
<span class="p">}</span>  <span class="c1">// end of speakSentences()</span>
</code></pre></div>
</div>
</div>
</div>
<p>speakSentences() comprises two nested loops: the outer loop iterates through the
paragraphs, and the inner loop through the sentences in the current paragraph.</p>
<p>The sentence cursor is created like so:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="28:1"><input checked="checked" id="__tabbed_28_1" name="__tabbed_28" type="radio" /><div class="tabbed-labels"><label for="__tabbed_28_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XTextCursor</span> <span class="n">cursor</span> <span class="o">=</span>
        <span class="n">paraCursor</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">createTextCursorByRange</span><span class="p">(</span>
                                     <span class="n">paraCursor</span><span class="p">.</span><span class="na">getStart</span><span class="p">());</span>
<span class="n">XSentenceCursor</span> <span class="n">sc</span> <span class="o">=</span>
        <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XSentenceCursor</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cursor</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>The XText reference is returned by paraCursor.getText(), and a text cursor is created.</p>
<p>createTextCursorByRange() allows the start position of the cursor to be specified. The
text cursor is converted into a sentence cursor with Lo.qi().</p>
<p>The tricky aspect of this code is the meaning of paraCursor.getText() which is the
XText object that paraCursor utilizes. This is not a single paragraph but the entire text
document. Remember that the paragraph cursor is created with:
XParagraphCursor paraCursor = Write.getParagraphCursor(doc);
This corresponds to:</p>
<p>XText xText = doc.getText();
XTextCursor textCursor = xText.createTextCursor();
XParagraphCursor paraCursor = Lo.qi(
                         XParagraphCursor.class, textCursor);</p>
<p>Both the paragraph and sentence cursors refer to
the entire text document. This means that I cannot
code the inner loop using the coding pattern from
before. That would result in something like the
following:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="29:1"><input checked="checked" id="__tabbed_29_1" name="__tabbed_29" type="radio" /><div class="tabbed-labels"><label for="__tabbed_29_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// set sentence cursor to point to start</span>
<span class="n">of</span> <span class="k">this</span> <span class="n">paragraph</span>
<span class="n">XTextCursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">paraCursor</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">createTextCursorByRange</span><span class="p">(</span>
                                            <span class="n">paraCursor</span><span class="p">.</span><span class="na">getStart</span><span class="p">())</span>
<span class="n">XSentenceCursor</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span>
                                   <span class="n">XSentenceCursor</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cursor</span><span class="p">);</span>

<span class="n">sc</span><span class="p">.</span><span class="na">gotoStartOfSentence</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>   <span class="c1">// goto start</span>
<span class="k">do</span> <span class="p">{</span>
  <span class="n">sc</span><span class="p">.</span><span class="na">gotoEndOfSentence</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>    <span class="c1">// select 1 sentence</span>
  <span class="c1">// do something with the sentence</span>
  <span class="c1">//  :</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">sc</span><span class="p">.</span><span class="na">gotoNextSentence</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To further confuse matters, a
XText object does not always
correspond to the entire text
document. For example, a text
frame (e.g. like this one) can
return an XText object for the
text only inside the frame.</p>
</div>
<p>The problem with the above code fragment is that
XSentenceCursor.gotoNextSentence() will keep moving to the next sentence until it
reaches the end of the text document. This is not the desired behavior â€“ what I want is
for the loop to terminate when the last sentence of the current paragraph has been
processed.</p>
<p>We need to compare text ranges, in this case the end of the current sentence with the
end of the current paragraph. This capability is handled by the XTextRangeCompare
interface. A comparer object is created at the beginning of speakSentence(), initialized
to compare ranges that can span the entire document:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="30:1"><input checked="checked" id="__tabbed_30_1" name="__tabbed_30" type="radio" /><div class="tabbed-labels"><label for="__tabbed_30_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XTextRangeCompare</span> <span class="n">comparer</span> <span class="o">=</span>
   <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextRangeCompare</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">doc</span><span class="p">.</span><span class="na">getText</span><span class="p">());</span>
</code></pre></div>
</div>
</div>
</div>
<p>This comparer object is utilized inside the sentence-iterating loop to compare the end
of the current paragraph (the endPara text range) with the end of current sentence (the
sc.getEnd() text range):</p>
<div class="tabbed-set tabbed-alternate" data-tabs="31:1"><input checked="checked" id="__tabbed_31_1" name="__tabbed_31" type="radio" /><div class="tabbed-labels"><label for="__tabbed_31_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="n">comparer</span><span class="p">.</span><span class="na">compareRegionEnds</span><span class="p">(</span><span class="n">endPara</span><span class="p">,</span> <span class="n">sc</span><span class="p">.</span><span class="na">getEnd</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="k">break</span><span class="p">;</span>
</code></pre></div>
</div>
</div>
</div>
<p>If the sentence ends after the end of the paragraph then compareRegionEnds() returns
a positive number, and the inner loop terminates.</p>
<p>This approach doesn't suffer from the problem in Write.getPosition() with
XTextRange.getString(), and using its length as a position:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="32:1"><input checked="checked" id="__tabbed_32_1" name="__tabbed_32" type="radio" /><div class="tabbed-labels"><label for="__tabbed_32_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getPosition</span><span class="p">(</span><span class="n">XTextCursor</span> <span class="n">cursor</span><span class="p">)</span>
<span class="p">{</span>  <span class="k">return</span> <span class="p">(</span><span class="n">cursor</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">getString</span><span class="p">()).</span><span class="na">length</span><span class="p">();</span>
</code></pre></div>
</div>
</div>
</div>
<p>Since there's no String object being created by the comparer, there's no way that the
instantiation can fail due to the size of the text.</p>
<h2 id="7-insertingchanging-text-in-a-document">7.  Inserting/Changing Text in a Document<a class="headerlink" href="#7-insertingchanging-text-in-a-document" title="Permanent link">&para;</a></h2>
<p>My ShuffleWords.java example searches a document and changes the words it
encounters. Figure 8 shows the program in progress: "predominates" has been
selected but not yet changed, but all the previous 'big' words have been shuffled.</p>
<p><img alt="" src="images/05-Text_API_Overview-8.png" /></p>
<p>Figure 8. Shuffling of Words.</p>
<p>A word shuffle is applied to every word of four letters or more, but only involves the
random exchange of the middle letters without changing the first and last characters.</p>
<p>The applyShuffle() function which iterates through the words in the input file is
similar to countWords() in HighlightText.java. One difference is the use of
XText.insertString():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="33:1"><input checked="checked" id="__tabbed_33_1" name="__tabbed_33" type="radio" /><div class="tabbed-labels"><label for="__tabbed_33_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">applyShuffle</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XText</span> <span class="n">docText</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">getText</span><span class="p">();</span>

  <span class="n">XWordCursor</span> <span class="n">wordCursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getWordCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="n">wordCursor</span><span class="p">.</span><span class="na">gotoStart</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>     <span class="c1">// go to start of text</span>

  <span class="n">XTextViewCursor</span> <span class="n">tvc</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getViewCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>

  <span class="n">String</span> <span class="n">currWord</span><span class="p">;</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">wordCursor</span><span class="p">.</span><span class="na">gotoEndOfWord</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

    <span class="c1">// move the text view cursor, and highlight the current word</span>
    <span class="n">tvc</span><span class="p">.</span><span class="na">gotoRange</span><span class="p">(</span><span class="n">wordCursor</span><span class="p">.</span><span class="na">getStart</span><span class="p">(),</span> <span class="kc">false</span><span class="p">);</span>
    <span class="n">tvc</span><span class="p">.</span><span class="na">gotoRange</span><span class="p">(</span><span class="n">wordCursor</span><span class="p">.</span><span class="na">getEnd</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
    <span class="n">currWord</span> <span class="o">=</span> <span class="n">wordCursor</span><span class="p">.</span><span class="na">getString</span><span class="p">().</span><span class="na">trim</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">currWord</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Lo</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>
          <span class="c1">// slow down so user can see selection before change</span>
      <span class="n">docText</span><span class="p">.</span><span class="na">insertString</span><span class="p">(</span><span class="n">wordCursor</span><span class="p">,</span> <span class="n">midShuffle</span><span class="p">(</span><span class="n">currWord</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">while</span><span class="p">(</span> <span class="n">wordCursor</span><span class="p">.</span><span class="na">gotoNextWord</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
<span class="p">}</span>  <span class="c1">// end of applyShuffle()</span>
</code></pre></div>
</div>
</div>
</div>
<p>insertString() is located in XSimpleText:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="34:1"><input checked="checked" id="__tabbed_34_1" name="__tabbed_34" type="radio" /><div class="tabbed-labels"><label for="__tabbed_34_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">insertString</span><span class="p">(</span><span class="n">XTextRange</span> <span class="n">xRange</span><span class="p">,</span> <span class="n">String</span> <span class="n">s</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">willReplace</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>
<p>The string s is inserted at the cursor's text range position. If willReplace is true then
the string replaces the current selection (which is the case in applyShuffle()).</p>
<p>midShuffle() shuffles the string in currWord, returning a new word. It doesn't use the
Office API, so I won't explain it here.</p>
<h2 id="8-treating-a-document-as-paragraphs-and-text-portions">8.  Treating a Document as Paragraphs and Text Portions<a class="headerlink" href="#8-treating-a-document-as-paragraphs-and-text-portions" title="Permanent link">&para;</a></h2>
<p>Another approach for moving around a document involves the XEnumerationAccess
interface which treats the document as a series of Paragraph text contents.</p>
<p>XEnumerationAccess is an interface in the Text service, which means that an XText
reference can be converted into it by using Lo.qi(). These relationships are shown in
Figure 9.</p>
<p><img alt="" src="images/05-Text_API_Overview-9.png" /></p>
<p>Figure 9. The Text Service and its Interfaces.</p>
<p>The following code fragment utilizes this technique:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="35:1"><input checked="checked" id="__tabbed_35_1" name="__tabbed_35" type="radio" /><div class="tabbed-labels"><label for="__tabbed_35_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">XText</span> <span class="n">xText</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">getText</span><span class="p">();</span>    <span class="c1">// get text of document</span>
<span class="n">XEnumerationAccess</span> <span class="n">enumAccess</span> <span class="o">=</span>
               <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XEnumerationAccess</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">xText</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>XEnumerationAccess contains a single method, createEnumeration() which creates an
enumerator (an instance of XEnumeration). Each element returned from this iterator is
a Paragraph text content:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="36:1"><input checked="checked" id="__tabbed_36_1" name="__tabbed_36" type="radio" /><div class="tabbed-labels"><label for="__tabbed_36_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// create enumerator over the document text</span>
<span class="n">XEnumeration</span> <span class="n">textEnum</span> <span class="o">=</span> <span class="n">enumAccess</span><span class="p">.</span><span class="na">createEnumeration</span><span class="p">();</span>

<span class="k">while</span> <span class="p">(</span><span class="n">textEnum</span><span class="p">.</span><span class="na">hasMoreElements</span><span class="p">())</span> <span class="p">{</span>    <span class="c1">// loop through paragraphs</span>
   <span class="n">XTextContent</span> <span class="n">textCon</span> <span class="o">=</span>
         <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextContent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">textEnum</span><span class="p">.</span><span class="na">nextElement</span><span class="p">());</span>
   <span class="c1">// use the Paragraph text content (textCon) in some way...</span>

<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Paragraph doesn't support its own interface (i.e. there's no XParagraph), so I've used
Lo.qi() to access its XTextContent interface, which belongs to the TextContent
subclass. The hierarchy is shown in Figure 10.</p>
<p><img alt="" src="images/05-Text_API_Overview-10.png" /></p>
<p>Figure 10. The Paragraph Text Content Hierarchy.</p>
<p>Iterating over a document to access Paragraph text contents doesn't seem much
different from iterating over a document using a paragraph cursor, except that the
Paragraph service offers a more structured view of a paragraph.</p>
<p>In particular, you can use another XEnumerationAccess instance  to iterate over a
single paragraph, viewing it as a sequence of text portions.</p>
<p>The following code illustrates the notion, using the textCon text content from the
previous piece of code:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="37:1"><input checked="checked" id="__tabbed_37_1" name="__tabbed_37" type="radio" /><div class="tabbed-labels"><label for="__tabbed_37_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Info</span><span class="p">.</span><span class="na">supportService</span><span class="p">(</span><span class="n">textCon</span><span class="p">,</span> <span class="s">&quot;com.sun.star.text.TextTable&quot;</span><span class="p">))</span> <span class="p">{</span>
  <span class="c1">// create enumerator over a paragraph</span>
  <span class="n">XEnumerationAccess</span> <span class="n">enumAccess</span> <span class="o">=</span>
                 <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XEnumerationAccess</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">textCon</span><span class="p">);</span>
  <span class="n">XEnumeration</span> <span class="n">paraEnum</span> <span class="o">=</span> <span class="n">enumAccess</span><span class="p">.</span><span class="na">createEnumeration</span><span class="p">();</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">paraEnum</span><span class="p">.</span><span class="na">hasMoreElements</span><span class="p">())</span> <span class="p">{</span>    <span class="c1">// loop through portions</span>
    <span class="n">XTextRange</span> <span class="n">txtRange</span> <span class="o">=</span>
           <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XTextRange</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">paraEnum</span><span class="p">.</span><span class="na">nextElement</span><span class="p">());</span>
    <span class="c1">// use the text portion (txtRange) in some way...</span>

  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>The TextTable service is a subclass of Paragraph, and cannot be enumerated.</p>
<p>Therefore, I surrounded the paragraph enumerator with an if-test to skip a paragraph if
it's really a table.</p>
<p>The paragraph enumerator returns text portions, represented by the TextPortion
service. TextPortion contains a lot of useful properties which describe the paragraph,
but it doesn't have its own interface (such as XTextPortion). However, TextPortion
inherits the TextRange service, so I can use Lo.qi() to obtain its XTextRange
interface. This hierarchy is shown in Figure 11.</p>
<p><img alt="" src="images/05-Text_API_Overview-11.png" /></p>
<p>Figure 11. The TextPortion Service Hierarchy.</p>
<p>TextPortion includes a "TextPortionType" property which identifies the type of the
portion. Other properties access different kinds of portion data, such as a text field or
footnote.</p>
<p>For instance, the following prints the text portion type and the string inside the
txtRange text portion (txtRange comes from the previous code fragment):</p>
<div class="tabbed-set tabbed-alternate" data-tabs="38:1"><input checked="checked" id="__tabbed_38_1" name="__tabbed_38" type="radio" /><div class="tabbed-labels"><label for="__tabbed_38_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;  &quot;</span> <span class="o">+</span>
   <span class="n">Props</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="n">txtRange</span><span class="p">,</span> <span class="s">&quot;TextPortionType&quot;</span><span class="p">)</span> <span class="o">+</span>
   <span class="s">&quot; = \&quot;&quot;</span> <span class="o">+</span> <span class="n">txtRange</span><span class="p">.</span><span class="na">getString</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;\&quot;&quot;</span><span class="p">);</span>
</code></pre></div>
</div>
</div>
</div>
<p>These code fragments are combined together in my ShowBookText.java example.</p>
<p>More details on enumerators and text portions are given in the Developers Guide at
<a href="https://wiki.openoffice.org/wiki/Documentation/DevGuide/Text/Iterating_over_Text">https://wiki.openoffice.org/wiki/Documentation/DevGuide/Text/Iterating_over_Text</a>
(or use <code>loGuide "Iterating over Text"</code>).</p>
<h2 id="9-appending-documents-together">9.  Appending Documents Together<a class="headerlink" href="#9-appending-documents-together" title="Permanent link">&para;</a></h2>
<p>If you need to write a large multi-part document (e.g. a thesis with chapters,
appendices, contents page, and an index) then you should utilize a master document,
which acts as a repository of links to documents representing the component parts.
You can find out about master documents in Chapter 13 of the Writers Guide, at
<a href="https://wiki.documentfoundation.org/Documentation/Publications">https://wiki.documentfoundation.org/Documentation/Publications</a>.</p>
<p>However, the complexity of master documents isn't always needed. Often the aim is
simply to append one document to the end of another. In that case, the
XDocumentInsertable interface, and its insertDocumentFromURL() method is more
suitable.</p>
<p>My DocsAppend.java example uses
XDocumentInsertable.insertDocumentFromURL(). A list of filenames is read from
the command line; the first file is opened, and the other files appended to it by
appendTextFiles():</p>
<div class="tabbed-set tabbed-alternate" data-tabs="39:1"><input checked="checked" id="__tabbed_39_1" name="__tabbed_39" type="radio" /><div class="tabbed-labels"><label for="__tabbed_39_1">java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// part of DocsAppend.java</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">appendTextFiles</span><span class="p">(</span><span class="n">XTextDocument</span> <span class="n">doc</span><span class="p">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">XTextCursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">Write</span><span class="p">.</span><span class="na">getCursor</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* start at 1 to skip the first file, which has</span>
<span class="cm">       been opened as doc */</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">cursor</span><span class="p">.</span><span class="na">gotoEnd</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
      <span class="c1">// Write.pageBreak(cursor);</span>

      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Appending &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
      <span class="n">XDocumentInsertable</span> <span class="n">inserter</span> <span class="o">=</span>
                      <span class="n">Lo</span><span class="p">.</span><span class="na">qi</span><span class="p">(</span><span class="n">XDocumentInsertable</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">cursor</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">inserter</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Inserter could not be created&quot;</span><span class="p">);</span>
      <span class="k">else</span>
        <span class="n">inserter</span><span class="p">.</span><span class="na">insertDocumentFromURL</span><span class="p">(</span>
            <span class="n">FileIO</span><span class="p">.</span><span class="na">fnmToURL</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">),</span> <span class="k">new</span> <span class="n">PropertyValue</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not append &quot;</span> <span class="o">+</span>
                                     <span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>  <span class="c1">// end of appendTextFiles()</span>
</code></pre></div>
</div>
</div>
</div>
<p>An XDocumentInsertable instance is obtained by converting the text cursor with
UnoRuntime.queryInterface().</p>
<p>XDocumentInsertable.insertDocumentFromURL() requires two arguments â€“ the URL
of the file that's being appended, and an empty property value array.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="05%20Part%202%20Writer.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Part 2 Writer" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Part 2 Writer
            </div>
          </div>
        </a>
      
      
        
        <a href="06-Text_Styles.html" class="md-footer__link md-footer__link--next" aria-label="Next: Chapter 6. Text Styles" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Chapter 6. Text Styles
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="assets/javascripts/bundle.960e086b.min.js"></script>
      
    
  </body>
</html>